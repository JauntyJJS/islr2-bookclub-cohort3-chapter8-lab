<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Jeremy Selva" />


<title>Chapter 8 Lab</title>

<script src="docs/rmarkdown_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="docs/rmarkdown_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="docs/rmarkdown_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="docs/rmarkdown_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="docs/rmarkdown_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="docs/rmarkdown_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="docs/rmarkdown_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="docs/rmarkdown_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="docs/rmarkdown_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="docs/rmarkdown_libs/navigation-1.1/tabsets.js"></script>
<script src="docs/rmarkdown_libs/navigation-1.1/codefolding.js"></script>
<script src="docs/rmarkdown_libs/navigation-1.1/sourceembed.js"></script>
<script src="docs/rmarkdown_libs/core-js-2.5.3/shim.min.js"></script>
<script src="docs/rmarkdown_libs/react-17.0.0/react.min.js"></script>
<script src="docs/rmarkdown_libs/react-17.0.0/react-dom.min.js"></script>
<script src="docs/rmarkdown_libs/reactwidget-1.0.0/react-tools.js"></script>
<script src="docs/rmarkdown_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="docs/rmarkdown_libs/reactable-binding-0.2.3/reactable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><strong>Chapter 8 Lab</strong></h1>
<h3 class="subtitle">This document was prepared on 2022-04-17.</h3>
<h4 class="author">Jeremy Selva</h4>

</div>


<!-- 
!!!! IMPORTANT: run `source("utils/render.R")` to publish instead of clicking on 'Knit'
# See https://yihui.org/knitr/options/
-->
<div class="sourceCode" id="cb1"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rmarkdown stuff</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmarkdown, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(htmltools, quietly=TRUE)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(styler, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(xaringanExtra, quietly=TRUE)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Session info and package reporting</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(report, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Data wrangling</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interactive tables</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reactable, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># For plotting</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># From github</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parttree, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ConfusionTableR, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># For Decision Classification Trees</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># For Bagging and Random Forest</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># For Boosting</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DiagrammeR, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DiagrammeRsvg, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsvg, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># For BART</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbarts, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># From github</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(embarcadero, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># For variable importance</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co"># For parallel processing for tuning</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreach, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co"># For applying tidymodels</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parsnip, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dials, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tune, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(workflows, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yardstick, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(report<span class="sc">::</span><span class="fu">report</span>(<span class="fu">sessionInfo</span>()))</span></code></pre></div>
<p>The analysis was done using the R Statistical language (v4.1.3; R Core Team, 2022) on Windows 10 x64, using the packages randomForest (v4.7.1), ggpubr (v0.4.0), Metrics (v0.1.4), vip (v0.3.2), embarcadero (v1.2.0.1003), workflows (v0.2.6), ISLR2 (v1.3.1), ConfusionTableR (v1.0.4), parttree (v0.0.1.9000), reactable (v0.2.3), ggplot2 (v3.3.5), stringr (v1.4.0), forcats (v0.5.1), scales (v1.1.1), tidyr (v1.2.0), readr (v2.1.2), dplyr (v1.0.8), matrixStats (v0.61.0), rsvg (v2.2.0), rmarkdown (v2.13), rsample (v0.1.1), tibble (v3.1.6), styler (v1.7.0), purrr (v0.3.4), report (v0.5.1), data.table (v1.14.2), tune (v0.2.0), yardstick (v0.0.9), parsnip (v0.2.1), recipes (v0.2.0), dials (v0.1.1), foreach (v1.5.2), doParallel (v1.0.17), sp (v1.4.6), iterators (v1.0.14), DiagrammeRsvg (v0.1), DiagrammeR (v1.0.9), raster (v3.5.15), dismo (v1.3.5), ROCR (v1.0.11), magrittr (v2.0.3), rpart.plot (v3.1.0), rpart (v4.1.16), patchwork (v1.1.1), xgboost (v1.5.2.1), dbarts (v0.9.22), tidyverse (v1.3.1) and knitr (v1.38).</p>
<div id="fitting-classification-trees" class="section level1">
<h1>Fitting Classification Trees</h1>
<p>In the <code>Carseats</code> data set, <code>Sales</code> is a continuous variable, and so we begin by recording it as a binary variable called <code>High</code>, which takes on a value of Yes if the Sales variable exceeds 8, and takes on a value of No otherwise.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Carseats <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>(ISLR2<span class="sc">::</span>Carseats) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">High =</span> <span class="fu">factor</span>(dplyr<span class="sc">::</span><span class="fu">if_else</span>(.data[[<span class="st">&quot;Sales&quot;</span>]] <span class="sc">&lt;=</span> <span class="dv">8</span>, <span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>)))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>Carseats <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">defaultPageSize =</span> <span class="dv">5</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">filterable =</span> <span class="cn">TRUE</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div id="htmlwidget-1b4ff99564eb6e8884a5" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1b4ff99564eb6e8884a5">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"CompPrice":[138,111,113,117,141,124,115,136,132,132,121,117,122,115,107,149,118,147,110,129,125,134,128,121,145,139,107,98,103,104,125,136,107,114,115,131,122,121,109,130,119,157,77,123,85,141,127,126,116,157,99,121,153,109,134,143,133,93,103,118,122,105,139,119,100,122,127,126,149,127,89,148,115,118,150,88,102,118,134,134,113,116,151,109,111,125,150,131,117,128,115,97,114,145,115,134,147,161,122,121,113,128,113,123,121,104,102,134,107,115,128,132,116,131,122,139,135,145,112,130,128,125,119,127,131,89,153,125,133,143,94,108,125,132,132,96,131,128,125,146,133,140,124,122,132,144,114,140,110,121,122,111,128,150,129,98,146,121,142,119,111,143,122,130,148,147,119,106,129,104,128,93,104,135,139,115,138,138,104,144,137,121,137,118,132,130,120,117,116,118,130,156,108,139,112,117,130,124,112,122,144,138,121,131,155,113,162,111,86,98,125,117,145,149,115,116,141,106,138,116,131,124,136,110,134,107,119,113,149,98,115,132,137,123,115,126,141,151,121,123,159,136,124,124,130,114,120,123,111,125,137,139,133,124,108,123,147,125,108,123,129,121,120,116,128,130,128,134,123,159,119,111,113,116,135,107,135,136,114,141,121,122,150,135,106,146,117,95,116,143,107,118,113,123,148,118,127,118,148,135,116,99,108,133,123,115,131,138,126,131,175,146,137,103,133,131,122,142,116,127,136,123,140,107,136,144,133,112,117,100,122,135,106,136,93,120,138,130,112,134,140,98,137,117,138,121,132,96,132,134,111,124,133,107,133,130,142,103,123,130,118,131,131,111,122,154,124,95,109,135,126,152,121,137,131,132,141,132,133,125,106,124,121,98,123,131,152,142,135,128,108,153,129,109,130,138,139,162,100,134],"Income":[73,48,35,100,64,113,105,81,110,113,78,94,35,28,117,95,32,74,110,76,90,29,46,31,119,32,115,118,74,99,94,58,32,38,54,84,76,41,73,60,98,53,69,42,79,63,90,98,52,93,32,90,40,64,103,81,82,91,93,71,102,32,45,88,67,26,92,61,69,59,81,51,45,90,68,111,87,71,48,67,100,72,83,36,25,103,84,67,42,66,22,46,113,30,97,25,42,82,77,47,69,93,22,91,96,100,33,107,79,65,62,118,99,29,87,35,75,53,88,94,105,89,100,103,113,78,68,48,100,120,84,69,87,98,31,94,75,42,103,62,60,42,84,88,68,63,83,54,119,120,84,58,78,36,69,72,34,58,90,60,28,21,74,64,64,58,67,73,89,41,39,106,102,91,24,89,107,72,71,25,112,83,60,74,33,100,51,32,37,117,37,42,26,70,98,93,28,61,80,88,92,83,78,82,80,22,67,105,54,21,41,118,69,84,115,83,33,44,61,79,120,44,119,45,82,25,33,64,73,104,60,69,80,76,62,32,34,28,24,105,80,63,46,25,30,43,56,114,52,67,105,111,97,24,104,81,40,62,38,36,117,42,77,26,29,35,93,82,57,69,26,56,33,106,93,119,69,48,113,57,86,69,96,110,46,26,118,44,40,77,111,70,66,84,76,35,44,83,63,40,78,93,77,52,98,29,32,92,80,111,65,68,117,81,33,21,36,30,72,45,70,39,50,105,65,69,30,38,66,54,59,63,33,60,117,70,35,38,24,44,29,120,102,42,80,68,107,39,102,27,101,115,103,67,31,100,109,73,96,62,86,25,55,75,21,30,56,106,22,100,41,81,50,71,47,46,60,61,88,111,64,65,28,117,37,73,116,73,89,42,75,63,42,51,58,108,23,26,79,37],"Advertising":[11,16,10,4,3,13,0,15,0,0,9,4,2,11,11,5,0,13,0,16,2,12,6,0,16,0,11,0,0,15,0,16,12,13,0,11,0,5,0,0,0,0,0,11,6,0,14,0,0,0,18,0,3,13,13,5,0,0,15,4,19,0,0,10,12,0,0,14,20,0,15,16,0,10,5,23,10,12,1,0,16,0,4,7,0,0,9,7,7,3,0,11,0,0,5,10,10,5,24,3,11,0,0,0,0,8,0,0,2,0,7,12,5,11,9,0,0,0,2,8,11,10,5,0,0,0,2,3,3,7,13,3,9,2,0,14,0,0,12,10,10,0,0,7,0,11,0,9,0,13,8,17,0,7,10,0,0,8,1,0,0,5,0,0,0,7,17,0,0,15,12,12,13,5,0,0,9,0,14,3,15,0,4,6,7,11,0,0,0,18,13,13,0,7,18,4,6,0,5,5,0,0,4,0,0,1,0,0,0,11,2,14,19,5,3,15,0,0,12,19,15,0,6,9,0,0,0,10,13,0,0,0,10,18,11,8,16,8,0,0,0,0,0,13,0,0,20,0,0,0,10,5,0,5,23,8,0,14,0,10,8,4,15,6,5,10,12,7,0,0,0,0,0,8,2,11,14,12,2,13,10,7,0,0,11,11,11,4,0,25,14,0,16,0,3,14,13,13,0,17,1,0,13,16,12,26,1,0,19,13,29,12,5,3,10,8,5,0,10,19,12,5,10,18,4,11,0,17,1,9,0,15,20,7,9,15,6,0,0,4,0,0,13,10,0,0,0,0,20,18,17,16,14,12,1,0,0,3,10,11,7,10,0,1,16,0,11,0,10,22,22,0,0,0,7,4,19,0,3,0,10,21,19,0,15,13,0,14,11,8,9,0,13,10,19,17,3,12,7,0],"Population":[276,260,269,466,340,501,45,425,108,131,150,503,393,29,148,400,284,251,408,58,367,239,497,292,294,176,496,19,359,226,447,241,236,317,406,29,270,412,454,144,18,403,25,16,325,168,16,173,349,51,341,150,112,39,25,60,54,22,188,148,469,358,146,170,184,197,508,152,366,339,237,148,432,54,125,480,346,44,139,286,353,237,325,468,52,304,432,272,144,493,491,267,97,67,134,237,407,287,382,220,94,89,57,334,472,398,217,104,488,217,125,272,298,335,17,95,202,507,243,137,249,380,45,125,181,181,60,192,350,279,497,208,232,265,327,384,10,436,371,310,277,331,300,36,264,27,412,402,384,140,176,407,341,488,289,59,220,249,189,372,486,81,424,40,58,100,151,216,425,492,356,416,123,207,358,38,480,148,89,70,434,79,230,426,35,449,93,142,426,509,297,170,408,71,481,420,410,333,500,335,349,139,413,132,237,317,27,466,497,326,357,445,501,220,48,170,243,481,156,359,262,125,178,276,464,412,245,68,381,404,119,123,24,218,289,95,361,499,200,149,362,160,199,87,391,199,266,298,12,86,435,310,70,288,353,198,277,477,251,467,400,188,86,434,324,402,343,473,66,438,284,504,14,244,67,210,296,326,129,376,496,303,80,112,414,261,429,208,74,448,400,106,322,74,126,502,160,276,312,497,158,198,388,290,408,394,85,13,436,33,419,328,337,491,333,220,369,472,456,459,171,499,300,428,133,131,152,316,65,433,501,213,354,303,489,464,60,283,164,219,105,268,422,371,108,279,144,161,459,467,266,458,288,430,80,306,111,276,71,396,265,183,26,377,488,122,447,256,348,463,403,191,508,402,90,206,319,263,105,404,17,496,315,76,348,455,170,238,245,328,61,49,315,26,366,203,37,368,284,27],"Price":[120,83,80,97,128,72,108,120,124,124,100,94,136,86,118,144,110,131,68,121,131,109,138,109,113,82,131,107,97,102,89,131,137,128,128,96,100,110,102,138,126,124,24,134,95,135,70,108,98,149,108,108,129,119,144,154,84,117,103,114,123,107,133,101,104,128,91,115,134,99,99,150,116,104,136,92,70,89,145,90,79,128,139,94,121,112,134,126,111,119,103,107,125,104,84,148,132,129,127,107,106,118,97,96,138,97,139,108,103,90,116,151,125,127,106,129,128,119,99,128,131,87,108,155,120,49,133,116,126,147,77,94,136,97,131,120,120,118,109,94,129,131,104,159,123,117,131,119,97,87,114,103,128,150,110,69,157,90,112,70,111,160,149,106,141,191,137,93,117,77,118,55,110,128,185,122,154,94,81,116,149,91,140,102,97,107,86,96,90,104,101,173,93,96,128,112,133,138,128,126,146,134,130,157,124,132,160,97,64,90,123,120,105,139,107,144,144,111,120,116,124,107,145,125,141,82,122,101,163,72,114,122,105,120,129,132,108,135,133,118,121,94,135,110,100,88,90,151,101,117,156,132,117,122,129,81,144,112,81,100,101,118,132,115,159,129,112,112,105,166,89,110,63,86,119,132,130,125,151,158,145,105,154,117,96,131,113,72,97,156,103,89,74,89,99,137,123,104,130,96,99,87,110,99,134,132,133,120,126,80,166,132,135,54,129,171,72,136,130,129,152,98,139,103,150,104,122,104,111,89,112,134,104,147,83,110,143,102,101,126,91,93,118,121,126,149,125,112,107,96,91,105,122,92,145,146,164,72,118,130,114,104,110,108,131,162,134,53,79,122,119,126,98,116,118,124,92,125,119,107,89,151,121,68,112,132,160,115,78,107,111,124,130,120,139,128,120,159,95,120],"ShelveLoc":["Bad","Good","Medium","Medium","Bad","Bad","Medium","Good","Medium","Medium","Bad","Good","Medium","Good","Good","Medium","Good","Good","Good","Medium","Medium","Good","Medium","Medium","Bad","Good","Good","Medium","Bad","Bad","Good","Medium","Good","Good","Medium","Medium","Good","Medium","Medium","Bad","Bad","Bad","Medium","Medium","Medium","Bad","Medium","Bad","Bad","Good","Bad","Bad","Bad","Medium","Medium","Medium","Medium","Bad","Bad","Medium","Bad","Medium","Bad","Medium","Medium","Medium","Medium","Medium","Good","Medium","Good","Medium","Medium","Good","Medium","Bad","Medium","Medium","Medium","Bad","Bad","Good","Good","Bad","Bad","Medium","Medium","Good","Medium","Medium","Medium","Medium","Medium","Medium","Bad","Medium","Good","Bad","Good","Bad","Medium","Medium","Medium","Bad","Medium","Medium","Medium","Medium","Bad","Medium","Medium","Medium","Good","Bad","Medium","Medium","Medium","Medium","Medium","Medium","Medium","Bad","Medium","Good","Good","Medium","Good","Medium","Bad","Bad","Medium","Medium","Good","Bad","Medium","Medium","Bad","Medium","Medium","Medium","Medium","Bad","Medium","Bad","Good","Medium","Bad","Good","Medium","Medium","Good","Good","Good","Medium","Medium","Medium","Good","Medium","Good","Bad","Medium","Medium","Medium","Bad","Medium","Bad","Medium","Medium","Medium","Good","Medium","Medium","Good","Medium","Medium","Medium","Medium","Medium","Medium","Medium","Bad","Medium","Bad","Medium","Medium","Medium","Medium","Bad","Medium","Medium","Medium","Good","Medium","Good","Medium","Bad","Bad","Medium","Medium","Medium","Medium","Medium","Bad","Bad","Medium","Medium","Medium","Bad","Bad","Bad","Bad","Medium","Medium","Medium","Medium","Bad","Medium","Medium","Medium","Good","Medium","Medium","Medium","Medium","Medium","Bad","Good","Medium","Bad","Medium","Bad","Medium","Good","Medium","Good","Medium","Medium","Medium","Good","Bad","Medium","Medium","Medium","Medium","Medium","Good","Bad","Bad","Medium","Bad","Good","Bad","Medium","Medium","Good","Bad","Medium","Medium","Bad","Bad","Bad","Medium","Medium","Medium","Good","Bad","Good","Bad","Medium","Medium","Good","Medium","Good","Medium","Medium","Medium","Medium","Medium","Good","Medium","Bad","Good","Good","Medium","Bad","Medium","Medium","Bad","Medium","Medium","Medium","Bad","Good","Good","Good","Medium","Good","Bad","Good","Medium","Medium","Medium","Bad","Medium","Good","Medium","Medium","Bad","Medium","Bad","Medium","Bad","Bad","Medium","Good","Good","Good","Good","Good","Medium","Medium","Medium","Good","Medium","Bad","Medium","Medium","Medium","Bad","Good","Bad","Medium","Medium","Medium","Bad","Medium","Bad","Medium","Medium","Good","Bad","Medium","Medium","Bad","Good","Good","Medium","Good","Good","Medium","Medium","Medium","Good","Medium","Medium","Good","Good","Medium","Bad","Bad","Good","Medium","Bad","Good","Good","Medium","Medium","Good","Good","Medium","Bad","Medium","Medium","Medium","Medium","Medium","Good","Medium","Medium","Bad","Medium","Bad","Medium","Medium","Good","Medium","Medium","Medium","Bad","Medium","Medium","Bad","Bad","Medium","Bad","Good","Medium","Medium","Bad","Good"],"Age":[42,65,59,55,38,78,71,67,76,76,26,50,62,53,52,76,63,52,46,69,35,62,42,79,42,54,50,64,55,58,30,44,64,50,42,44,60,54,65,38,73,58,50,59,69,44,48,55,69,32,80,75,39,61,76,61,50,75,74,80,29,26,77,61,32,55,56,47,60,65,74,58,25,31,64,36,64,67,65,41,68,70,28,56,43,49,64,54,62,45,64,80,29,55,55,59,73,33,36,56,76,34,65,78,51,61,70,60,65,60,43,43,62,33,65,42,80,41,62,64,63,28,75,29,63,43,59,51,55,40,51,77,72,62,76,36,31,80,44,30,45,28,77,28,34,47,39,41,72,56,57,75,45,25,50,65,51,48,39,30,29,67,51,39,27,27,55,60,45,73,71,75,35,66,79,25,47,27,25,77,66,68,25,80,60,64,46,62,76,26,37,74,56,61,45,66,72,76,69,64,62,54,46,25,37,28,77,61,33,76,47,32,45,33,73,71,34,70,25,58,30,80,35,62,48,36,56,57,26,27,38,27,61,29,56,50,69,48,73,62,26,38,52,57,26,57,78,34,61,65,72,62,32,57,37,80,73,80,72,74,36,54,48,25,31,39,73,51,39,46,26,62,38,58,34,53,73,36,40,64,51,45,61,80,79,39,67,44,76,43,41,39,76,59,60,79,63,75,63,54,45,57,74,43,29,33,48,61,52,68,53,51,38,66,71,29,35,80,41,57,44,34,60,34,53,47,53,80,55,45,32,32,61,41,42,72,28,80,45,44,43,72,71,26,70,79,33,27,49,49,63,62,61,35,42,42,72,34,69,66,52,56,79,25,30,57,53,52,74,36,42,54,65,78,47,73,44,41,79,54,68,77,66,63,28,62,39,73,79,35,67,56,34,30,33,33,55,40,50,49],"Education":[17,10,12,14,13,16,15,10,10,17,10,13,18,18,18,18,13,10,17,12,18,18,13,10,12,11,11,17,11,17,12,18,10,16,17,17,18,10,15,10,17,16,18,13,13,12,15,16,18,17,16,16,18,17,17,18,17,11,16,13,13,13,17,13,16,13,18,16,13,12,12,17,15,11,13,16,15,18,12,13,11,13,17,11,18,13,15,16,10,16,11,15,12,17,11,13,16,16,16,16,12,18,16,17,12,11,18,12,16,17,14,14,12,12,13,13,10,12,11,12,13,10,10,15,14,15,16,14,13,10,12,16,10,12,16,18,18,11,10,13,18,15,15,17,11,17,14,16,14,11,10,17,13,17,16,16,16,13,10,18,12,12,13,17,13,15,11,13,10,18,10,15,16,18,15,12,11,17,14,18,13,11,13,18,11,10,17,17,15,15,13,14,14,10,11,11,16,16,10,14,12,18,10,14,14,12,17,10,12,11,14,15,11,10,18,11,17,14,14,17,10,11,13,14,13,14,14,16,11,18,14,11,15,14,16,17,10,10,13,16,18,12,14,10,18,10,18,16,11,11,14,13,16,12,17,15,10,13,14,11,10,15,18,17,15,17,17,12,11,17,10,16,12,12,11,11,15,16,15,18,10,16,11,16,17,10,18,17,15,17,11,17,15,10,11,10,18,10,15,17,11,16,14,11,10,13,12,12,10,18,12,14,10,13,14,14,10,15,14,11,18,15,15,12,13,11,17,16,11,12,14,10,12,10,13,15,18,15,11,15,16,10,10,14,13,12,13,14,11,14,17,16,17,12,18,11,12,15,11,14,15,15,12,12,14,17,12,17,14,14,12,16,11,17,12,11,11,12,12,15,17,13,14,10,12,17,16,14,16,12,12,16,13,17,16,14,11,18,12,16],"Urban":["Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","No","No","No","Yes","Yes","Yes","Yes","No","Yes","Yes","No","Yes","Yes","No","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","No","No","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","No","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","No","No","Yes","No","Yes","Yes","Yes","No","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","No","No","Yes","No","No","No","No","No","Yes","Yes","No","No","No","No","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","No","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","No","No","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","No","Yes","No","No","Yes","No","Yes","No","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","No","Yes","No","No","Yes","No","No","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","No","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","No","Yes","Yes","Yes"],"US":["Yes","Yes","Yes","Yes","No","Yes","No","Yes","No","Yes","Yes","Yes","No","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","No","Yes","No","Yes","No","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","No","No","No","No","No","Yes","Yes","Yes","Yes","No","No","No","Yes","No","Yes","Yes","Yes","Yes","No","No","Yes","No","Yes","No","Yes","Yes","Yes","No","No","Yes","Yes","No","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","No","No","No","Yes","Yes","No","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","No","Yes","No","No","No","No","Yes","Yes","Yes","Yes","Yes","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","No","No","Yes","No","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","No","No","Yes","Yes","No","No","Yes","No","No","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","No","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","No","No","Yes","No","No","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","Yes","Yes","No","No","No","Yes","Yes","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","No","No","Yes","No","Yes","Yes","No","Yes","No","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","No","Yes","Yes","Yes","No","Yes","Yes","No","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","No","No","No","Yes","No","No","Yes","Yes","Yes","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","No","Yes","Yes","Yes","No","No","No","Yes","No","Yes","No","Yes","No","Yes","Yes","Yes","No","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes"],"High":["Yes","Yes","Yes","No","No","Yes","No","Yes","No","No","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","No","No","No","Yes","Yes","No","Yes","No","Yes","Yes","No","No","No","No","No","Yes","No","No","No","Yes","No","No","Yes","No","No","No","No","No","No","Yes","No","No","No","Yes","No","No","Yes","No","No","Yes","Yes","Yes","No","Yes","No","No","Yes","No","Yes","Yes","No","No","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","No","No","No","No","No","Yes","Yes","No","Yes","No","Yes","No","No","No","No","No","No","No","No","Yes","No","Yes","Yes","No","No","No","Yes","Yes","No","Yes","No","No","No","Yes","No","Yes","Yes","Yes","Yes","No","No","No","Yes","No","Yes","No","No","No","No","No","Yes","Yes","No","No","No","No","Yes","Yes","No","Yes","No","Yes","Yes","Yes","No","No","No","No","No","Yes","Yes","Yes","No","No","No","No","Yes","No","No","No","No","Yes","Yes","Yes","Yes","No","No","No","No","Yes","Yes","No","No","No","No","No","Yes","Yes","Yes","No","Yes","Yes","Yes","No","No","Yes","No","No","No","No","No","No","No","No","No","No","Yes","No","No","Yes","No","No","No","Yes","Yes","Yes","No","No","No","No","Yes","Yes","Yes","No","No","No","No","No","No","Yes","No","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","No","No","Yes","Yes","No","No","Yes","Yes","No","No","No","No","Yes","No","Yes","No","Yes","No","No","Yes","No","No","No","No","No","No","No","No","Yes","No","No","No","Yes","No","Yes","Yes","No","No","No","No","No","No","No","Yes","No","No","No","No","No","No","No","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","No","Yes","No","No","Yes","No","Yes","No","No","No","Yes","Yes","No","Yes","No","No","No","Yes","No","Yes","No","No","No","No","No","Yes","No","Yes","No","No","No","No","Yes","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","No","No","No","Yes","No","No","Yes","Yes","No","Yes","Yes","No","No","Yes","Yes","Yes","No","Yes","No","No","Yes","No","Yes","No","No","No","Yes","No","No","Yes","Yes","No","No","Yes","Yes","Yes","No","No","No","No","No","Yes","No","No","No","Yes"]},"columns":[{"accessor":"CompPrice","name":"CompPrice","type":"numeric"},{"accessor":"Income","name":"Income","type":"numeric"},{"accessor":"Advertising","name":"Advertising","type":"numeric"},{"accessor":"Population","name":"Population","type":"numeric"},{"accessor":"Price","name":"Price","type":"numeric"},{"accessor":"ShelveLoc","name":"ShelveLoc","type":"factor"},{"accessor":"Age","name":"Age","type":"numeric"},{"accessor":"Education","name":"Education","type":"numeric"},{"accessor":"Urban","name":"Urban","type":"factor"},{"accessor":"US","name":"US","type":"factor"},{"accessor":"High","name":"High","type":"factor"}],"filterable":true,"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"ac3b997344364421512299a127477487","key":"ac3b997344364421512299a127477487"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div id="create-the-resample-object" class="section level2">
<h2>Create the resample object</h2>
<p>First, we split the samples into a training set and a test set. From the training set, we create a 10-fold cross-validation data set from the training set.</p>
<p>This is done with <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::initial_split</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::training</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::testing</code></a> and <a href="https://rsample.tidymodels.org/reference/vfold_cv.html"><code>rsample::vfold_cv</code></a>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Carseats_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(Carseats)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Carseats_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(Carseats_split)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Carseats_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(Carseats_split)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Carseats_fold <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(Carseats_train, <span class="at">v =</span> <span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="create-the-preprocessor" class="section level2">
<h2>Create the preprocessor</h2>
<p>We create a recipe with <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipes::recipe</code></a>. No other preprocessing step is done.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>class_tree_recipe <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> High <span class="sc">~</span> ., <span class="at">data =</span> Carseats_train)</span></code></pre></div>
</div>
<div id="specify-the-model" class="section level2">
<h2>Specify the model</h2>
<p>Use <a href="https://parsnip.tidymodels.org/reference/decision_tree.html"><code>parsnip::decision_tree</code></a>, <a href="https://parsnip.tidymodels.org/reference/set_args.html"><code>parsnip::set_mode</code></a> and <a href="https://parsnip.tidymodels.org/reference/set_engine.html"><code>parsnip::set_engine</code></a> to create the model.</p>
<p>The cost complexity is tuned using <a href="https://hardhat.tidymodels.org/reference/tune.html"><code>tune::tune</code></a></p>
<p>An engine specific parameter <code>model = TRUE</code> is set for rpart to prevent this warning message from coming up later when <code>rpart.plot::rpart.plot</code> is used later.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Cannot retrieve the data used to build the model (so cannot determine roundint and is.binary for the variables).</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; To silence this warning:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Call rpart.plot with roundint=FALSE,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     or rebuild the rpart model with model=TRUE.</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>class_tree_spec <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">decision_tree</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="dv">4</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost_complexity =</span> tune<span class="sc">::</span><span class="fu">tune</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>, <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>class_tree_spec <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">translate</span>()</span></code></pre></div>
<pre><code>&gt; Decision Tree Model Specification (classification)
&gt; 
&gt; Main Arguments:
&gt;   cost_complexity = tune::tune()
&gt;   tree_depth = 4
&gt; 
&gt; Engine-Specific Arguments:
&gt;   model = TRUE
&gt; 
&gt; Computational engine: rpart 
&gt; 
&gt; Model fit template:
&gt; rpart::rpart(formula = missing_arg(), data = missing_arg(), weights = missing_arg(), 
&gt;     cp = tune::tune(), maxdepth = 4, model = TRUE)</code></pre>
</div>
<div id="create-the-workflow" class="section level2">
<h2>Create the workflow</h2>
<p><a href="https://workflows.tidymodels.org/reference/workflow.html"><code>workflows::workflow</code></a>, <a href="https://workflows.tidymodels.org/reference/add_recipe.html"><code>workflows::add_recipe</code></a> and <a href="https://workflows.tidymodels.org/reference/add_model.html"><code>workflows::add_model</code></a> are used.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>class_tree_workflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_recipe</span>(class_tree_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_model</span>(class_tree_spec)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>class_tree_workflow</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: decision_tree()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; Decision Tree Model Specification (classification)
&gt; 
&gt; Main Arguments:
&gt;   cost_complexity = tune::tune()
&gt;   tree_depth = 4
&gt; 
&gt; Engine-Specific Arguments:
&gt;   model = TRUE
&gt; 
&gt; Computational engine: rpart</code></pre>
</div>
<div id="create-the-cost-complexity-grid" class="section level2">
<h2>Create the cost complexity grid</h2>
<p>A cost complexity grid of <span class="math inline">\(10\)</span> numbers from <span class="math inline">\(0.001\)</span> (<span class="math inline">\(10^{-3}\)</span>) to <span class="math inline">\(10\)</span> (<span class="math inline">\(10^1\)</span>) is created.</p>
<p>Regular grid is created using <a href="https://dials.tidymodels.org/reference/grid_regular.html"><code>dials::grid_regular</code></a>, <a href="https://dials.tidymodels.org/reference/trees.html"><code>dials::cost_complexity</code></a> and <a href="https://scales.r-lib.org/reference/log_trans.html"><code>scales::log10_trans</code></a></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a range from 10</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cost_complexity_grid <span class="ot">&lt;-</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  dials<span class="sc">::</span><span class="fu">grid_regular</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> dials<span class="sc">::</span><span class="fu">cost_complexity</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">log10_trans</span>()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="dv">10</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>cost_complexity_grid <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-8f836166d559454ecd73" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8f836166d559454ecd73">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cost_complexity":[0.001,0.00278255940220713,0.00774263682681127,0.0215443469003188,0.0599484250318941,0.166810053720006,0.464158883361278,1.29154966501488,3.59381366380463,10]},"columns":[{"accessor":"cost_complexity","name":"cost_complexity","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"ec32fc5a6dcf19231b7d34cc28d93022","key":"ec32fc5a6dcf19231b7d34cc28d93022"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="classification-tree-model-fitting-on-cross-validated-data" class="section level2">
<h2>Classification tree model fitting on cross validated data</h2>
<p>Now we have everything we need and we can fit all the models on the cross validated data with <a href="https://tune.tidymodels.org/reference/tune_grid.html"><code>tune::tune_grid</code></a>. Note that this process may take some time.</p>
<p>We use <a href="https://yardstick.tidymodels.org/reference/metric_set.html"><code>yardstick::metric_set</code></a>, to choose a set of metrics to used to evaluate the model. In this example, <a href="https://yardstick.tidymodels.org/reference/accuracy.html"><code>yardstick::accuracy</code></a>, <a href="https://yardstick.tidymodels.org/reference/roc_curve.html"><code>yardstick::roc_auc</code></a>, <a href="https://yardstick.tidymodels.org/reference/sens.html"><code>yardstick::sensitivity</code></a> and <a href="https://yardstick.tidymodels.org/reference/spec.html"><code>yardstick::specificity</code></a> are used.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>foreach<span class="sc">::</span><span class="fu">getDoParWorkers</span>()</span></code></pre></div>
<pre><code>&gt; [1] 3</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tune_res <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">tune_grid</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> class_tree_workflow,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> Carseats_fold,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> cost_complexity_grid,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    yardstick<span class="sc">::</span>accuracy,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    yardstick<span class="sc">::</span>roc_auc,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    yardstick<span class="sc">::</span>sensitivity,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    yardstick<span class="sc">::</span>specificity</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>tune_res</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; # Tuning results
&gt; # 10-fold cross-validation 
&gt; # A tibble: 10 x 4
&gt;    splits           id     .metrics          .notes          
&gt;    &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
&gt;  1 &lt;split [270/30]&gt; Fold01 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  2 &lt;split [270/30]&gt; Fold02 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  3 &lt;split [270/30]&gt; Fold03 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  4 &lt;split [270/30]&gt; Fold04 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  5 &lt;split [270/30]&gt; Fold05 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  6 &lt;split [270/30]&gt; Fold06 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  7 &lt;split [270/30]&gt; Fold07 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  8 &lt;split [270/30]&gt; Fold08 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  9 &lt;split [270/30]&gt; Fold09 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt; 10 &lt;split [270/30]&gt; Fold10 &lt;tibble [40 x 5]&gt; &lt;tibble [0 x 3]&gt;</code></pre>
<p>Here we see that the amount of cost complexity affects the performance metrics differently using <a href="https://tune.tidymodels.org/reference/autoplot.tune_results.html"><code>tune::autoplot</code></a>. Do note that using a different seed will give a different plot</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that a different seed will give different plots</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">autoplot</span>(tune_res)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-12-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>We can also see the raw metrics that created this chart by calling <a href="https://tune.tidymodels.org/reference/collect_predictions.html"><code>tune::collect_metrics()</code></a>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">collect_metrics</span>(tune_res) <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-0d7db73d03839427d3b7" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0d7db73d03839427d3b7">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cost_complexity":[0.001,0.001,0.001,0.001,0.00278255940220713,0.00278255940220713,0.00278255940220713,0.00278255940220713,0.00774263682681127,0.00774263682681127,0.00774263682681127,0.00774263682681127,0.0215443469003188,0.0215443469003188,0.0215443469003188,0.0215443469003188,0.0599484250318941,0.0599484250318941,0.0599484250318941,0.0599484250318941,0.166810053720006,0.166810053720006,0.166810053720006,0.166810053720006,0.464158883361278,0.464158883361278,0.464158883361278,0.464158883361278,1.29154966501488,1.29154966501488,1.29154966501488,1.29154966501488,3.59381366380463,3.59381366380463,3.59381366380463,3.59381366380463,10,10,10,10],".metric":["accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity","accuracy","roc_auc","sensitivity","specificity"],".estimator":["binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary"],"mean":[0.756666666666667,0.757987944925445,0.872274531024531,0.569206349206349,0.756666666666667,0.757987944925445,0.872274531024531,0.569206349206349,0.756666666666667,0.757987944925445,0.872274531024531,0.569206349206349,0.76,0.749320165945166,0.850151515151515,0.612460317460317,0.753333333333333,0.727181216931217,0.874493145743146,0.570039682539683,0.72,0.657537878787879,0.941801948051948,0.37327380952381,0.6,0.5,1,0,0.6,0.5,1,0,0.6,0.5,1,0,0.6,0.5,1,0],"n":[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],"std_err":[0.0233333333333333,0.0274999941498499,0.0192718375013116,0.0487654552209952,0.0233333333333333,0.0274999941498499,0.0192718375013116,0.0487654552209952,0.0233333333333333,0.0274999941498499,0.0192718375013116,0.0487654552209952,0.0226623089493013,0.0301082051917757,0.026452982697959,0.0474985689316899,0.0211986489203766,0.0261280954457643,0.0190416630119969,0.0405440542715783,0.0158698409523175,0.0231399830836185,0.0164681214357563,0.0439920328871715,0.0302254900194121,0,0,0,0.0302254900194121,0,0,0,0.0302254900194121,0,0,0,0.0302254900194121,0,0,0],".config":["Preprocessor1_Model01","Preprocessor1_Model01","Preprocessor1_Model01","Preprocessor1_Model01","Preprocessor1_Model02","Preprocessor1_Model02","Preprocessor1_Model02","Preprocessor1_Model02","Preprocessor1_Model03","Preprocessor1_Model03","Preprocessor1_Model03","Preprocessor1_Model03","Preprocessor1_Model04","Preprocessor1_Model04","Preprocessor1_Model04","Preprocessor1_Model04","Preprocessor1_Model05","Preprocessor1_Model05","Preprocessor1_Model05","Preprocessor1_Model05","Preprocessor1_Model06","Preprocessor1_Model06","Preprocessor1_Model06","Preprocessor1_Model06","Preprocessor1_Model07","Preprocessor1_Model07","Preprocessor1_Model07","Preprocessor1_Model07","Preprocessor1_Model08","Preprocessor1_Model08","Preprocessor1_Model08","Preprocessor1_Model08","Preprocessor1_Model09","Preprocessor1_Model09","Preprocessor1_Model09","Preprocessor1_Model09","Preprocessor1_Model10","Preprocessor1_Model10","Preprocessor1_Model10","Preprocessor1_Model10"]},"columns":[{"accessor":"cost_complexity","name":"cost_complexity","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"da059d0f3e94836de612a8a5cd5764d8","key":"da059d0f3e94836de612a8a5cd5764d8"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Here is the <code>ggplot</code> way should <a href="https://tune.tidymodels.org/reference/autoplot.tune_results.html"><code>tune::autoplot</code></a> fails</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tune_res <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;cost_complexity&quot;</span>]],</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;mean&quot;</span>]],</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> .data[[<span class="st">&quot;.metric&quot;</span>]]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_errorbar</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> .data[[<span class="st">&quot;mean&quot;</span>]] <span class="sc">-</span> .data[[<span class="st">&quot;std_err&quot;</span>]],</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> .data[[<span class="st">&quot;mean&quot;</span>]] <span class="sc">+</span> .data[[<span class="st">&quot;std_err&quot;</span>]]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">&quot;.metric&quot;</span>]]),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-14-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>Use <a href="https://tune.tidymodels.org/reference/show_best.html"><code>tune::show_best</code></a> to see the top few values for a given metric.</p>
<p>The “best” values can be selected using <a href="https://tune.tidymodels.org/reference/show_best.html"><code>tune::select_best</code></a>, this function requires you to specify a metric that it should select against. The cost complexity value is 0.001 for metric <code>accuracy</code> since it gives the highest value. Do note that using a different seed will give a different best cost complexity value.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>top_cost_complexity <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">show_best</span>(tune_res, <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>), <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>top_cost_complexity <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-c2e3fede5c798441fdae" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c2e3fede5c798441fdae">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cost_complexity":[0.0215443469003188,0.001,0.00278255940220713,0.00774263682681127,0.0599484250318941],".metric":["accuracy","accuracy","accuracy","accuracy","accuracy"],".estimator":["binary","binary","binary","binary","binary"],"mean":[0.76,0.756666666666667,0.756666666666667,0.756666666666667,0.753333333333333],"n":[10,10,10,10,10],"std_err":[0.0226623089493013,0.0233333333333333,0.0233333333333333,0.0233333333333333,0.0211986489203766],".config":["Preprocessor1_Model04","Preprocessor1_Model01","Preprocessor1_Model02","Preprocessor1_Model03","Preprocessor1_Model05"]},"columns":[{"accessor":"cost_complexity","name":"cost_complexity","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"5c41a985ced0dd8f69cf7acce9cdc9d8","key":"5c41a985ced0dd8f69cf7acce9cdc9d8"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>best_cost_complexity <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">select_best</span>(tune_res, <span class="at">metric =</span> <span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>best_cost_complexity</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; # A tibble: 1 x 2
&gt;   cost_complexity .config              
&gt;             &lt;dbl&gt; &lt;chr&gt;                
&gt; 1          0.0215 Preprocessor1_Model04</code></pre>
</div>
<div id="classification-tree-model-with-optimised-cost-complexity-value" class="section level2">
<h2>Classification tree model with optimised cost complexity value</h2>
<p>We create the classification tree workflow with the best cost complexity score using <a href="https://tune.tidymodels.org/reference/finalize_model.html"><code>tune::finalize_workflow</code></a>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>class_tree_final <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> class_tree_workflow,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> best_cost_complexity</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>class_tree_final</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: decision_tree()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; Decision Tree Model Specification (classification)
&gt; 
&gt; Main Arguments:
&gt;   cost_complexity = 0.0215443469003188
&gt;   tree_depth = 4
&gt; 
&gt; Engine-Specific Arguments:
&gt;   model = TRUE
&gt; 
&gt; Computational engine: rpart</code></pre>
<p>We now train the classification tree model with the training data using <a href="https://parsnip.tidymodels.org/reference/fit.html"><code>parsnip::fit</code></a></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>class_tree_final_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">object =</span> class_tree_final, <span class="at">data =</span> Carseats_train)</span></code></pre></div>
<p>We can see the tree in greater detail using <a href="https://tune.tidymodels.org/reference/extract-tune.html"><code>tune::extract_fit_engine</code></a></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>class_tree_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">extract_fit_engine</span>()</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; n= 300 
&gt; 
&gt; node), split, n, loss, yval, (yprob)
&gt;       * denotes terminal node
&gt; 
&gt;  1) root 300 120 No (0.6000000 0.4000000)  
&gt;    2) ShelveLoc=Bad,Medium 242  73 No (0.6983471 0.3016529)  
&gt;      4) Price&gt;=92.5 213  51 No (0.7605634 0.2394366)  
&gt;        8) Advertising&lt; 13.5 175  30 No (0.8285714 0.1714286) *
&gt;        9) Advertising&gt;=13.5 38  17 Yes (0.4473684 0.5526316)  
&gt;         18) Age&gt;=55.5 17   4 No (0.7647059 0.2352941) *
&gt;         19) Age&lt; 55.5 21   4 Yes (0.1904762 0.8095238) *
&gt;      5) Price&lt; 92.5 29   7 Yes (0.2413793 0.7586207) *
&gt;    3) ShelveLoc=Good 58  11 Yes (0.1896552 0.8103448)  
&gt;      6) Price&gt;=136.5 9   3 No (0.6666667 0.3333333) *
&gt;      7) Price&lt; 136.5 49   5 Yes (0.1020408 0.8979592) *</code></pre>
<p>We can visualise the above better with <code>rpart.plot::rpart.plot</code></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>class_tree_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-19-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
<div id="variable-importance" class="section level2">
<h2>Variable Importance</h2>
<p>What are the most important variables in this tree for predicting <code>Sales</code>?</p>
<p>Using the <code>vip</code> package and <a href="https://workflows.tidymodels.org/reference/extract-workflow.html"><code>workflows::extract_fit_parsnip</code></a>, we have</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>vip_table <span class="ot">&lt;-</span> class_tree_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vi</span>()</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>vip_table <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-a77ad32f6b82562872f5" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a77ad32f6b82562872f5">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Variable":["ShelveLoc","Price","Advertising","Age","CompPrice","Population","Income"],"Importance":[24.213736107153,19.3374159827012,10.8959513164704,6.19563614919652,3.46585156298981,1.82224592623427,1.51082576448459]},"columns":[{"accessor":"Variable","name":"Variable","type":"character"},{"accessor":"Importance","name":"Importance","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"9d812d7477de1303d0d29aac870c1687","key":"9d812d7477de1303d0d29aac870c1687"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>class_tree_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;col&quot;</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">aesthetics =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">&quot;midnightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-21-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>We can use <a href="https://github.com/grantmcdermott/parttree"><code>parttree</code></a> to understand why these two parameters work so well on the training set.</p>
<p>However this package only works with two continuous predictors. As <code>ShelveLoc</code> is a categorical variable, there is a need to “convert” them to continuous by making “Bad” as -1, “Medium” as 0 and “Good” as 1.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Carseats_train_modfified <span class="ot">&lt;-</span> Carseats_train <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ShelveLoc =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      .data[[<span class="st">&quot;ShelveLoc&quot;</span>]] <span class="sc">==</span> <span class="st">&quot;Bad&quot;</span> <span class="sc">~</span> <span class="st">&quot;-1&quot;</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>      .data[[<span class="st">&quot;ShelveLoc&quot;</span>]] <span class="sc">==</span> <span class="st">&quot;Medium&quot;</span> <span class="sc">~</span> <span class="st">&quot;0&quot;</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      .data[[<span class="st">&quot;ShelveLoc&quot;</span>]] <span class="sc">==</span> <span class="st">&quot;Good&quot;</span> <span class="sc">~</span> <span class="st">&quot;1&quot;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ShelveLoc =</span> <span class="fu">as.numeric</span>(.data[[<span class="st">&quot;ShelveLoc&quot;</span>]])</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>partial_tree <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">decision_tree</span>(</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="dv">30</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost_complexity =</span> best_cost_complexity<span class="sc">$</span>cost_complexity</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>, <span class="at">model =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">fit</span>(High <span class="sc">~</span> Price <span class="sc">+</span> ShelveLoc,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Carseats_train_modfified</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">extract_fit_engine</span>()</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>Carseats_train_modfified <span class="sc">%&gt;%</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> .data[[<span class="st">&quot;ShelveLoc&quot;</span>]],</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> .data[[<span class="st">&quot;Price&quot;</span>]]</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  parttree<span class="sc">::</span><span class="fu">geom_parttree</span>(</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> partial_tree,</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> .data[[<span class="st">&quot;High&quot;</span>]]),</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_jitter</span>(</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.05</span>,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fl">0.2</span>,</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> .data[[<span class="st">&quot;High&quot;</span>]])</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-22-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
<div id="classification-tree-model-on-test-data" class="section level2">
<h2>Classification tree model on test data</h2>
<p>Finally, let’s turn to the testing data. For classification models, a <code>.pred_class</code>, column and class probability columns named .pred_{level} are added when <a href="https://parsnip.tidymodels.org/reference/augment.html"><code>parsnip::augment</code></a> is used.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> class_tree_final_fit,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_data =</span> Carseats_test</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-e3479f292a01744eb530" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e3479f292a01744eb530">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"CompPrice":[138,113,141,136,132,121,147,125,128,136,122,123,85,141,126,157,143,119,127,126,149,118,113,116,97,145,115,132,116,130,131,153,133,108,132,146,122,121,98,143,119,106,138,104,120,156,139,130,112,138,155,162,125,145,141,136,98,115,132,137,141,151,121,120,137,139,129,120,111,116,114,141,150,95,118,148,108,138,131,142,100,93,130,140,138,121,132,133,131,131,109,141,121,131,152,128,153,138,139,134],"Income":[73,35,64,81,110,78,74,90,46,58,76,42,79,63,98,93,81,88,92,61,69,71,100,72,46,30,65,118,99,94,113,68,100,69,31,62,88,120,72,21,67,73,107,71,51,42,70,28,80,83,80,67,41,69,33,119,104,60,69,80,34,28,24,56,105,111,117,77,56,106,113,57,96,44,70,76,77,92,111,30,54,117,38,29,80,68,102,103,25,55,22,60,28,73,116,42,63,108,23,37],"Advertising":[11,10,3,15,0,9,13,2,6,16,0,11,6,0,0,0,5,10,0,14,20,12,16,0,11,0,0,12,5,8,0,2,3,3,0,10,7,13,0,5,17,0,9,14,0,13,7,6,5,0,0,0,2,19,0,6,0,0,0,10,16,8,0,20,10,5,8,15,0,8,2,13,0,4,0,3,13,0,13,0,9,9,0,0,0,0,20,14,10,0,10,19,19,13,0,8,0,17,3,0],"Population":[276,269,340,425,108,150,251,367,497,241,270,16,325,168,173,51,60,170,508,152,366,44,353,237,267,67,217,272,298,137,181,60,350,208,327,310,36,140,59,81,151,216,480,89,93,170,71,410,500,139,237,27,357,501,243,178,404,119,123,24,361,499,200,266,435,310,400,86,504,244,129,376,80,208,106,126,388,13,33,472,433,489,283,105,108,279,459,288,183,26,348,319,315,455,170,328,49,203,37,27],"Price":[120,80,128,120,124,100,131,131,138,131,100,134,95,135,108,149,154,101,91,115,134,89,79,128,107,104,90,151,125,128,120,133,126,94,131,94,159,87,69,160,137,93,154,81,86,173,96,133,128,134,124,160,123,105,144,145,72,114,122,105,108,135,133,90,156,132,101,132,110,86,151,158,154,72,89,99,110,120,80,136,89,83,102,91,126,149,107,122,104,110,79,92,121,132,160,107,124,128,120,120],"ShelveLoc":["Bad","Medium","Bad","Good","Medium","Bad","Good","Medium","Medium","Medium","Good","Medium","Medium","Bad","Bad","Good","Medium","Medium","Medium","Medium","Good","Medium","Bad","Good","Medium","Medium","Medium","Medium","Good","Medium","Good","Good","Bad","Medium","Medium","Medium","Bad","Medium","Medium","Medium","Medium","Medium","Medium","Medium","Medium","Good","Good","Bad","Medium","Medium","Medium","Medium","Bad","Medium","Medium","Medium","Medium","Bad","Medium","Good","Medium","Medium","Good","Bad","Good","Bad","Bad","Medium","Medium","Medium","Good","Medium","Good","Bad","Bad","Good","Bad","Bad","Bad","Good","Good","Bad","Medium","Bad","Good","Good","Good","Good","Medium","Bad","Good","Good","Medium","Medium","Medium","Medium","Bad","Good","Medium","Good"],"Age":[42,59,38,67,76,26,52,35,42,44,60,59,69,44,55,32,61,61,56,47,60,67,68,70,80,55,60,43,62,64,63,59,55,77,76,30,28,56,65,67,55,60,47,25,46,74,61,72,69,54,37,77,47,45,34,35,27,38,27,61,69,48,73,78,72,62,36,48,62,58,40,64,61,44,39,60,74,61,68,80,45,42,80,43,70,79,49,61,56,79,74,44,66,62,39,35,56,33,55,49],"Education":[17,12,13,10,10,10,10,18,13,18,18,13,13,12,16,17,18,13,18,16,13,18,11,13,15,17,17,14,12,12,14,16,13,16,16,13,17,11,16,12,11,13,11,14,17,14,10,16,10,18,14,17,14,11,17,13,18,14,11,15,10,10,13,18,14,13,10,18,16,12,15,18,11,17,17,11,14,12,18,15,12,13,15,16,13,12,11,17,15,12,14,11,14,17,16,12,16,14,11,16],"Urban":["Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes"],"US":["Yes","Yes","No","Yes","No","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes","No","No","Yes","Yes","No","Yes","Yes","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","No","Yes","Yes","No","No","Yes","Yes","Yes","No","Yes","Yes","No","Yes","Yes","No","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","Yes","No","No","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","Yes","Yes","No","Yes","No","Yes","Yes","No","No","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","Yes","Yes","Yes"],"High":["Yes","Yes","No","Yes","No","Yes","Yes","No","No","Yes","Yes","No","No","No","No","Yes","No","Yes","Yes","Yes","Yes","No","Yes","No","No","Yes","Yes","No","No","No","Yes","Yes","No","No","No","Yes","No","Yes","No","No","No","No","No","Yes","Yes","No","Yes","No","No","No","Yes","No","No","Yes","No","No","Yes","No","Yes","Yes","Yes","Yes","No","No","Yes","No","No","No","No","Yes","No","No","No","No","No","Yes","No","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","Yes","Yes","No","Yes","Yes","No","No","No","Yes","No","Yes","No","Yes"],".pred_class":["No","Yes","No","Yes","No","No","Yes","No","No","Yes","Yes","No","No","No","No","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","No","No","Yes","No","Yes","No","Yes","Yes","No","No","No","No","No","Yes","Yes","No","Yes","No","No","Yes","Yes","No","Yes","No","No","No","No","No","No","Yes","No","No","Yes","No","No","Yes","No","No","Yes","Yes","No","No","No","Yes","No","Yes","No","No","No","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","No","Yes","Yes","No","Yes","Yes","No","No","Yes","Yes","No","No","No","No","No","Yes","No","Yes"],".pred_No":[0.828571428571429,0.241379310344828,0.828571428571429,0.102040816326531,0.828571428571429,0.828571428571429,0.102040816326531,0.828571428571429,0.828571428571429,0.19047619047619,0.102040816326531,0.828571428571429,0.828571428571429,0.828571428571429,0.828571428571429,0.666666666666667,0.828571428571429,0.828571428571429,0.241379310344828,0.19047619047619,0.102040816326531,0.241379310344828,0.241379310344828,0.102040816326531,0.828571428571429,0.828571428571429,0.241379310344828,0.828571428571429,0.102040816326531,0.828571428571429,0.102040816326531,0.102040816326531,0.828571428571429,0.828571428571429,0.828571428571429,0.828571428571429,0.828571428571429,0.241379310344828,0.241379310344828,0.828571428571429,0.19047619047619,0.828571428571429,0.828571428571429,0.241379310344828,0.241379310344828,0.666666666666667,0.102040816326531,0.828571428571429,0.828571428571429,0.828571428571429,0.828571428571429,0.828571428571429,0.828571428571429,0.19047619047619,0.828571428571429,0.828571428571429,0.241379310344828,0.828571428571429,0.828571428571429,0.102040816326531,0.764705882352941,0.828571428571429,0.102040816326531,0.241379310344828,0.666666666666667,0.828571428571429,0.828571428571429,0.19047619047619,0.828571428571429,0.241379310344828,0.666666666666667,0.828571428571429,0.666666666666667,0.241379310344828,0.241379310344828,0.102040816326531,0.828571428571429,0.828571428571429,0.241379310344828,0.102040816326531,0.102040816326531,0.241379310344828,0.828571428571429,0.241379310344828,0.102040816326531,0.666666666666667,0.102040816326531,0.102040816326531,0.828571428571429,0.828571428571429,0.102040816326531,0.102040816326531,0.764705882352941,0.828571428571429,0.828571428571429,0.828571428571429,0.828571428571429,0.102040816326531,0.828571428571429,0.102040816326531],".pred_Yes":[0.171428571428571,0.758620689655172,0.171428571428571,0.897959183673469,0.171428571428571,0.171428571428571,0.897959183673469,0.171428571428571,0.171428571428571,0.80952380952381,0.897959183673469,0.171428571428571,0.171428571428571,0.171428571428571,0.171428571428571,0.333333333333333,0.171428571428571,0.171428571428571,0.758620689655172,0.80952380952381,0.897959183673469,0.758620689655172,0.758620689655172,0.897959183673469,0.171428571428571,0.171428571428571,0.758620689655172,0.171428571428571,0.897959183673469,0.171428571428571,0.897959183673469,0.897959183673469,0.171428571428571,0.171428571428571,0.171428571428571,0.171428571428571,0.171428571428571,0.758620689655172,0.758620689655172,0.171428571428571,0.80952380952381,0.171428571428571,0.171428571428571,0.758620689655172,0.758620689655172,0.333333333333333,0.897959183673469,0.171428571428571,0.171428571428571,0.171428571428571,0.171428571428571,0.171428571428571,0.171428571428571,0.80952380952381,0.171428571428571,0.171428571428571,0.758620689655172,0.171428571428571,0.171428571428571,0.897959183673469,0.235294117647059,0.171428571428571,0.897959183673469,0.758620689655172,0.333333333333333,0.171428571428571,0.171428571428571,0.80952380952381,0.171428571428571,0.758620689655172,0.333333333333333,0.171428571428571,0.333333333333333,0.758620689655172,0.758620689655172,0.897959183673469,0.171428571428571,0.171428571428571,0.758620689655172,0.897959183673469,0.897959183673469,0.758620689655172,0.171428571428571,0.758620689655172,0.897959183673469,0.333333333333333,0.897959183673469,0.897959183673469,0.171428571428571,0.171428571428571,0.897959183673469,0.897959183673469,0.235294117647059,0.171428571428571,0.171428571428571,0.171428571428571,0.171428571428571,0.897959183673469,0.171428571428571,0.897959183673469]},"columns":[{"accessor":"CompPrice","name":"CompPrice","type":"numeric"},{"accessor":"Income","name":"Income","type":"numeric"},{"accessor":"Advertising","name":"Advertising","type":"numeric"},{"accessor":"Population","name":"Population","type":"numeric"},{"accessor":"Price","name":"Price","type":"numeric"},{"accessor":"ShelveLoc","name":"ShelveLoc","type":"factor"},{"accessor":"Age","name":"Age","type":"numeric"},{"accessor":"Education","name":"Education","type":"numeric"},{"accessor":"Urban","name":"Urban","type":"factor"},{"accessor":"US","name":"US","type":"factor"},{"accessor":"High","name":"High","type":"factor"},{"accessor":".pred_class","name":".pred_class","type":"factor"},{"accessor":".pred_No","name":".pred_No","type":"numeric"},{"accessor":".pred_Yes","name":".pred_Yes","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"b111add0c44186250c29e2f74c20d49f","key":"b111add0c44186250c29e2f74c20d49f"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>We can view the confusion matrix using <a href="https://yardstick.tidymodels.org/reference/conf_mat.html"><code>yardstick::conf_mat</code></a></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> .data[[<span class="st">&quot;High&quot;</span>]],</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> .data[[<span class="st">&quot;.pred_class&quot;</span>]]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">&quot;heatmap&quot;</span>)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-24-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(<span class="at">truth =</span> .data[[<span class="st">&quot;High&quot;</span>]], <span class="at">estimate =</span> .data[[<span class="st">&quot;.pred_class&quot;</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-65b7328530dcdf303887" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-65b7328530dcdf303887">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["accuracy","kap","sens","spec","ppv","npv","mcc","j_index","bal_accuracy","detection_prevalence","precision","recall","f_meas"],".estimator":["binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary"],".estimate":[0.73,0.450772986167616,0.767857142857143,0.681818181818182,0.754385964912281,0.697674418604651,0.450866276994441,0.449675324675325,0.724837662337662,0.57,0.754385964912281,0.767857142857143,0.761061946902655]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"dbcbc7c31cc69182b775814015a82cff","key":"dbcbc7c31cc69182b775814015a82cff"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>or by <code>ConfusionTableR::binary_visualiseR</code></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ConfusionTableR<span class="sc">::</span><span class="fu">binary_visualiseR</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_labels =</span> test_results[[<span class="st">&quot;High&quot;</span>]],</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">truth_labels =</span> test_results[[<span class="st">&quot;.pred_class&quot;</span>]],</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_label1 =</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_label2 =</span> <span class="st">&quot;No&quot;</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">quadrant_col1 =</span> <span class="st">&quot;#28ACB4&quot;</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">quadrant_col2 =</span> <span class="st">&quot;#4397D2&quot;</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">custom_title =</span> <span class="st">&quot;High Confusion Matrix&quot;</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">text_col =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-26-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>We can view the ROC curve using <a href="https://yardstick.tidymodels.org/reference/roc_curve.html"><code>yardstick::roc_curve</code></a></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>roc_plot_data <span class="ot">&lt;-</span> test_results <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> test_results[[<span class="st">&quot;High&quot;</span>]],</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    .data[[<span class="st">&quot;.pred_No&quot;</span>]]</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>roc_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-1990be7a07e95fee1522" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1990be7a07e95fee1522">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".threshold":["-Inf",0.102040816326531,0.19047619047619,0.241379310344828,0.666666666666667,0.764705882352941,0.828571428571429,"Inf"],"specificity":[0,0,0.386363636363636,0.454545454545455,0.681818181818182,0.727272727272727,0.75,1],"sensitivity":[1,1,0.928571428571429,0.892857142857143,0.767857142857143,0.696428571428571,0.678571428571429,0]},"columns":[{"accessor":".threshold","name":".threshold","type":"numeric"},{"accessor":"specificity","name":"specificity","type":"numeric"},{"accessor":"sensitivity","name":"sensitivity","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"b05f4cd98f5888d786362add1d8c80b4","key":"b05f4cd98f5888d786362add1d8c80b4"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>roc_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-28-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>Here is a <code>ggplot2</code> version.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>roc_plot_data <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> .data[[<span class="st">&quot;specificity&quot;</span>]],</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;sensitivity&quot;</span>]]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.2</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_equal</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-29-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>To view the metrics, we can also use <a href="https://tune.tidymodels.org/reference/last_fit.html"><code>tune::last_fit</code></a> and <a href="https://tune.tidymodels.org/reference/collect_predictions.html"><code>tune::collect_metrics</code></a>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>metrics_results <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">last_fit</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> class_tree_final_fit,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">split =</span> Carseats_split</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">collect_metrics</span>()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>metrics_results <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-28cf82553809b695f76c" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-28cf82553809b695f76c">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["accuracy","roc_auc"],".estimator":["binary","binary"],".estimate":[0.73,0.757102272727273],".config":["Preprocessor1_Model1","Preprocessor1_Model1"]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"da70ffde23a71fc2d52bb0a57209c745","key":"da70ffde23a71fc2d52bb0a57209c745"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="fitting-regression-trees" class="section level1">
<h1>Fitting Regression Trees</h1>
<p>In the <a href="https://www.cs.toronto.edu/~delve/data/boston/bostonDetail.html"><code>Boston</code></a> data set, we want to predict <code>medv</code>, the median value of owner-occupied homes in $1000’s.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>Boston <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>(ISLR2<span class="sc">::</span>Boston)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>Boston <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">defaultPageSize =</span> <span class="dv">5</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">filterable =</span> <span class="cn">TRUE</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div id="htmlwidget-988252b1f4f7d9d645fb" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-988252b1f4f7d9d645fb">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"crim":[0.00632,0.02731,0.02729,0.03237,0.06905,0.02985,0.08829,0.14455,0.21124,0.17004,0.22489,0.11747,0.09378,0.62976,0.63796,0.62739,1.05393,0.7842,0.80271,0.7258,1.25179,0.85204,1.23247,0.98843,0.75026,0.84054,0.67191,0.95577,0.77299,1.00245,1.13081,1.35472,1.38799,1.15172,1.61282,0.06417,0.09744,0.08014,0.17505,0.02763,0.03359,0.12744,0.1415,0.15936,0.12269,0.17142,0.18836,0.22927,0.25387,0.21977,0.08873,0.04337,0.0536,0.04981,0.0136,0.01311,0.02055,0.01432,0.15445,0.10328,0.14932,0.17171,0.11027,0.1265,0.01951,0.03584,0.04379,0.05789,0.13554,0.12816,0.08826,0.15876,0.09164,0.19539,0.07896,0.09512,0.10153,0.08707,0.05646,0.08387,0.04113,0.04462,0.03659,0.03551,0.05059,0.05735,0.05188,0.07151,0.0566,0.05302,0.04684,0.03932,0.04203,0.02875,0.04294,0.12204,0.11504,0.12083,0.08187,0.0686,0.14866,0.11432,0.22876,0.21161,0.1396,0.13262,0.1712,0.13117,0.12802,0.26363,0.10793,0.10084,0.12329,0.22212,0.14231,0.17134,0.13158,0.15098,0.13058,0.14476,0.06899,0.07165,0.09299,0.15038,0.09849,0.16902,0.38735,0.25915,0.32543,0.88125,0.34006,1.19294,0.59005,0.32982,0.97617,0.55778,0.32264,0.35233,0.2498,0.54452,0.2909,1.62864,3.32105,4.0974,2.77974,2.37934,2.15505,2.36862,2.33099,2.73397,1.6566,1.49632,1.12658,2.14918,1.41385,3.53501,2.44668,1.22358,1.34284,1.42502,1.27346,1.46336,1.83377,1.51902,2.24236,2.924,2.01019,1.80028,2.3004,2.44953,1.20742,2.3139,0.13914,0.09178,0.08447,0.06664,0.07022,0.05425,0.06642,0.0578,0.06588,0.06888,0.09103,0.10008,0.08308,0.06047,0.05602,0.07875,0.12579,0.0837,0.09068,0.06911,0.08664,0.02187,0.01439,0.01381,0.04011,0.04666,0.03768,0.0315,0.01778,0.03445,0.02177,0.0351,0.02009,0.13642,0.22969,0.25199,0.13587,0.43571,0.17446,0.37578,0.21719,0.14052,0.28955,0.19802,0.0456,0.07013,0.11069,0.11425,0.35809,0.40771,0.62356,0.6147,0.31533,0.52693,0.38214,0.41238,0.29819,0.44178,0.537,0.46296,0.57529,0.33147,0.44791,0.33045,0.52058,0.51183,0.08244,0.09252,0.11329,0.10612,0.1029,0.12757,0.20608,0.19133,0.33983,0.19657,0.16439,0.19073,0.1403,0.21409,0.08221,0.36894,0.04819,0.03548,0.01538,0.61154,0.66351,0.65665,0.54011,0.53412,0.52014,0.82526,0.55007,0.76162,0.7857,0.57834,0.5405,0.09065,0.29916,0.16211,0.1146,0.22188,0.05644,0.09604,0.10469,0.06127,0.07978,0.21038,0.03578,0.03705,0.06129,0.01501,0.00906,0.01096,0.01965,0.03871,0.0459,0.04297,0.03502,0.07886,0.03615,0.08265,0.08199,0.12932,0.05372,0.14103,0.06466,0.05561,0.04417,0.03537,0.09266,0.1,0.05515,0.05479,0.07503,0.04932,0.49298,0.3494,2.63548,0.79041,0.26169,0.26938,0.3692,0.25356,0.31827,0.24522,0.40202,0.47547,0.1676,0.18159,0.35114,0.28392,0.34109,0.19186,0.30347,0.24103,0.06617,0.06724,0.04544,0.05023,0.03466,0.05083,0.03738,0.03961,0.03427,0.03041,0.03306,0.05497,0.06151,0.01301,0.02498,0.02543,0.03049,0.03113,0.06162,0.0187,0.01501,0.02899,0.06211,0.0795,0.07244,0.01709,0.04301,0.10659,8.98296,3.8497,5.20177,4.26131,4.54192,3.83684,3.67822,4.22239,3.47428,4.55587,3.69695,13.5222,4.89822,5.66998,6.53876,9.2323,8.26725,11.1081,18.4982,19.6091,15.288,9.82349,23.6482,17.8667,88.9762,15.8744,9.18702,7.99248,20.0849,16.8118,24.3938,22.5971,14.3337,8.15174,6.96215,5.29305,11.5779,8.64476,13.3598,8.71675,5.87205,7.67202,38.3518,9.91655,25.0461,14.2362,9.59571,24.8017,41.5292,67.9208,20.7162,11.9511,7.40389,14.4383,51.1358,14.0507,18.811,28.6558,45.7461,18.0846,10.8342,25.9406,73.5341,11.8123,11.0874,7.02259,12.0482,7.05042,8.79212,15.8603,12.2472,37.6619,7.36711,9.33889,8.49213,10.0623,6.44405,5.58107,13.9134,11.1604,14.4208,15.1772,13.6781,9.39063,22.0511,9.72418,5.66637,9.96654,12.8023,10.6718,6.28807,9.92485,9.32909,7.52601,6.71772,5.44114,5.09017,8.24809,9.51363,4.75237,4.66883,8.20058,7.75223,6.80117,4.81213,3.69311,6.65492,5.82115,7.83932,3.1636,3.77498,4.42228,15.5757,13.0751,4.34879,4.03841,3.56868,4.64689,8.05579,6.39312,4.87141,15.0234,10.233,14.3337,5.82401,5.70818,5.73116,2.81838,2.37857,3.67367,5.69175,4.83567,0.15086,0.18337,0.20746,0.10574,0.11132,0.17331,0.27957,0.17899,0.2896,0.26838,0.23912,0.17783,0.22438,0.06263,0.04527,0.06076,0.10959,0.04741],"zn":[18,0,0,0,0,0,12.5,12.5,12.5,12.5,12.5,12.5,12.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,75,75,0,0,0,0,0,0,0,0,0,21,21,21,21,75,90,85,100,25,25,25,25,25,25,17.5,80,80,12.5,12.5,12.5,0,0,0,0,0,0,0,0,0,0,25,25,25,25,0,0,0,0,0,0,0,0,28,28,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,45,45,45,45,45,60,60,80,80,80,80,95,95,82.5,82.5,95,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,30,30,30,30,30,22,22,22,22,22,22,22,22,22,22,80,80,90,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,40,40,40,40,40,20,20,20,20,90,90,55,80,52.5,52.5,52.5,80,80,80,0,0,0,0,0,70,70,70,34,34,34,33,33,33,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,35,0,0,0,0,0,0,0,0,35,0,55,55,0,0,85,80,40,40,60,60,90,80,80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"indus":[2.31,7.07,7.07,2.18,2.18,2.18,7.87,7.87,7.87,7.87,7.87,7.87,7.87,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,8.14,5.96,5.96,5.96,5.96,2.95,2.95,6.91,6.91,6.91,6.91,6.91,6.91,6.91,6.91,6.91,5.64,5.64,5.64,5.64,4,1.22,0.74,1.32,5.13,5.13,5.13,5.13,5.13,5.13,1.38,3.37,3.37,6.07,6.07,6.07,10.81,10.81,10.81,10.81,12.83,12.83,12.83,12.83,12.83,12.83,4.86,4.86,4.86,4.86,4.49,4.49,4.49,4.49,3.41,3.41,3.41,3.41,15.04,15.04,15.04,2.89,2.89,2.89,2.89,2.89,8.56,8.56,8.56,8.56,8.56,8.56,8.56,8.56,8.56,8.56,8.56,10.01,10.01,10.01,10.01,10.01,10.01,10.01,10.01,10.01,25.65,25.65,25.65,25.65,25.65,25.65,25.65,21.89,21.89,21.89,21.89,21.89,21.89,21.89,21.89,21.89,21.89,21.89,21.89,21.89,21.89,21.89,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,19.58,4.05,4.05,4.05,4.05,4.05,4.05,4.05,2.46,2.46,2.46,2.46,2.46,2.46,2.46,2.46,3.44,3.44,3.44,3.44,3.44,3.44,2.93,2.93,0.46,1.52,1.52,1.52,1.47,1.47,2.03,2.03,2.68,2.68,10.59,10.59,10.59,10.59,10.59,10.59,10.59,10.59,10.59,10.59,10.59,13.89,13.89,13.89,13.89,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,6.2,4.93,4.93,4.93,4.93,4.93,4.93,5.86,5.86,5.86,5.86,5.86,5.86,5.86,5.86,5.86,5.86,3.64,3.64,3.75,3.97,3.97,3.97,3.97,3.97,3.97,3.97,3.97,3.97,3.97,3.97,3.97,6.96,6.96,6.96,6.96,6.96,6.41,6.41,6.41,6.41,6.41,3.33,3.33,3.33,3.33,1.21,2.97,2.25,1.76,5.32,5.32,5.32,4.95,4.95,4.95,13.92,13.92,13.92,13.92,13.92,2.24,2.24,2.24,6.09,6.09,6.09,2.18,2.18,2.18,2.18,9.9,9.9,9.9,9.9,9.9,9.9,9.9,9.9,9.9,9.9,9.9,9.9,7.38,7.38,7.38,7.38,7.38,7.38,7.38,7.38,3.24,3.24,3.24,6.06,6.06,5.19,5.19,5.19,5.19,5.19,5.19,5.19,5.19,1.52,1.89,3.78,3.78,4.39,4.39,4.15,2.01,1.25,1.25,1.69,1.69,2.02,1.91,1.91,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,27.74,27.74,27.74,27.74,27.74,9.69,9.69,9.69,9.69,9.69,9.69,9.69,9.69,11.93,11.93,11.93,11.93,11.93],"chas":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"nox":[0.538,0.469,0.469,0.458,0.458,0.458,0.524,0.524,0.524,0.524,0.524,0.524,0.524,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.538,0.499,0.499,0.499,0.499,0.428,0.428,0.448,0.448,0.448,0.448,0.448,0.448,0.448,0.448,0.448,0.439,0.439,0.439,0.439,0.41,0.403,0.41,0.411,0.453,0.453,0.453,0.453,0.453,0.453,0.4161,0.398,0.398,0.409,0.409,0.409,0.413,0.413,0.413,0.413,0.437,0.437,0.437,0.437,0.437,0.437,0.426,0.426,0.426,0.426,0.449,0.449,0.449,0.449,0.489,0.489,0.489,0.489,0.464,0.464,0.464,0.445,0.445,0.445,0.445,0.445,0.52,0.52,0.52,0.52,0.52,0.52,0.52,0.52,0.52,0.52,0.52,0.547,0.547,0.547,0.547,0.547,0.547,0.547,0.547,0.547,0.581,0.581,0.581,0.581,0.581,0.581,0.581,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.624,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.871,0.605,0.605,0.871,0.605,0.605,0.605,0.605,0.605,0.605,0.605,0.605,0.605,0.605,0.605,0.605,0.51,0.51,0.51,0.51,0.51,0.51,0.51,0.488,0.488,0.488,0.488,0.488,0.488,0.488,0.488,0.437,0.437,0.437,0.437,0.437,0.437,0.401,0.401,0.422,0.404,0.404,0.404,0.403,0.403,0.415,0.415,0.4161,0.4161,0.489,0.489,0.489,0.489,0.489,0.489,0.489,0.489,0.489,0.489,0.489,0.55,0.55,0.55,0.55,0.507,0.507,0.507,0.507,0.504,0.504,0.504,0.504,0.504,0.504,0.504,0.504,0.507,0.507,0.507,0.507,0.507,0.507,0.428,0.428,0.428,0.428,0.428,0.428,0.431,0.431,0.431,0.431,0.431,0.431,0.431,0.431,0.431,0.431,0.392,0.392,0.394,0.647,0.647,0.647,0.647,0.647,0.647,0.647,0.647,0.647,0.647,0.575,0.575,0.464,0.464,0.464,0.464,0.464,0.447,0.447,0.447,0.447,0.447,0.4429,0.4429,0.4429,0.4429,0.401,0.4,0.389,0.385,0.405,0.405,0.405,0.411,0.411,0.411,0.437,0.437,0.437,0.437,0.437,0.4,0.4,0.4,0.433,0.433,0.433,0.472,0.472,0.472,0.472,0.544,0.544,0.544,0.544,0.544,0.544,0.544,0.544,0.544,0.544,0.544,0.544,0.493,0.493,0.493,0.493,0.493,0.493,0.493,0.493,0.46,0.46,0.46,0.4379,0.4379,0.515,0.515,0.515,0.515,0.515,0.515,0.515,0.515,0.442,0.518,0.484,0.484,0.442,0.442,0.429,0.435,0.429,0.429,0.411,0.411,0.41,0.413,0.413,0.77,0.77,0.77,0.77,0.77,0.77,0.77,0.77,0.718,0.718,0.718,0.631,0.631,0.631,0.631,0.631,0.668,0.668,0.668,0.671,0.671,0.671,0.671,0.671,0.671,0.671,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.693,0.693,0.693,0.693,0.693,0.693,0.693,0.693,0.693,0.693,0.693,0.693,0.693,0.659,0.659,0.597,0.597,0.597,0.597,0.597,0.597,0.693,0.679,0.679,0.679,0.679,0.718,0.718,0.718,0.614,0.614,0.584,0.679,0.584,0.679,0.679,0.679,0.584,0.584,0.584,0.713,0.713,0.74,0.74,0.74,0.74,0.74,0.74,0.74,0.74,0.74,0.74,0.74,0.74,0.74,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.713,0.655,0.655,0.655,0.584,0.58,0.58,0.58,0.532,0.58,0.614,0.584,0.584,0.614,0.614,0.614,0.614,0.532,0.532,0.532,0.532,0.583,0.583,0.583,0.583,0.609,0.609,0.609,0.609,0.609,0.585,0.585,0.585,0.585,0.585,0.585,0.585,0.585,0.573,0.573,0.573,0.573,0.573],"rm":[6.575,6.421,7.185,6.998,7.147,6.43,6.012,6.172,5.631,6.004,6.377,6.009,5.889,5.949,6.096,5.834,5.935,5.99,5.456,5.727,5.57,5.965,6.142,5.813,5.924,5.599,5.813,6.047,6.495,6.674,5.713,6.072,5.95,5.701,6.096,5.933,5.841,5.85,5.966,6.595,7.024,6.77,6.169,6.211,6.069,5.682,5.786,6.03,5.399,5.602,5.963,6.115,6.511,5.998,5.888,7.249,6.383,6.816,6.145,5.927,5.741,5.966,6.456,6.762,7.104,6.29,5.787,5.878,5.594,5.885,6.417,5.961,6.065,6.245,6.273,6.286,6.279,6.14,6.232,5.874,6.727,6.619,6.302,6.167,6.389,6.63,6.015,6.121,7.007,7.079,6.417,6.405,6.442,6.211,6.249,6.625,6.163,8.069,7.82,7.416,6.727,6.781,6.405,6.137,6.167,5.851,5.836,6.127,6.474,6.229,6.195,6.715,5.913,6.092,6.254,5.928,6.176,6.021,5.872,5.731,5.87,6.004,5.961,5.856,5.879,5.986,5.613,5.693,6.431,5.637,6.458,6.326,6.372,5.822,5.757,6.335,5.942,6.454,5.857,6.151,6.174,5.019,5.403,5.468,4.903,6.13,5.628,4.926,5.186,5.597,6.122,5.404,5.012,5.709,6.129,6.152,5.272,6.943,6.066,6.51,6.25,7.489,7.802,8.375,5.854,6.101,7.929,5.877,6.319,6.402,5.875,5.88,5.572,6.416,5.859,6.546,6.02,6.315,6.86,6.98,7.765,6.144,7.155,6.563,5.604,6.153,7.831,6.782,6.556,7.185,6.951,6.739,7.178,6.8,6.604,7.875,7.287,7.107,7.274,6.975,7.135,6.162,7.61,7.853,8.034,5.891,6.326,5.783,6.064,5.344,5.96,5.404,5.807,6.375,5.412,6.182,5.888,6.642,5.951,6.373,6.951,6.164,6.879,6.618,8.266,8.725,8.04,7.163,7.686,6.552,5.981,7.412,8.337,8.247,6.726,6.086,6.631,7.358,6.481,6.606,6.897,6.095,6.358,6.393,5.593,5.605,6.108,6.226,6.433,6.718,6.487,6.438,6.957,8.259,6.108,5.876,7.454,8.704,7.333,6.842,7.203,7.52,8.398,7.327,7.206,5.56,7.014,8.297,7.47,5.92,5.856,6.24,6.538,7.691,6.758,6.854,7.267,6.826,6.482,6.812,7.82,6.968,7.645,7.923,7.088,6.453,6.23,6.209,6.315,6.565,6.861,7.148,6.63,6.127,6.009,6.678,6.549,5.79,6.345,7.041,6.871,6.59,6.495,6.982,7.236,6.616,7.42,6.849,6.635,5.972,4.973,6.122,6.023,6.266,6.567,5.705,5.914,5.782,6.382,6.113,6.426,6.376,6.041,5.708,6.415,6.431,6.312,6.083,5.868,6.333,6.144,5.706,6.031,6.316,6.31,6.037,5.869,5.895,6.059,5.985,5.968,7.241,6.54,6.696,6.874,6.014,5.898,6.516,6.635,6.939,6.49,6.579,5.884,6.728,5.663,5.936,6.212,6.395,6.127,6.112,6.398,6.251,5.362,5.803,8.78,3.561,4.963,3.863,4.97,6.683,7.016,6.216,5.875,4.906,4.138,7.313,6.649,6.794,6.38,6.223,6.968,6.545,5.536,5.52,4.368,5.277,4.652,5,4.88,5.39,5.713,6.051,5.036,6.193,5.887,6.471,6.405,5.747,5.453,5.852,5.987,6.343,6.404,5.349,5.531,5.683,4.138,5.608,5.617,6.852,5.757,6.657,4.628,5.155,4.519,6.434,6.782,5.304,5.957,6.824,6.411,6.006,5.648,6.103,5.565,5.896,5.837,6.202,6.193,6.38,6.348,6.833,6.425,6.436,6.208,6.629,6.461,6.152,5.935,5.627,5.818,6.406,6.219,6.485,5.854,6.459,6.341,6.251,6.185,6.417,6.749,6.655,6.297,7.393,6.728,6.525,5.976,5.936,6.301,6.081,6.701,6.376,6.317,6.513,6.209,5.759,5.952,6.003,5.926,5.713,6.167,6.229,6.437,6.98,5.427,6.162,6.484,5.304,6.185,6.229,6.242,6.75,7.061,5.762,5.871,6.312,6.114,5.905,5.454,5.414,5.093,5.983,5.983,5.707,5.926,5.67,5.39,5.794,6.019,5.569,6.027,6.593,6.12,6.976,6.794,6.03],"age":[65.2,78.9,61.1,45.8,54.2,58.7,66.6,96.1,100,85.9,94.3,82.9,39,61.8,84.5,56.5,29.3,81.7,36.6,69.5,98.1,89.2,91.7,100,94.1,85.7,90.3,88.8,94.4,87.3,94.1,100,82,95,96.9,68.2,61.4,41.5,30.2,21.8,15.8,2.9,6.6,6.5,40,33.8,33.3,85.5,95.3,62,45.7,63,21.1,21.4,47.6,21.9,35.7,40.5,29.2,47.2,66.2,93.4,67.8,43.4,59.5,17.8,31.1,21.4,36.8,33,6.6,17.5,7.8,6.2,6,45,74.5,45.8,53.7,36.6,33.5,70.4,32.2,46.7,48,56.1,45.1,56.8,86.3,63.1,66.1,73.9,53.6,28.9,77.3,57.8,69.6,76,36.9,62.5,79.9,71.3,85.4,87.4,90,96.7,91.9,85.2,97.1,91.2,54.4,81.6,92.9,95.4,84.2,88.2,72.5,82.6,73.1,65.2,69.7,84.1,92.9,97,95.8,88.4,95.6,96,98.8,94.7,98.9,97.7,97.9,95.4,98.4,98.2,93.5,98.4,98.2,97.9,93.6,100,100,100,97.8,100,100,95.7,93.8,94.9,97.3,100,88,98.5,96,82.6,94,97.4,100,100,92.6,90.8,98.2,93.9,91.8,93,96.2,79.2,96.1,95.2,94.6,97.3,88.5,84.1,68.7,33.1,47.2,73.4,74.4,58.4,83.3,62.2,92.2,95.6,89.8,68.8,53.6,41.1,29.1,38.9,21.5,30.8,26.3,9.9,18.8,32,34.1,36.6,38.3,15.3,13.9,38.4,15.7,33.2,31.9,22.3,52.5,72.7,59.1,100,92.1,88.6,53.8,32.3,9.8,42.4,56,85.1,93.8,92.4,88.5,91.3,77.7,80.8,78.3,83,86.5,79.9,17,21.4,68.1,76.9,73.3,70.4,66.5,61.5,76.5,71.6,18.5,42.2,54.3,65.1,52.9,7.8,76.5,70.2,34.9,79.2,49.1,17.5,13,8.9,6.8,8.4,32,19.1,34.2,86.9,100,100,81.8,89.4,91.5,94.5,91.6,62.8,84.6,67,52.6,61.5,42.1,16.3,58.7,51.8,32.9,42.8,49,27.6,32.1,32.2,64.5,37.2,49.7,24.8,20.8,31.9,31.5,31.3,45.6,22.9,27.9,27.7,23.4,18.4,42.3,31.1,51,58,20.1,10,47.4,40.4,18.4,17.7,41.1,58.1,71.9,70.3,82.5,76.7,37.8,52.8,90.4,82.8,87.3,77.7,83.2,71.7,67.2,58.8,52.3,54.3,49.9,74.3,40.1,14.7,28.9,43.7,25.8,17.2,32.2,28.4,23.3,38.1,38.5,34.5,46.3,59.6,37.3,45.4,58.5,49.3,59.7,56.4,28.1,48.5,52.3,27.7,29.7,34.5,44.4,35.9,18.5,36.1,21.9,19.5,97.4,91,83.4,81.3,88,91.1,96.2,89,82.9,87.9,91.4,100,100,96.8,97.5,100,89.6,100,100,97.9,93.3,98.8,96.2,100,91.9,99.1,100,100,91.2,98.1,100,89.5,100,98.9,97,82.5,97,92.6,94.7,98.8,96,98.9,100,77.8,100,100,100,96,85.4,100,100,100,97.9,100,100,100,100,100,100,100,90.8,89.1,100,76.5,100,95.3,87.6,85.1,70.6,95.4,59.7,78.7,78.1,95.6,86.1,94.3,74.8,87.9,95,94.6,93.3,100,87.9,93.9,92.4,97.2,100,100,96.6,94.8,96.4,96.6,98.7,98.3,92.6,98.2,91.8,99.3,94.1,86.5,87.9,80.3,83.7,84.4,90,88.4,83,89.9,65.4,48.2,84.7,94.5,71,56.7,84,90.7,75,67.6,95.4,97.4,93.6,97.3,96.7,88,64.7,74.9,77,40.3,41.9,51.9,79.8,53.2,92.7,98.3,98,98.8,83.5,54,42.6,28.8,72.9,70.6,65.3,73.5,79.7,69.1,76.7,91,89.3,80.8],"dis":[4.09,4.9671,4.9671,6.0622,6.0622,6.0622,5.5605,5.9505,6.0821,6.5921,6.3467,6.2267,5.4509,4.7075,4.4619,4.4986,4.4986,4.2579,3.7965,3.7965,3.7979,4.0123,3.9769,4.0952,4.3996,4.4546,4.682,4.4534,4.4547,4.239,4.233,4.175,3.99,3.7872,3.7598,3.3603,3.3779,3.9342,3.8473,5.4011,5.4011,5.7209,5.7209,5.7209,5.7209,5.1004,5.1004,5.6894,5.87,6.0877,6.8147,6.8147,6.8147,6.8147,7.3197,8.6966,9.1876,8.3248,7.8148,6.932,7.2254,6.8185,7.2255,7.9809,9.2229,6.6115,6.6115,6.498,6.498,6.498,5.2873,5.2873,5.2873,5.2873,4.2515,4.5026,4.0522,4.0905,5.0141,4.5026,5.4007,5.4007,5.4007,5.4007,4.7794,4.4377,4.4272,3.7476,3.4217,3.4145,3.0923,3.0921,3.6659,3.6659,3.615,3.4952,3.4952,3.4952,3.4952,3.4952,2.7778,2.8561,2.7147,2.7147,2.421,2.1069,2.211,2.1224,2.4329,2.5451,2.7778,2.6775,2.3534,2.548,2.2565,2.4631,2.7301,2.7474,2.4775,2.7592,2.2577,2.1974,2.0869,1.9444,2.0063,1.9929,1.7572,1.7883,1.8125,1.9799,2.1185,2.271,2.3274,2.4699,2.346,2.1107,1.9669,1.8498,1.6686,1.6687,1.6119,1.4394,1.3216,1.4118,1.3459,1.4191,1.5166,1.4608,1.5296,1.5257,1.618,1.5916,1.6102,1.6232,1.7494,1.7455,1.7364,1.8773,1.7573,1.7659,1.7984,1.9709,2.0407,2.162,2.422,2.2834,2.0459,2.4259,2.1,2.2625,2.4259,2.3887,2.5961,2.6463,2.7019,3.1323,3.5549,3.3175,2.9153,2.829,2.741,2.5979,2.7006,2.847,2.9879,3.2797,3.1992,3.7886,4.5667,4.5667,6.4798,6.4798,6.4798,6.2196,6.2196,5.6484,7.309,7.309,7.309,7.6534,7.6534,6.27,6.27,5.118,5.118,3.9454,4.3549,4.3549,4.2392,3.875,3.8771,3.665,3.6526,3.9454,3.5875,3.9454,3.1121,3.4211,2.8893,3.3633,2.8617,3.048,3.2721,3.2721,2.8944,2.8944,3.2157,3.2157,3.3751,3.3751,3.6715,3.6715,3.8384,3.6519,3.6519,3.6519,4.148,4.148,6.1899,6.1899,6.3361,6.3361,7.0355,7.0355,7.9549,7.9549,8.0555,8.0555,7.8265,7.8265,7.3967,7.3967,8.9067,8.9067,9.2203,9.2203,6.3361,1.801,1.8946,2.0107,2.1121,2.1398,2.2885,2.0788,1.9301,1.9865,2.1329,2.4216,2.872,3.9175,4.429,4.429,3.9175,4.3665,4.0776,4.2673,4.7872,4.8628,4.1403,4.1007,4.6947,5.2447,5.2119,5.885,7.3073,7.3073,9.0892,7.3172,7.3172,7.3172,5.1167,5.1167,5.1167,5.5027,5.5027,5.9604,5.9604,6.32,7.8278,7.8278,7.8278,5.4917,5.4917,5.4917,4.022,3.37,3.0992,3.1827,3.3175,3.1025,2.5194,2.6403,2.834,3.2628,3.6023,3.945,3.9986,4.0317,3.5325,4.0019,4.5404,4.5404,4.7211,4.7211,4.7211,5.4159,5.4159,5.4159,5.2146,5.2146,5.8736,6.6407,6.6407,6.4584,6.4584,5.9853,5.2311,5.615,4.8122,4.8122,4.8122,7.0379,6.2669,5.7321,6.4654,8.0136,8.0136,8.5353,8.344,8.7921,8.7921,10.7103,10.7103,12.1265,10.5857,10.5857,2.1222,2.5052,2.7227,2.5091,2.5182,2.2955,2.1036,1.9047,1.9047,1.6132,1.7523,1.5106,1.3325,1.3567,1.2024,1.1691,1.1296,1.1742,1.137,1.3163,1.3449,1.358,1.3861,1.3861,1.4165,1.5192,1.5804,1.5331,1.4395,1.4261,1.4672,1.5184,1.5895,1.7281,1.9265,2.1678,1.77,1.7912,1.7821,1.7257,1.6768,1.6334,1.4896,1.5004,1.5888,1.5741,1.639,1.7028,1.6074,1.4254,1.1781,1.2852,1.4547,1.4655,1.413,1.5275,1.5539,1.5894,1.6582,1.8347,1.8195,1.6475,1.8026,1.794,1.8589,1.8746,1.9512,2.0218,2.0635,1.9096,1.9976,1.8629,1.9356,1.9682,2.0527,2.0882,2.2004,2.3158,2.2222,2.1247,2.0026,1.9142,1.8206,1.8172,1.8662,2.0651,2.0048,1.9784,1.8956,1.9879,2.072,2.198,2.2616,2.185,2.3236,2.3552,2.3682,2.4527,2.4961,2.4358,2.5806,2.7792,2.7831,2.7175,2.5975,2.5671,2.7344,2.8016,2.9634,3.0665,2.8715,2.5403,2.9084,2.8237,3.0334,3.0993,2.8965,2.5329,2.4298,2.206,2.3053,2.1007,2.1705,1.9512,3.4242,3.3317,3.4106,4.0983,3.724,3.9917,3.5459,3.1523,1.8209,1.7554,1.8226,1.8681,2.1099,2.3817,2.3817,2.7986,2.7986,2.8927,2.4091,2.3999,2.4982,2.4786,2.2875,2.1675,2.3889,2.505],"rad":[1,2,2,3,3,3,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,3,5,2,5,8,8,8,8,8,8,3,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,4,4,4,4,3,3,3,3,2,2,2,2,4,4,4,2,2,2,2,2,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,3,3,3,3,3,3,3,3,5,5,5,5,5,5,1,1,4,2,2,2,3,3,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,1,1,3,5,5,5,5,5,5,5,5,5,5,5,5,3,3,3,3,3,4,4,4,4,4,5,5,5,5,1,1,1,1,6,6,6,4,4,4,4,4,4,4,4,5,5,5,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,4,4,4,1,1,5,5,5,5,5,5,5,5,1,1,5,5,3,3,4,4,1,1,4,4,5,4,4,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,4,4,4,4,4,6,6,6,6,6,6,6,6,1,1,1,1,1],"tax":[296,242,242,222,222,222,311,311,311,311,311,311,311,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,279,279,279,279,252,252,233,233,233,233,233,233,233,233,233,243,243,243,243,469,226,313,256,284,284,284,284,284,284,216,337,337,345,345,345,305,305,305,305,398,398,398,398,398,398,281,281,281,281,247,247,247,247,270,270,270,270,270,270,270,276,276,276,276,276,384,384,384,384,384,384,384,384,384,384,384,432,432,432,432,432,432,432,432,432,188,188,188,188,188,188,188,437,437,437,437,437,437,437,437,437,437,437,437,437,437,437,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,403,296,296,296,296,296,296,296,193,193,193,193,193,193,193,193,398,398,398,398,398,398,265,265,255,329,329,329,402,402,348,348,224,224,277,277,277,277,277,277,277,277,277,277,277,276,276,276,276,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,307,300,300,300,300,300,300,330,330,330,330,330,330,330,330,330,330,315,315,244,264,264,264,264,264,264,264,264,264,264,264,264,223,223,223,223,223,254,254,254,254,254,216,216,216,216,198,285,300,241,293,293,293,245,245,245,289,289,289,289,289,358,358,358,329,329,329,222,222,222,222,304,304,304,304,304,304,304,304,304,304,304,304,287,287,287,287,287,287,287,287,430,430,430,304,304,224,224,224,224,224,224,224,224,284,422,370,370,352,352,351,280,335,335,411,411,187,334,334,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,711,711,711,711,711,391,391,391,391,391,391,391,391,273,273,273,273,273],"ptratio":[15.3,17.8,17.8,18.7,18.7,18.7,15.2,15.2,15.2,15.2,15.2,15.2,15.2,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,19.2,19.2,19.2,19.2,18.3,18.3,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,16.8,16.8,16.8,16.8,21.1,17.9,17.3,15.1,19.7,19.7,19.7,19.7,19.7,19.7,18.6,16.1,16.1,18.9,18.9,18.9,19.2,19.2,19.2,19.2,18.7,18.7,18.7,18.7,18.7,18.7,19,19,19,19,18.5,18.5,18.5,18.5,17.8,17.8,17.8,17.8,18.2,18.2,18.2,18,18,18,18,18,20.9,20.9,20.9,20.9,20.9,20.9,20.9,20.9,20.9,20.9,20.9,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,19.1,19.1,19.1,19.1,19.1,19.1,19.1,21.2,21.2,21.2,21.2,21.2,21.2,21.2,21.2,21.2,21.2,21.2,21.2,21.2,21.2,21.2,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,14.7,16.6,16.6,16.6,16.6,16.6,16.6,16.6,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,15.2,15.2,15.2,15.2,15.2,15.2,15.6,15.6,14.4,12.6,12.6,12.6,17,17,14.7,14.7,14.7,14.7,18.6,18.6,18.6,18.6,18.6,18.6,18.6,18.6,18.6,18.6,18.6,16.4,16.4,16.4,16.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,16.6,16.6,16.6,16.6,16.6,16.6,19.1,19.1,19.1,19.1,19.1,19.1,19.1,19.1,19.1,19.1,16.4,16.4,15.9,13,13,13,13,13,13,13,13,13,13,13,13,18.6,18.6,18.6,18.6,18.6,17.6,17.6,17.6,17.6,17.6,14.9,14.9,14.9,14.9,13.6,15.3,15.3,18.2,16.6,16.6,16.6,19.2,19.2,19.2,16,16,16,16,16,14.8,14.8,14.8,16.1,16.1,16.1,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,18.4,19.6,19.6,19.6,19.6,19.6,19.6,19.6,19.6,16.9,16.9,16.9,16.9,16.9,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,15.5,15.9,17.6,17.6,18.8,18.8,17.9,17,19.7,19.7,18.3,18.3,17,22,22,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.1,20.1,20.1,20.1,20.1,19.2,19.2,19.2,19.2,19.2,19.2,19.2,19.2,21,21,21,21,21],"lstat":[4.98,9.14,4.03,2.94,5.33,5.21,12.43,19.15,29.93,17.1,20.45,13.27,15.71,8.26,10.26,8.47,6.58,14.67,11.69,11.28,21.02,13.83,18.72,19.88,16.3,16.51,14.81,17.28,12.8,11.98,22.6,13.04,27.71,18.35,20.34,9.68,11.41,8.77,10.13,4.32,1.98,4.84,5.81,7.44,9.55,10.21,14.15,18.8,30.81,16.2,13.45,9.43,5.28,8.43,14.8,4.81,5.77,3.95,6.86,9.22,13.15,14.44,6.73,9.5,8.05,4.67,10.24,8.1,13.09,8.79,6.72,9.88,5.52,7.54,6.78,8.94,11.97,10.27,12.34,9.1,5.29,7.22,6.72,7.51,9.62,6.53,12.86,8.44,5.5,5.7,8.81,8.2,8.16,6.21,10.59,6.65,11.34,4.21,3.57,6.19,9.42,7.67,10.63,13.44,12.33,16.47,18.66,14.09,12.27,15.55,13,10.16,16.21,17.09,10.45,15.76,12.04,10.3,15.37,13.61,14.37,14.27,17.93,25.41,17.58,14.81,27.26,17.19,15.39,18.34,12.6,12.26,11.12,15.03,17.31,16.96,16.9,14.59,21.32,18.46,24.16,34.41,26.82,26.42,29.29,27.8,16.65,29.53,28.32,21.45,14.1,13.28,12.12,15.79,15.12,15.02,16.14,4.59,6.43,7.39,5.5,1.73,1.92,3.32,11.64,9.81,3.7,12.14,11.1,11.32,14.43,12.03,14.69,9.04,9.64,5.33,10.11,6.29,6.92,5.04,7.56,9.45,4.82,5.68,13.98,13.15,4.45,6.68,4.56,5.39,5.1,4.69,2.87,5.03,4.38,2.97,4.08,8.61,6.62,4.56,4.45,7.43,3.11,3.81,2.88,10.87,10.97,18.06,14.66,23.09,17.27,23.98,16.03,9.38,29.55,9.47,13.51,9.69,17.92,10.5,9.71,21.46,9.93,7.6,4.14,4.63,3.13,6.36,3.92,3.76,11.65,5.25,2.47,3.95,8.05,10.88,9.54,4.73,6.36,7.37,11.38,12.4,11.22,5.19,12.5,18.46,9.16,10.15,9.52,6.56,5.9,3.59,3.53,3.54,6.57,9.25,3.11,5.12,7.79,6.9,9.59,7.26,5.91,11.25,8.1,10.45,14.79,7.44,3.16,13.65,13,6.59,7.73,6.58,3.53,2.98,6.05,4.16,7.19,4.85,3.76,4.59,3.01,3.16,7.85,8.23,12.93,7.14,7.6,9.51,3.33,3.56,4.7,8.58,10.4,6.27,7.39,15.84,4.97,4.74,6.07,9.5,8.67,4.86,6.93,8.93,6.47,7.53,4.54,9.97,12.64,5.98,11.72,7.9,9.28,11.5,18.33,15.94,10.36,12.73,7.2,6.87,7.7,11.74,6.12,5.08,6.15,12.79,9.97,7.34,9.09,12.43,7.83,5.68,6.75,8.01,9.8,10.56,8.51,9.74,9.29,5.49,8.65,7.18,4.61,10.53,12.67,6.36,5.99,5.89,5.98,5.49,7.79,4.5,8.05,5.57,17.6,13.27,11.48,12.67,7.79,14.19,10.19,14.64,5.29,7.12,14,13.33,3.26,3.73,2.96,9.53,8.88,34.77,37.97,13.44,23.24,21.24,23.69,21.78,17.21,21.08,23.6,24.56,30.63,30.81,28.28,31.99,30.62,20.85,17.11,18.76,25.68,15.17,16.35,17.12,19.37,19.92,30.59,29.97,26.77,20.32,20.31,19.77,27.38,22.98,23.34,12.13,26.4,19.78,10.11,21.22,34.37,20.08,36.98,29.05,25.79,26.64,20.62,22.74,15.02,15.7,14.1,23.29,17.16,24.39,15.69,14.52,21.52,24.08,17.64,19.69,12.03,16.22,15.17,23.27,18.05,26.45,34.02,22.88,22.11,19.52,16.59,18.85,23.79,23.98,17.79,16.44,18.13,19.31,17.44,17.73,17.27,16.74,18.71,18.13,19.01,16.94,16.23,14.7,16.42,14.65,13.99,10.29,13.22,14.13,17.15,21.32,18.13,14.76,16.29,12.87,14.36,11.66,18.14,24.1,18.68,24.91,18.03,13.11,10.74,7.74,7.01,10.42,13.34,10.58,14.98,11.45,18.06,23.97,29.68,18.07,13.35,12.01,13.59,17.6,21.14,14.1,12.92,15.1,14.33,9.67,9.08,5.64,6.48,7.88],"medv":[24,21.6,34.7,33.4,36.2,28.7,22.9,27.1,16.5,18.9,15,18.9,21.7,20.4,18.2,19.9,23.1,17.5,20.2,18.2,13.6,19.6,15.2,14.5,15.6,13.9,16.6,14.8,18.4,21,12.7,14.5,13.2,13.1,13.5,18.9,20,21,24.7,30.8,34.9,26.6,25.3,24.7,21.2,19.3,20,16.6,14.4,19.4,19.7,20.5,25,23.4,18.9,35.4,24.7,31.6,23.3,19.6,18.7,16,22.2,25,33,23.5,19.4,22,17.4,20.9,24.2,21.7,22.8,23.4,24.1,21.4,20,20.8,21.2,20.3,28,23.9,24.8,22.9,23.9,26.6,22.5,22.2,23.6,28.7,22.6,22,22.9,25,20.6,28.4,21.4,38.7,43.8,33.2,27.5,26.5,18.6,19.3,20.1,19.5,19.5,20.4,19.8,19.4,21.7,22.8,18.8,18.7,18.5,18.3,21.2,19.2,20.4,19.3,22,20.3,20.5,17.3,18.8,21.4,15.7,16.2,18,14.3,19.2,19.6,23,18.4,15.6,18.1,17.4,17.1,13.3,17.8,14,14.4,13.4,15.6,11.8,13.8,15.6,14.6,17.8,15.4,21.5,19.6,15.3,19.4,17,15.6,13.1,41.3,24.3,23.3,27,50,50,50,22.7,25,50,23.8,23.8,22.3,17.4,19.1,23.1,23.6,22.6,29.4,23.2,24.6,29.9,37.2,39.8,36.2,37.9,32.5,26.4,29.6,50,32,29.8,34.9,37,30.5,36.4,31.1,29.1,50,33.3,30.3,34.6,34.9,32.9,24.1,42.3,48.5,50,22.6,24.4,22.5,24.4,20,21.7,19.3,22.4,28.1,23.7,25,23.3,28.7,21.5,23,26.7,21.7,27.5,30.1,44.8,50,37.6,31.6,46.7,31.5,24.3,31.7,41.7,48.3,29,24,25.1,31.5,23.7,23.3,22,20.1,22.2,23.7,17.6,18.5,24.3,20.5,24.5,26.2,24.4,24.8,29.6,42.8,21.9,20.9,44,50,36,30.1,33.8,43.1,48.8,31,36.5,22.8,30.7,50,43.5,20.7,21.1,25.2,24.4,35.2,32.4,32,33.2,33.1,29.1,35.1,45.4,35.4,46,50,32.2,22,20.1,23.2,22.3,24.8,28.5,37.3,27.9,23.9,21.7,28.6,27.1,20.3,22.5,29,24.8,22,26.4,33.1,36.1,28.4,33.4,28.2,22.8,20.3,16.1,22.1,19.4,21.6,23.8,16.2,17.8,19.8,23.1,21,23.8,23.1,20.4,18.5,25,24.6,23,22.2,19.3,22.6,19.8,17.1,19.4,22.2,20.7,21.1,19.5,18.5,20.6,19,18.7,32.7,16.5,23.9,31.2,17.5,17.2,23.1,24.5,26.6,22.9,24.1,18.6,30.1,18.2,20.6,17.8,21.7,22.7,22.6,25,19.9,20.8,16.8,21.9,27.5,21.9,23.1,50,50,50,50,50,13.8,13.8,15,13.9,13.3,13.1,10.2,10.4,10.9,11.3,12.3,8.8,7.2,10.5,7.4,10.2,11.5,15.1,23.2,9.7,13.8,12.7,13.1,12.5,8.5,5,6.3,5.6,7.2,12.1,8.3,8.5,5,11.9,27.9,17.2,27.5,15,17.2,17.9,16.3,7,7.2,7.5,10.4,8.8,8.4,16.7,14.2,20.8,13.4,11.7,8.3,10.2,10.9,11,9.5,14.5,14.1,16.1,14.3,11.7,13.4,9.6,8.7,8.4,12.8,10.5,17.1,18.4,15.4,10.8,11.8,14.9,12.6,14.1,13,13.4,15.2,16.1,17.8,14.9,14.1,12.7,13.5,14.9,20,16.4,17.7,19.5,20.2,21.4,19.9,19,19.1,19.1,20.1,19.9,19.6,23.2,29.8,13.8,13.3,16.7,12,14.6,21.4,23,23.7,25,21.8,20.6,21.2,19.1,20.6,15.2,7,8.1,13.6,20.1,21.8,24.5,23.1,19.7,18.3,21.2,17.5,16.8,22.4,20.6,23.9,22,11.9]},"columns":[{"accessor":"crim","name":"crim","type":"numeric"},{"accessor":"zn","name":"zn","type":"numeric"},{"accessor":"indus","name":"indus","type":"numeric"},{"accessor":"chas","name":"chas","type":"numeric"},{"accessor":"nox","name":"nox","type":"numeric"},{"accessor":"rm","name":"rm","type":"numeric"},{"accessor":"age","name":"age","type":"numeric"},{"accessor":"dis","name":"dis","type":"numeric"},{"accessor":"rad","name":"rad","type":"numeric"},{"accessor":"tax","name":"tax","type":"numeric"},{"accessor":"ptratio","name":"ptratio","type":"numeric"},{"accessor":"lstat","name":"lstat","type":"numeric"},{"accessor":"medv","name":"medv","type":"numeric"}],"filterable":true,"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f5da1345d387614384eab75e0d641393","key":"f5da1345d387614384eab75e0d641393"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div id="create-the-resample-object-1" class="section level2">
<h2>Create the resample object</h2>
<p>First, we split the samples into a training set and a test set. From the training set, we create a 10-fold cross-validation data set from the training set.</p>
<p>This is done with <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::initial_split</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::training</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::testing</code></a> and <a href="https://rsample.tidymodels.org/reference/vfold_cv.html"><code>rsample::vfold_cv</code></a>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Boston_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(Boston)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>Boston_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(Boston_split)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>Boston_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(Boston_split)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>Boston_fold <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(Boston_train, <span class="at">v =</span> <span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="create-the-preprocessor-1" class="section level2">
<h2>Create the preprocessor</h2>
<p>We create a recipe with <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipes::recipe</code></a>. No other preprocessing step is done.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>reg_tree_recipe <span class="ot">&lt;-</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> medv <span class="sc">~</span> ., <span class="at">data =</span> Boston_train)</span></code></pre></div>
</div>
<div id="specify-the-model-1" class="section level2">
<h2>Specify the model</h2>
<p>Use <a href="https://parsnip.tidymodels.org/reference/decision_tree.html"><code>parsnip::decision_tree</code></a>, <a href="https://parsnip.tidymodels.org/reference/set_args.html"><code>parsnip::set_mode</code></a> and <a href="https://parsnip.tidymodels.org/reference/set_engine.html"><code>parsnip::set_engine</code></a> to create the model.</p>
<p>The cost complexity is tuned using <a href="https://hardhat.tidymodels.org/reference/tune.html"><code>tune::tune</code></a></p>
<p>An engine specific parameter <code>model = TRUE</code> is set for rpart to prevent this warning message from coming up later when <code>rpart.plot::rpart.plot</code> is used later.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Cannot retrieve the data used to build the model (so cannot determine roundint and is.binary for the variables).</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; To silence this warning:</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Call rpart.plot with roundint=FALSE,</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     or rebuild the rpart model with model=TRUE.</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>reg_tree_spec <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">decision_tree</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tree_depth = 4,</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost_complexity =</span> tune<span class="sc">::</span><span class="fu">tune</span>()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>, <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>reg_tree_spec <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">translate</span>()</span></code></pre></div>
<pre><code>&gt; Decision Tree Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   cost_complexity = tune::tune()
&gt; 
&gt; Engine-Specific Arguments:
&gt;   model = TRUE
&gt; 
&gt; Computational engine: rpart 
&gt; 
&gt; Model fit template:
&gt; rpart::rpart(formula = missing_arg(), data = missing_arg(), weights = missing_arg(), 
&gt;     cp = tune::tune(), model = TRUE)</code></pre>
</div>
<div id="create-the-workflow-1" class="section level2">
<h2>Create the workflow</h2>
<p><a href="https://workflows.tidymodels.org/reference/workflow.html"><code>workflows::workflow</code></a>, <a href="https://workflows.tidymodels.org/reference/add_recipe.html"><code>workflows::add_recipe</code></a> and <a href="https://workflows.tidymodels.org/reference/add_model.html"><code>workflows::add_model</code></a> are used.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>reg_tree_workflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_recipe</span>(reg_tree_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_model</span>(reg_tree_spec)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>reg_tree_workflow</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: decision_tree()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; Decision Tree Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   cost_complexity = tune::tune()
&gt; 
&gt; Engine-Specific Arguments:
&gt;   model = TRUE
&gt; 
&gt; Computational engine: rpart</code></pre>
</div>
<div id="create-the-cost-complexity-grid-1" class="section level2">
<h2>Create the cost complexity grid</h2>
<p>A cost complexity grid of <span class="math inline">\(10\)</span> numbers from <span class="math inline">\(0.001\)</span> (<span class="math inline">\(10^{-4}\)</span>) to <span class="math inline">\(10\)</span> (<span class="math inline">\(10^1\)</span>) is created.</p>
<p>Regular grid is created using <a href="https://dials.tidymodels.org/reference/grid_regular.html"><code>dials::grid_regular</code></a>, <a href="https://dials.tidymodels.org/reference/trees.html"><code>dials::cost_complexity</code></a> and <a href="https://scales.r-lib.org/reference/log_trans.html"><code>scales::log10_trans</code></a></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a range from 10</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>cost_complexity_grid <span class="ot">&lt;-</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  dials<span class="sc">::</span><span class="fu">grid_regular</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> dials<span class="sc">::</span><span class="fu">cost_complexity</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">log10_trans</span>()</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="dv">10</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>cost_complexity_grid <span class="sc">%&gt;%</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-13a8be463c5fb2457ee4" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-13a8be463c5fb2457ee4">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cost_complexity":[0.0001,0.000359381366380463,0.00129154966501488,0.00464158883361278,0.0166810053720006,0.0599484250318941,0.215443469003188,0.774263682681128,2.78255940220713,10]},"columns":[{"accessor":"cost_complexity","name":"cost_complexity","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f88d36939f9dcdfcff4f0c357e21c095","key":"f88d36939f9dcdfcff4f0c357e21c095"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="regression-tree-model-fitting-on-cross-validated-data" class="section level2">
<h2>Regression tree model fitting on cross validated data</h2>
<p>Now we have everything we need and we can fit all the models on the cross validated data with <a href="https://tune.tidymodels.org/reference/tune_grid.html"><code>tune::tune_grid</code></a>. Note that this process may take some time.</p>
<p>We use <a href="https://yardstick.tidymodels.org/reference/metric_set.html"><code>yardstick::metric_set</code></a>, to choose a set of metrics to used to evaluate the model. In this example, <a href="https://yardstick.tidymodels.org/reference/rmse.html"><code>yardstick::rmse</code></a> and <a href="https://yardstick.tidymodels.org/reference/rsq.html"><code>yardstick::rsq</code></a> are used.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>foreach<span class="sc">::</span><span class="fu">getDoParWorkers</span>()</span></code></pre></div>
<pre><code>&gt; [1] 3</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>tune_res <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">tune_grid</span>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> reg_tree_workflow,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> Boston_fold,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> cost_complexity_grid,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># metrics = yardstick::metric_set(yardstick::rmse,</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                yardstick::rsq)</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>tune_res</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; # Tuning results
&gt; # 10-fold cross-validation 
&gt; # A tibble: 10 x 4
&gt;    splits           id     .metrics          .notes          
&gt;    &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
&gt;  1 &lt;split [341/38]&gt; Fold01 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt;  2 &lt;split [341/38]&gt; Fold02 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt;  3 &lt;split [341/38]&gt; Fold03 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt;  4 &lt;split [341/38]&gt; Fold04 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt;  5 &lt;split [341/38]&gt; Fold05 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt;  6 &lt;split [341/38]&gt; Fold06 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt;  7 &lt;split [341/38]&gt; Fold07 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt;  8 &lt;split [341/38]&gt; Fold08 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt;  9 &lt;split [341/38]&gt; Fold09 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt; 10 &lt;split [342/37]&gt; Fold10 &lt;tibble [20 x 5]&gt; &lt;tibble [1 x 3]&gt;
&gt; 
&gt; There were issues with some computations:
&gt; 
&gt;   - Warning(s) x10: A correlation computation is required, but `estimate` is constant...
&gt; 
&gt; Use `collect_notes(object)` for more information.</code></pre>
<p>Here we see that the amount of cost complexity affects the performance metrics differently using <a href="https://tune.tidymodels.org/reference/autoplot.tune_results.html"><code>tune::autoplot</code></a>. Do note that using a different seed will give a different plot</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that a different seed will give different plots</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">autoplot</span>(tune_res)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-41-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>We can also see the raw metrics that created this chart by calling <a href="https://tune.tidymodels.org/reference/collect_predictions.html"><code>tune::collect_metrics()</code></a>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">collect_metrics</span>(tune_res) <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-9acb472f3bc023769b12" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9acb472f3bc023769b12">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cost_complexity":[0.0001,0.0001,0.000359381366380463,0.000359381366380463,0.00129154966501488,0.00129154966501488,0.00464158883361278,0.00464158883361278,0.0166810053720006,0.0166810053720006,0.0599484250318941,0.0599484250318941,0.215443469003188,0.215443469003188,0.774263682681128,0.774263682681128,2.78255940220713,2.78255940220713,10,10],".metric":["rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq"],".estimator":["standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard"],"mean":[4.46559048909692,0.755607712582712,4.46656693384645,0.755152123892944,4.41435126466714,0.759841117411408,4.47291241267503,0.751258927261084,4.79820959638769,0.72092709137723,5.19310293582959,0.67023312473408,7.44331381002801,0.349350387906734,9.26105981787149,"NaN",9.26105981787149,"NaN",9.26105981787149,"NaN"],"n":[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,0,10,0,10,0],"std_err":[0.254819612103603,0.0349670025567155,0.255462006941899,0.0352727899128395,0.255399345277952,0.0352217423281772,0.283333148284877,0.0408762907273213,0.249762284145889,0.0369396606234159,0.229189976709293,0.0401538801827566,0.148428257550973,0.031054596211377,0.301533396649977,"NA",0.301533396649977,"NA",0.301533396649977,"NA"],".config":["Preprocessor1_Model01","Preprocessor1_Model01","Preprocessor1_Model02","Preprocessor1_Model02","Preprocessor1_Model03","Preprocessor1_Model03","Preprocessor1_Model04","Preprocessor1_Model04","Preprocessor1_Model05","Preprocessor1_Model05","Preprocessor1_Model06","Preprocessor1_Model06","Preprocessor1_Model07","Preprocessor1_Model07","Preprocessor1_Model08","Preprocessor1_Model08","Preprocessor1_Model09","Preprocessor1_Model09","Preprocessor1_Model10","Preprocessor1_Model10"]},"columns":[{"accessor":"cost_complexity","name":"cost_complexity","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f5c183f91e7ce328a48723e79f773b5d","key":"f5c183f91e7ce328a48723e79f773b5d"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Here is the <code>ggplot</code> way should <a href="https://tune.tidymodels.org/reference/autoplot.tune_results.html"><code>tune::autoplot</code></a> fails</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>tune_res <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;cost_complexity&quot;</span>]],</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;mean&quot;</span>]],</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> .data[[<span class="st">&quot;.metric&quot;</span>]]</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_errorbar</span>(</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> .data[[<span class="st">&quot;mean&quot;</span>]] <span class="sc">-</span> .data[[<span class="st">&quot;std_err&quot;</span>]],</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> .data[[<span class="st">&quot;mean&quot;</span>]] <span class="sc">+</span> .data[[<span class="st">&quot;std_err&quot;</span>]]</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">&quot;.metric&quot;</span>]]),</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<pre><code>&gt; Warning: Removed 3 row(s) containing missing values (geom_path).</code></pre>
<p><img src="docs/figures/unnamed-chunk-43-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>Use <a href="https://tune.tidymodels.org/reference/show_best.html"><code>tune::show_best</code></a> to see the top few values for a given metric.</p>
<p>The “best” values can be selected using <a href="https://tune.tidymodels.org/reference/show_best.html"><code>tune::select_best</code></a>, this function requires you to specify a metric that it should select against. The cost complexity value is 0.00129 for metric <code>rmse</code> since it gives the lowest value. Do note that using a different seed will give a different best cost complexity value.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>top_cost_complexity <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">show_best</span>(tune_res, <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&quot;rmse&quot;</span>), <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>top_cost_complexity <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-887d9d3e739065d53985" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-887d9d3e739065d53985">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cost_complexity":[0.00129154966501488,0.0001,0.000359381366380463,0.00464158883361278,0.0166810053720006],".metric":["rmse","rmse","rmse","rmse","rmse"],".estimator":["standard","standard","standard","standard","standard"],"mean":[4.41435126466714,4.46559048909692,4.46656693384645,4.47291241267503,4.79820959638769],"n":[10,10,10,10,10],"std_err":[0.255399345277952,0.254819612103603,0.255462006941899,0.283333148284877,0.249762284145889],".config":["Preprocessor1_Model03","Preprocessor1_Model01","Preprocessor1_Model02","Preprocessor1_Model04","Preprocessor1_Model05"]},"columns":[{"accessor":"cost_complexity","name":"cost_complexity","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"2b21baa9e9a2c8df5bac00a7f675bc99","key":"2b21baa9e9a2c8df5bac00a7f675bc99"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>best_cost_complexity <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">select_best</span>(tune_res, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>best_cost_complexity</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; # A tibble: 1 x 2
&gt;   cost_complexity .config              
&gt;             &lt;dbl&gt; &lt;chr&gt;                
&gt; 1         0.00129 Preprocessor1_Model03</code></pre>
</div>
<div id="regression-tree-model-with-optimised-cost-complexity-value" class="section level2">
<h2>Regression tree model with optimised cost complexity value</h2>
<p>We create the regression tree workflow with the best cost complexity score using <a href="https://tune.tidymodels.org/reference/finalize_model.html"><code>tune::finalize_workflow</code></a>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>reg_tree_final <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> reg_tree_workflow,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> best_cost_complexity</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>reg_tree_final</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: decision_tree()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; Decision Tree Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   cost_complexity = 0.00129154966501488
&gt; 
&gt; Engine-Specific Arguments:
&gt;   model = TRUE
&gt; 
&gt; Computational engine: rpart</code></pre>
<p>We now train the regression tree model with the training data using <a href="https://parsnip.tidymodels.org/reference/fit.html"><code>parsnip::fit</code></a></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>reg_tree_final_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">object =</span> reg_tree_final, <span class="at">data =</span> Boston_train)</span></code></pre></div>
<p>We can see the tree in greater detail using <a href="https://tune.tidymodels.org/reference/extract-tune.html"><code>tune::extract_fit_engine</code></a></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>reg_tree_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">extract_fit_engine</span>()</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; n= 379 
&gt; 
&gt; node), split, n, deviance, yval
&gt;       * denotes terminal node
&gt; 
&gt;   1) root 379 32622.95000 22.548020  
&gt;     2) rm&lt; 6.941 320 13602.31000 19.862810  
&gt;       4) lstat&gt;=14.395 129  2582.10900 14.515500  
&gt;         8) nox&gt;=0.607 80   984.73390 12.358750  
&gt;          16) lstat&gt;=19.34 47   388.63320 10.359570  
&gt;            32) tax&gt;=551.5 40   243.94980  9.677500  
&gt;              64) crim&gt;=24.59775 7    26.27714  7.157143 *
&gt;              65) crim&lt; 24.59775 33   163.77520 10.212120 *
&gt;            33) tax&lt; 551.5 7    19.73714 14.257140 *
&gt;          17) lstat&lt; 19.34 33   140.71880 15.206060  
&gt;            34) crim&gt;=6.99237 13    34.98769 13.630770 *
&gt;            35) crim&lt; 6.99237 20    52.50200 16.230000 *
&gt;         9) nox&lt; 0.607 49   617.69390 18.036730  
&gt;          18) crim&gt;=0.381565 25   313.20000 16.200000  
&gt;            36) ptratio&gt;=20.6 8    16.23875 14.162500 *
&gt;            37) ptratio&lt; 20.6 17   248.12120 17.158820 *
&gt;          19) crim&lt; 0.381565 24   132.30000 19.950000  
&gt;            38) age&gt;=72.8 15    51.49333 18.766670 *
&gt;            39) age&lt; 72.8 9    24.79556 21.922220 *
&gt;       5) lstat&lt; 14.395 191  4840.36400 23.474350  
&gt;        10) rm&lt; 6.543 151  2861.39900 22.211920  
&gt;          20) dis&gt;=1.68515 144  1179.59700 21.820830  
&gt;            40) rm&lt; 6.062 56   306.22860 20.285710 *
&gt;            41) rm&gt;=6.062 88   657.41950 22.797730  
&gt;              82) lstat&gt;=9.98 35    98.32686 21.025710 *
&gt;              83) lstat&lt; 9.98 53   376.61550 23.967920  
&gt;               166) crim&lt; 0.048715 17   100.97530 22.629410 *
&gt;               167) crim&gt;=0.048715 36   230.80000 24.600000  
&gt;                 334) tax&gt;=280.5 27    43.50667 23.911110 *
&gt;                 335) tax&lt; 280.5 9   136.04000 26.666670 *
&gt;          21) dis&lt; 1.68515 7  1206.69700 30.257140 *
&gt;        11) rm&gt;=6.543 40   829.85600 28.240000  
&gt;          22) lstat&gt;=4.44 33   274.06180 27.154550  
&gt;            44) dis&gt;=3.9683 19   131.76530 26.015790 *
&gt;            45) dis&lt; 3.9683 14    84.22000 28.700000 *
&gt;          23) lstat&lt; 4.44 7   333.61710 33.357140 *
&gt;     3) rm&gt;=6.941 59  4199.10200 37.111860  
&gt;       6) rm&lt; 7.437 35  1012.41000 32.082860  
&gt;        12) nox&gt;=0.4885 14   673.46930 28.892860 *
&gt;        13) nox&lt; 0.4885 21   101.49810 34.209520 *
&gt;       7) rm&gt;=7.437 24  1010.62000 44.445830  
&gt;        14) ptratio&gt;=15.4 12   585.07670 40.716670 *
&gt;        15) ptratio&lt; 15.4 12    91.78250 48.175000 *</code></pre>
<p>We can visualise the above better with <code>rpart.plot::rpart.plot</code></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>reg_tree_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-48-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
<div id="variable-importance-1" class="section level2">
<h2>Variable Importance</h2>
<p>What are the most important variables in this tree for predicting <code>medv</code>?</p>
<p>Using the <code>vip</code> package and <a href="https://workflows.tidymodels.org/reference/extract-workflow.html"><code>workflows::extract_fit_parsnip</code></a>, we have</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>vip_table <span class="ot">&lt;-</span> reg_tree_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vi</span>()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>vip_table <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-54549f4c10c17d05b981" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-54549f4c10c17d05b981">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Variable":["rm","lstat","indus","crim","nox","tax","ptratio","age","zn","dis","rad","chas"],"Importance":[18603.7985541012,12299.5981175771,6031.92873652551,5450.77589251116,5031.3508148904,4052.36759801357,3925.08118413303,3800.87931788646,1717.17287723918,1692.86350292527,445.250617366423,272.009049662026]},"columns":[{"accessor":"Variable","name":"Variable","type":"character"},{"accessor":"Importance","name":"Importance","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"623fa6bb7f6a31de30a03d8a5ddce426","key":"623fa6bb7f6a31de30a03d8a5ddce426"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>reg_tree_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>(</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;col&quot;</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">aesthetics =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">&quot;midnightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-50-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>We can use <a href="https://github.com/grantmcdermott/parttree"><code>parttree</code></a> to understand why these two parameters work so well on the training set.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>partial_tree <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">decision_tree</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost_complexity =</span> best_cost_complexity<span class="sc">$</span>cost_complexity</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>, <span class="at">model =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">fit</span>(medv <span class="sc">~</span> rm <span class="sc">+</span> lstat,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Boston_train</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">extract_fit_engine</span>()</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>Boston_train <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> .data[[<span class="st">&quot;rm&quot;</span>]],</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> .data[[<span class="st">&quot;lstat&quot;</span>]]</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  parttree<span class="sc">::</span><span class="fu">geom_parttree</span>(</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> partial_tree,</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> .data[[<span class="st">&quot;medv&quot;</span>]]),</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_jitter</span>(</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.05</span>,</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fl">0.2</span>,</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> .data[[<span class="st">&quot;medv&quot;</span>]])</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_colour_viridis_c</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>))</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-51-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
<div id="regression-tree-model-on-test-data" class="section level2">
<h2>Regression tree model on test data</h2>
<p>Finally, let’s turn to the testing data. For regression models, a <code>.pred</code>, column is added when <a href="https://parsnip.tidymodels.org/reference/augment.html"><code>parsnip::augment</code></a> is used.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> reg_tree_final_fit,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_data =</span> Boston_test</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-b4cf0a3b63a2d9e314a9" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b4cf0a3b63a2d9e314a9">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"crim":[0.00632,0.06905,0.08829,0.14455,0.21124,0.22489,1.23247,0.75026,0.67191,1.35472,1.61282,0.09744,0.15936,0.12269,0.17142,0.22927,0.08873,0.0136,0.01311,0.05789,0.13554,0.04113,0.04462,0.03932,0.02875,0.12802,0.26363,0.10084,0.12329,0.13058,0.06899,0.25915,0.32543,0.97617,0.2498,0.54452,4.0974,2.73397,2.14918,2.44668,1.46336,2.01019,2.3139,0.13914,0.06047,0.06911,0.08664,0.04011,0.01778,0.13642,0.0456,0.11069,0.40771,0.52693,0.29819,0.46296,0.08244,0.12757,0.19133,0.08221,0.04819,0.03548,0.66351,0.5405,0.1146,0.05644,0.06127,0.21038,0.06129,0.01965,0.04417,0.03537,0.05479,0.49298,2.63548,0.79041,0.3692,0.31827,0.47547,0.18159,0.28392,0.06617,0.04544,0.03466,0.05083,0.05497,0.06151,0.03049,0.06211,0.07244,5.20177,13.5222,4.89822,6.53876,19.6091,15.288,9.82349,5.29305,9.59571,41.5292,20.7162,51.1358,10.8342,11.0874,9.33889,6.44405,5.58107,14.4208,9.72418,5.66637,9.96654,8.24809,4.75237,4.66883,7.83932,3.77498,6.39312,10.233,5.82401,5.70818,2.81838,3.67367,5.69175,4.83567,0.17331,0.27957,0.06263],"zn":[18,0,12.5,12.5,12.5,12.5,0,0,0,0,0,0,0,0,0,0,21,75,90,12.5,12.5,25,25,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,45,80,95,0,0,0,0,0,0,0,30,30,22,22,80,80,20,20,20,40,40,20,20,80,70,34,33,0,0,0,0,0,0,0,0,0,0,35,0,0,0,55,40,60,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"indus":[2.31,2.18,7.87,7.87,7.87,7.87,8.14,8.14,8.14,8.14,8.14,5.96,6.91,6.91,6.91,6.91,5.64,4,1.22,6.07,6.07,4.86,4.86,3.41,15.04,8.56,8.56,10.01,10.01,10.01,25.65,21.89,21.89,21.89,21.89,21.89,19.58,19.58,19.58,19.58,19.58,19.58,19.58,4.05,2.46,3.44,3.44,1.52,1.47,10.59,13.89,13.89,6.2,6.2,6.2,6.2,4.93,4.93,5.86,5.86,3.64,3.64,3.97,3.97,6.96,6.41,6.41,3.33,3.33,1.76,2.24,6.09,2.18,9.9,9.9,9.9,9.9,9.9,9.9,7.38,7.38,3.24,3.24,6.06,5.19,5.19,5.19,3.78,1.25,1.69,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,9.69,9.69,11.93],"chas":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"nox":[0.538,0.458,0.524,0.524,0.524,0.524,0.538,0.538,0.538,0.538,0.538,0.499,0.448,0.448,0.448,0.448,0.439,0.41,0.403,0.409,0.409,0.426,0.426,0.489,0.464,0.52,0.52,0.547,0.547,0.547,0.581,0.624,0.624,0.624,0.624,0.624,0.871,0.871,0.871,0.871,0.605,0.605,0.605,0.51,0.488,0.437,0.437,0.404,0.403,0.489,0.55,0.55,0.507,0.504,0.504,0.504,0.428,0.428,0.431,0.431,0.392,0.392,0.647,0.575,0.464,0.447,0.447,0.4429,0.4429,0.385,0.4,0.433,0.472,0.544,0.544,0.544,0.544,0.544,0.544,0.493,0.493,0.46,0.46,0.4379,0.515,0.515,0.515,0.484,0.429,0.411,0.77,0.631,0.631,0.631,0.671,0.671,0.671,0.7,0.693,0.693,0.659,0.597,0.679,0.718,0.679,0.584,0.713,0.74,0.74,0.74,0.74,0.713,0.713,0.713,0.655,0.655,0.584,0.614,0.532,0.532,0.532,0.583,0.583,0.583,0.585,0.585,0.573],"rm":[6.575,7.147,6.012,6.172,5.631,6.377,6.142,5.924,5.813,6.072,6.096,5.841,6.211,6.069,5.682,6.03,5.963,5.888,7.249,5.878,5.594,6.727,6.619,6.405,6.211,6.474,6.229,6.715,5.913,5.872,5.87,5.693,6.431,5.757,5.857,6.151,5.468,5.597,5.709,5.272,7.489,7.929,5.88,5.572,6.153,6.739,7.178,7.287,7.135,5.891,5.888,5.951,6.164,8.725,7.686,7.412,6.481,6.393,5.605,6.957,6.108,5.876,7.333,7.47,6.538,6.758,6.826,6.812,7.645,6.23,6.871,6.59,6.616,6.635,4.973,6.122,6.567,5.914,6.113,6.376,5.708,5.868,6.144,6.031,6.316,5.985,5.968,6.874,6.49,5.884,6.127,3.863,4.97,7.016,7.313,6.649,6.794,6.051,6.404,5.531,4.138,5.757,6.782,6.411,6.38,6.425,6.436,6.461,6.406,6.219,6.485,7.393,6.525,5.976,6.209,5.952,6.162,6.185,6.242,6.75,5.762,6.312,6.114,5.905,5.707,5.926,6.593],"age":[65.2,54.2,66.6,96.1,100,94.3,91.7,94.1,90.3,100,96.9,61.4,6.5,40,33.8,85.5,45.7,47.6,21.9,21.4,36.8,33.5,70.4,73.9,28.9,97.1,91.2,81.6,92.9,73.1,69.7,96,98.8,98.4,98.2,97.9,100,94.9,98.5,94,90.8,96.2,97.3,88.5,68.8,30.8,26.3,34.1,13.9,22.3,56,93.8,91.3,83,17,76.9,18.5,7.8,70.2,6.8,32,19.1,100,52.6,58.7,32.9,27.6,32.2,49.7,31.5,47.4,40.4,58.1,82.5,37.8,52.8,87.3,83.2,58.8,54.3,74.3,25.8,32.2,23.3,38.1,45.4,58.5,28.1,44.4,18.5,83.4,100,100,97.5,97.9,93.3,98.8,82.5,100,85.4,100,100,90.8,100,95.6,74.8,87.9,93.3,97.2,100,100,99.3,86.5,87.9,65.4,84.7,97.4,96.7,64.7,74.9,40.3,51.9,79.8,53.2,54,42.6,69.1],"dis":[4.09,6.0622,5.5605,5.9505,6.0821,6.3467,3.9769,4.3996,4.682,4.175,3.7598,3.3779,5.7209,5.7209,5.1004,5.6894,6.8147,7.3197,8.6966,6.498,6.498,5.4007,5.4007,3.0921,3.6659,2.4329,2.5451,2.6775,2.3534,2.4775,2.2577,1.7883,1.8125,2.346,1.6686,1.6687,1.4118,1.5257,1.6232,1.7364,1.9709,2.0459,2.3887,2.5961,3.2797,6.4798,6.4798,7.309,7.6534,3.9454,3.1121,2.8893,3.048,2.8944,3.3751,3.6715,6.1899,7.0355,7.9549,8.9067,9.2203,9.2203,1.8946,2.872,3.9175,4.0776,4.8628,4.1007,5.2119,9.0892,7.8278,5.4917,3.37,3.3175,2.5194,2.6403,3.6023,3.9986,4.0019,4.5404,4.7211,5.2146,5.8736,6.6407,6.4584,4.8122,4.8122,6.4654,8.7921,10.7103,2.7227,1.5106,1.3325,1.2024,1.3163,1.3449,1.358,2.1678,1.639,1.6074,1.1781,1.413,1.8195,1.8589,1.9682,2.2004,2.3158,2.0026,2.0651,2.0048,1.9784,2.4527,2.4358,2.5806,2.9634,2.8715,2.206,2.1705,3.4242,3.3317,4.0983,3.9917,3.5459,3.1523,2.3817,2.3817,2.4786],"rad":[1,3,5,5,5,5,4,4,4,4,4,5,3,3,3,3,4,3,5,4,4,4,4,2,4,5,5,6,6,6,2,4,4,4,4,4,5,5,5,5,5,5,5,5,3,5,5,2,3,4,5,5,8,8,8,8,6,6,7,7,1,1,5,5,3,4,4,5,5,1,5,7,7,4,4,4,4,4,4,5,5,4,4,1,5,5,5,5,1,4,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,6,6,1],"tax":[296,222,311,311,311,311,307,307,307,307,307,279,233,233,233,233,243,469,226,345,345,281,281,270,270,384,384,432,432,432,188,437,437,437,437,437,403,403,403,403,403,403,403,296,193,398,398,329,402,277,276,276,307,307,307,307,300,300,330,330,315,315,264,264,223,254,254,216,216,241,358,329,222,304,304,304,304,304,304,287,287,430,430,304,224,224,224,370,335,411,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,391,391,273],"ptratio":[15.3,18.7,15.2,15.2,15.2,15.2,21,21,21,21,21,19.2,17.9,17.9,17.9,17.9,16.8,21.1,17.9,18.9,18.9,19,19,17.8,18.2,20.9,20.9,17.8,17.8,17.8,19.1,21.2,21.2,21.2,21.2,21.2,14.7,14.7,14.7,14.7,14.7,14.7,14.7,16.6,17.8,15.2,15.2,12.6,17,18.6,16.4,16.4,17.4,17.4,17.4,17.4,16.6,16.6,19.1,19.1,16.4,16.4,13,13,18.6,17.6,17.6,14.9,14.9,18.2,14.8,16.1,18.4,18.4,18.4,18.4,18.4,18.4,18.4,19.6,19.6,16.9,16.9,16.9,20.2,20.2,20.2,17.6,19.7,18.3,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,19.2,19.2,21],"lstat":[4.98,5.33,12.43,19.15,29.93,20.45,18.72,16.3,14.81,13.04,20.34,11.41,7.44,9.55,10.21,18.8,13.45,14.8,4.81,8.1,13.09,5.29,7.22,8.2,6.21,12.27,15.55,10.16,16.21,15.37,14.37,17.19,15.39,17.31,21.32,18.46,26.42,21.45,15.79,16.14,1.73,3.7,12.03,14.69,13.15,4.69,2.87,4.08,4.45,10.87,13.51,17.92,21.46,4.63,3.92,5.25,6.36,5.19,18.46,3.53,6.57,9.25,7.79,3.16,7.73,3.53,4.16,4.85,3.01,12.93,6.07,9.5,8.93,4.54,12.64,5.98,9.28,18.33,12.73,6.87,11.74,9.97,9.09,7.83,5.68,9.74,9.29,4.61,5.98,7.79,11.48,13.33,3.26,2.96,13.44,23.24,21.24,18.76,20.31,27.38,23.34,10.11,25.79,15.02,24.08,12.03,16.22,18.05,19.52,16.59,18.85,16.74,18.13,19.01,13.22,17.15,24.1,18.03,10.74,7.74,10.42,10.58,14.98,11.45,12.01,13.59,9.67],"medv":[24,36.2,22.9,27.1,16.5,15,15.2,15.6,16.6,14.5,13.5,20,24.7,21.2,19.3,16.6,19.7,18.9,35.4,22,17.4,28,23.9,22,25,19.8,19.4,22.8,18.8,20.4,22,16.2,18,15.6,13.3,17.8,15.6,15.4,19.4,13.1,50,50,19.1,23.1,29.6,30.5,36.4,33.3,32.9,22.6,23.3,21.5,21.7,50,46.7,31.7,23.7,23.7,18.5,29.6,21.9,20.9,36,43.5,24.4,32.4,33.1,35.1,46,20.1,24.8,22,28.4,22.8,16.1,22.1,23.8,17.8,21,23.1,18.5,19.3,19.8,19.4,22.2,19,18.7,31.2,22.9,18.6,22.7,23.1,50,50,15,13.9,13.3,23.2,12.1,8.5,11.9,15,7.5,16.7,9.5,16.1,14.3,9.6,17.1,18.4,15.4,17.8,14.1,12.7,21.4,19,13.3,14.6,23,23.7,21.8,21.2,19.1,20.6,21.8,24.5,22.4],".pred":[26.0157894736842,34.2095238095238,20.2857142857143,18.7666666666667,18.7666666666667,18.7666666666667,14.1625,14.1625,14.1625,21.0257142857143,14.1625,20.2857142857143,26.6666666666667,26.6666666666667,20.2857142857143,18.7666666666667,20.2857142857143,21.9222222222222,34.2095238095238,20.2857142857143,20.2857142857143,26.0157894736842,26.0157894736842,22.6294117647059,22.6294117647059,21.0257142857143,18.7666666666667,28.7,18.7666666666667,18.7666666666667,20.2857142857143,16.23,16.23,16.23,14.2571428571429,16.23,14.2571428571429,14.2571428571429,16.23,16.23,48.175,48.175,20.2857142857143,18.7666666666667,21.0257142857143,26.0157894736842,34.2095238095238,34.2095238095238,34.2095238095238,20.2857142857143,20.2857142857143,18.7666666666667,17.1588235294118,40.7166666666667,40.7166666666667,28.8928571428571,23.9111111111111,23.9111111111111,21.9222222222222,34.2095238095238,22.6294117647059,20.2857142857143,28.8928571428571,48.175,26.6666666666667,33.3571428571429,33.3571428571429,26.0157894736842,48.175,21.0257142857143,26.0157894736842,26.0157894736842,28.7,28.7,20.2857142857143,23.9111111111111,28.7,18.7666666666667,21.0257142857143,23.9111111111111,20.2857142857143,20.2857142857143,22.6294117647059,20.2857142857143,26.6666666666667,20.2857142857143,20.2857142857143,26.0157894736842,23.9111111111111,20.2857142857143,21.0257142857143,30.2571428571429,30.2571428571429,28.8928571428571,28.8928571428571,10.2121212121212,10.2121212121212,16.23,10.2121212121212,7.15714285714286,10.2121212121212,30.2571428571429,10.2121212121212,13.6307692307692,10.2121212121212,21.0257142857143,16.23,13.6307692307692,10.2121212121212,16.23,13.6307692307692,28.8928571428571,16.23,16.23,21.0257142857143,16.23,17.1588235294118,13.6307692307692,21.0257142857143,28.7,20.2857142857143,21.0257142857143,17.1588235294118,20.2857142857143,20.2857142857143,20.2857142857143,28.7]},"columns":[{"accessor":"crim","name":"crim","type":"numeric"},{"accessor":"zn","name":"zn","type":"numeric"},{"accessor":"indus","name":"indus","type":"numeric"},{"accessor":"chas","name":"chas","type":"numeric"},{"accessor":"nox","name":"nox","type":"numeric"},{"accessor":"rm","name":"rm","type":"numeric"},{"accessor":"age","name":"age","type":"numeric"},{"accessor":"dis","name":"dis","type":"numeric"},{"accessor":"rad","name":"rad","type":"numeric"},{"accessor":"tax","name":"tax","type":"numeric"},{"accessor":"ptratio","name":"ptratio","type":"numeric"},{"accessor":"lstat","name":"lstat","type":"numeric"},{"accessor":"medv","name":"medv","type":"numeric"},{"accessor":".pred","name":".pred","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"d77d77c9209743d40c7f3f69f8497cb8","key":"d77d77c9209743d40c7f3f69f8497cb8"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>We check how well the <code>.pred</code> column matches the <code>medv</code> using <a href="https://yardstick.tidymodels.org/reference/rmse.html"><code>yardstick::rmse</code></a>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">rmse</span>(<span class="at">truth =</span> .data[[<span class="st">&quot;medv&quot;</span>]], <span class="at">estimate =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-658508aa12f815ad271c" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-658508aa12f815ad271c">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["rmse"],".estimator":["standard"],".estimate":[4.64644761468666]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"2bd6406d12c0a442b96aaba447e12a79","key":"2bd6406d12c0a442b96aaba447e12a79"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Alternatively, we can use <a href="https://tune.tidymodels.org/reference/last_fit.html"><code>tune::last_fit</code></a> and <a href="https://tune.tidymodels.org/reference/collect_predictions.html"><code>tune::collect_metrics</code></a>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>test_rs <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">last_fit</span>(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> reg_tree_final_fit,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">split =</span> Boston_split</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>test_rs <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-f06cb88fc125579d6a45" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f06cb88fc125579d6a45">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["rmse","rsq"],".estimator":["standard","standard"],".estimate":[4.64644761468666,0.72999976107556],".config":["Preprocessor1_Model1","Preprocessor1_Model1"]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"5cbcb635f4b586cb04c4e93472717106","key":"5cbcb635f4b586cb04c4e93472717106"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Use <a href="https://tune.tidymodels.org/reference/collect_predictions.html"><code>tune::collect_predictions</code></a>, to see only the actual and predicted values of the test data.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>test_rs <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-dd92764ef4558d96bb92" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-dd92764ef4558d96bb92">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"id":["train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split","train/test split"],".pred":[26.0157894736842,34.2095238095238,20.2857142857143,18.7666666666667,18.7666666666667,18.7666666666667,14.1625,14.1625,14.1625,21.0257142857143,14.1625,20.2857142857143,26.6666666666667,26.6666666666667,20.2857142857143,18.7666666666667,20.2857142857143,21.9222222222222,34.2095238095238,20.2857142857143,20.2857142857143,26.0157894736842,26.0157894736842,22.6294117647059,22.6294117647059,21.0257142857143,18.7666666666667,28.7,18.7666666666667,18.7666666666667,20.2857142857143,16.23,16.23,16.23,14.2571428571429,16.23,14.2571428571429,14.2571428571429,16.23,16.23,48.175,48.175,20.2857142857143,18.7666666666667,21.0257142857143,26.0157894736842,34.2095238095238,34.2095238095238,34.2095238095238,20.2857142857143,20.2857142857143,18.7666666666667,17.1588235294118,40.7166666666667,40.7166666666667,28.8928571428571,23.9111111111111,23.9111111111111,21.9222222222222,34.2095238095238,22.6294117647059,20.2857142857143,28.8928571428571,48.175,26.6666666666667,33.3571428571429,33.3571428571429,26.0157894736842,48.175,21.0257142857143,26.0157894736842,26.0157894736842,28.7,28.7,20.2857142857143,23.9111111111111,28.7,18.7666666666667,21.0257142857143,23.9111111111111,20.2857142857143,20.2857142857143,22.6294117647059,20.2857142857143,26.6666666666667,20.2857142857143,20.2857142857143,26.0157894736842,23.9111111111111,20.2857142857143,21.0257142857143,30.2571428571429,30.2571428571429,28.8928571428571,28.8928571428571,10.2121212121212,10.2121212121212,16.23,10.2121212121212,7.15714285714286,10.2121212121212,30.2571428571429,10.2121212121212,13.6307692307692,10.2121212121212,21.0257142857143,16.23,13.6307692307692,10.2121212121212,16.23,13.6307692307692,28.8928571428571,16.23,16.23,21.0257142857143,16.23,17.1588235294118,13.6307692307692,21.0257142857143,28.7,20.2857142857143,21.0257142857143,17.1588235294118,20.2857142857143,20.2857142857143,20.2857142857143,28.7],".row":[1,5,7,8,9,11,23,25,27,32,35,37,44,45,46,48,51,55,56,68,69,81,82,92,94,109,110,112,113,119,121,128,129,135,139,140,144,150,154,157,162,167,172,173,186,192,193,197,201,206,217,219,222,226,229,232,239,244,246,253,255,256,259,269,273,275,278,280,283,287,301,302,306,309,311,312,315,317,320,322,324,329,331,333,334,340,341,345,351,353,359,368,369,371,376,377,378,392,403,405,407,411,417,421,430,433,434,437,442,443,444,454,456,457,465,467,476,479,481,482,484,486,487,488,494,495,502],"medv":[24,36.2,22.9,27.1,16.5,15,15.2,15.6,16.6,14.5,13.5,20,24.7,21.2,19.3,16.6,19.7,18.9,35.4,22,17.4,28,23.9,22,25,19.8,19.4,22.8,18.8,20.4,22,16.2,18,15.6,13.3,17.8,15.6,15.4,19.4,13.1,50,50,19.1,23.1,29.6,30.5,36.4,33.3,32.9,22.6,23.3,21.5,21.7,50,46.7,31.7,23.7,23.7,18.5,29.6,21.9,20.9,36,43.5,24.4,32.4,33.1,35.1,46,20.1,24.8,22,28.4,22.8,16.1,22.1,23.8,17.8,21,23.1,18.5,19.3,19.8,19.4,22.2,19,18.7,31.2,22.9,18.6,22.7,23.1,50,50,15,13.9,13.3,23.2,12.1,8.5,11.9,15,7.5,16.7,9.5,16.1,14.3,9.6,17.1,18.4,15.4,17.8,14.1,12.7,21.4,19,13.3,14.6,23,23.7,21.8,21.2,19.1,20.6,21.8,24.5,22.4],".config":["Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1"]},"columns":[{"accessor":"id","name":"id","type":"character"},{"accessor":".pred","name":".pred","type":"numeric"},{"accessor":".row","name":".row","type":"numeric"},{"accessor":"medv","name":"medv","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"30c82b76dc824aafdda26ace90847ed3","key":"30c82b76dc824aafdda26ace90847ed3"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Let us take a closer look at the predicted and actual response as a scatter plot.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>test_rs <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;medv&quot;</span>]],</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_fixed</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-56-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="bagging" class="section level1">
<h1>Bagging</h1>
<p>Here we apply bagging to the <code>Boston</code> data, using the <code>randomForest</code> package in R</p>
<div id="create-the-resample-object-2" class="section level2">
<h2>Create the resample object</h2>
<p>First, we split the samples into a training set and a test set. From the training set, we create a 10-fold cross-validation data set from the training set.</p>
<p>This is done with <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::initial_split</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::training</code></a> and <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::testing</code></a></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>Boston_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(Boston)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>Boston_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(Boston_split)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>Boston_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(Boston_split)</span></code></pre></div>
</div>
<div id="create-the-preprocessor-2" class="section level2">
<h2>Create the preprocessor</h2>
<p>We create a recipe with <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipes::recipe</code></a>. No other preprocessing step is done.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>bagging_recipe <span class="ot">&lt;-</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> medv <span class="sc">~</span> ., <span class="at">data =</span> Boston_train)</span></code></pre></div>
</div>
<div id="specify-the-model-2" class="section level2">
<h2>Specify the model</h2>
<p>Use <a href="https://parsnip.tidymodels.org/reference/rand_forest.html"><code>parsnip::rand_forest</code></a>, <a href="https://parsnip.tidymodels.org/reference/set_args.html"><code>parsnip::set_mode</code></a> and <a href="https://parsnip.tidymodels.org/reference/set_engine.html"><code>parsnip::set_engine</code></a> to create the model.</p>
<p><code>mtry</code> is the number of predictors that will be randomly sampled at each split when creating the tree models. For bagging, that number is the number of columns in the predictor matrix denoted by <a href="https://parsnip.tidymodels.org/reference/descriptors.html"><code>parsnip::.cols</code></a></p>
<p><code>importance</code> set to TRUE ensures the importance of predictors are assessed.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>bagging_spec <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">.cols</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;randomForest&quot;</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>bagging_spec <span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">translate</span>()</span></code></pre></div>
<pre><code>&gt; Random Forest Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   mtry = .cols()
&gt; 
&gt; Engine-Specific Arguments:
&gt;   importance = TRUE
&gt; 
&gt; Computational engine: randomForest 
&gt; 
&gt; Model fit template:
&gt; randomForest::randomForest(x = missing_arg(), y = missing_arg(), 
&gt;     mtry = min_cols(~.cols(), x), importance = TRUE)</code></pre>
</div>
<div id="create-the-workflow-2" class="section level2">
<h2>Create the workflow</h2>
<p><a href="https://workflows.tidymodels.org/reference/workflow.html"><code>workflows::workflow</code></a>, <a href="https://workflows.tidymodels.org/reference/add_recipe.html"><code>workflows::add_recipe</code></a> and <a href="https://workflows.tidymodels.org/reference/add_model.html"><code>workflows::add_model</code></a> are used.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>bagging_workflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_recipe</span>(bagging_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_model</span>(bagging_spec)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>bagging_workflow</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: rand_forest()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; Random Forest Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   mtry = .cols()
&gt; 
&gt; Engine-Specific Arguments:
&gt;   importance = TRUE
&gt; 
&gt; Computational engine: randomForest</code></pre>
</div>
<div id="bagging-model-on-training-data" class="section level2">
<h2>Bagging model on training data</h2>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>bagging_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> bagging_workflow,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Boston_train</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="variable-importance-2" class="section level2">
<h2>Variable Importance</h2>
<p>What are the most important variables in this tree for predicting <code>medv</code>?</p>
<p>Using the <code>vip</code> package and <a href="https://workflows.tidymodels.org/reference/extract-workflow.html"><code>workflows::extract_fit_parsnip</code></a>, we have</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>vip_table <span class="ot">&lt;-</span> bagging_fit <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vi</span>()</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>vip_table <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-9246c87abbaf7ae76219" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9246c87abbaf7ae76219">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Variable":["rm","lstat","dis","ptratio","age","crim","nox","indus","tax","zn","rad","chas"],"Importance":[61.3652824676356,33.3699119140812,26.1956013721082,18.2857768357919,16.7622961790396,14.3836130261145,14.1349874421813,9.72032258705701,6.81026518656881,4.26027540995024,3.58841617092372,0.246379655344609]},"columns":[{"accessor":"Variable","name":"Variable","type":"character"},{"accessor":"Importance","name":"Importance","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"05020e04bcbf701f5fe92307786e9d9c","key":"05020e04bcbf701f5fe92307786e9d9c"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>bagging_fit <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;col&quot;</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">aesthetics =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">&quot;midnightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-64-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
<div id="bagging-model-on-test-data" class="section level2">
<h2>Bagging model on test data</h2>
<p>Finally, let’s turn to the testing data. For regression models, a <code>.pred</code>, column is added when <a href="https://parsnip.tidymodels.org/reference/augment.html"><code>parsnip::augment</code></a> is used.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> bagging_fit,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_data =</span> Boston_test</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-8f15d61b6164af94a8a2" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8f15d61b6164af94a8a2">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"crim":[0.06905,0.02985,0.08829,0.14455,0.21124,0.17004,0.22489,0.11747,1.05393,0.84054,1.00245,0.08014,0.17142,0.18836,0.04337,0.04981,0.0136,0.02055,0.11027,0.03584,0.04379,0.13554,0.09512,0.08387,0.05188,0.07151,0.02875,0.04294,0.12204,0.0686,0.12802,0.14476,0.09299,0.32982,0.55778,0.32264,4.0974,2.37934,2.14918,1.41385,1.22358,2.3004,1.20742,0.08447,0.06642,0.06888,0.10008,0.06047,0.06911,0.0315,0.02177,0.43571,0.19802,0.62356,0.38214,0.41238,0.46296,0.33045,0.09252,0.12757,0.20608,0.03548,0.01538,0.65665,0.54011,0.53412,0.82526,0.76162,0.09604,0.06127,0.09266,0.04932,0.3494,2.63548,0.79041,0.3692,0.31827,0.24522,0.1676,0.18159,0.35114,0.05083,0.03738,0.03427,0.06151,0.06162,0.01501,0.10659,8.98296,4.54192,3.67822,3.47428,4.89822,23.6482,17.8667,88.9762,20.0849,16.8118,24.3938,22.5971,8.64476,9.91655,9.59571,20.7162,14.4383,51.1358,7.05042,15.8603,7.36711,13.6781,22.0511,9.92485,6.71772,8.24809,6.80117,3.69311,4.42228,15.5757,4.64689,10.233,3.67367,0.20746,0.17331,0.2896,0.23912,0.06263,0.04741],"zn":[0,0,12.5,12.5,12.5,12.5,12.5,12.5,0,0,0,0,0,0,21,21,75,85,25,80,80,12.5,0,0,0,0,28,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,95,82.5,0,0,0,0,0,0,0,30,30,22,80,90,20,20,20,20,20,40,40,34,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,80,80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"indus":[2.18,2.18,7.87,7.87,7.87,7.87,7.87,7.87,8.14,8.14,8.14,5.96,6.91,6.91,5.64,5.64,4,0.74,5.13,3.37,3.37,6.07,12.83,12.83,4.49,4.49,15.04,15.04,2.89,2.89,8.56,10.01,25.65,21.89,21.89,21.89,19.58,19.58,19.58,19.58,19.58,19.58,19.58,4.05,4.05,2.46,2.46,2.46,3.44,1.47,2.03,10.59,10.59,6.2,6.2,6.2,6.2,6.2,4.93,4.93,5.86,3.64,3.75,3.97,3.97,3.97,3.97,3.97,6.41,6.41,6.09,2.18,9.9,9.9,9.9,9.9,9.9,9.9,7.38,7.38,7.38,5.19,5.19,5.19,5.19,4.39,2.01,1.91,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,27.74,9.69,9.69,9.69,11.93,11.93],"chas":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"nox":[0.458,0.458,0.524,0.524,0.524,0.524,0.524,0.524,0.538,0.538,0.538,0.499,0.448,0.448,0.439,0.439,0.41,0.41,0.453,0.398,0.398,0.409,0.437,0.437,0.449,0.449,0.464,0.464,0.445,0.445,0.52,0.547,0.581,0.624,0.624,0.624,0.871,0.871,0.871,0.871,0.605,0.605,0.605,0.51,0.51,0.488,0.488,0.488,0.437,0.403,0.415,0.489,0.489,0.507,0.504,0.504,0.504,0.507,0.428,0.428,0.431,0.392,0.394,0.647,0.647,0.647,0.647,0.647,0.447,0.447,0.433,0.472,0.544,0.544,0.544,0.544,0.544,0.544,0.493,0.493,0.493,0.515,0.515,0.515,0.515,0.442,0.435,0.413,0.77,0.77,0.77,0.718,0.631,0.671,0.671,0.671,0.7,0.7,0.7,0.7,0.693,0.693,0.693,0.659,0.597,0.597,0.614,0.679,0.679,0.74,0.74,0.74,0.713,0.713,0.713,0.713,0.584,0.58,0.614,0.614,0.583,0.609,0.585,0.585,0.585,0.573,0.573],"rm":[7.147,6.43,6.012,6.172,5.631,6.004,6.377,6.009,5.935,5.599,6.674,5.85,5.682,5.786,6.115,5.998,5.888,6.383,6.456,6.29,5.787,5.594,6.286,5.874,6.015,6.121,6.211,6.249,6.625,7.416,6.474,5.731,5.961,5.822,6.335,5.942,5.468,6.13,5.709,6.129,6.943,6.319,5.875,5.859,6.86,6.144,6.563,6.153,6.739,6.975,7.61,5.344,6.182,6.879,8.04,7.163,7.412,6.086,6.606,6.393,5.593,5.876,7.454,6.842,7.203,7.52,7.327,5.56,6.854,6.826,6.495,6.849,5.972,4.973,6.122,6.567,5.914,5.782,6.426,6.376,6.041,6.316,6.31,5.869,5.968,5.898,6.635,5.936,6.212,6.398,5.362,8.78,4.97,6.38,6.223,6.968,4.368,5.277,4.652,5,6.193,5.852,6.404,4.138,6.852,5.757,6.103,5.896,6.193,5.935,5.818,6.251,6.749,7.393,6.081,6.376,6.003,5.926,6.98,6.185,6.312,5.093,5.707,5.39,6.019,6.593,6.03],"age":[54.2,58.7,66.6,96.1,100,85.9,94.3,82.9,29.3,85.7,87.3,41.5,33.8,33.3,63,21.4,47.6,35.7,67.8,17.8,31.1,36.8,45,36.6,45.1,56.8,28.9,77.3,57.8,62.5,97.1,65.2,92.9,95.4,98.2,93.5,100,100,98.5,96,97.4,96.1,94.6,68.7,74.4,62.2,95.6,68.8,30.8,15.3,15.7,100,42.4,77.7,86.5,79.9,76.9,61.5,42.2,7.8,76.5,19.1,34.2,100,81.8,89.4,94.5,62.8,42.8,27.6,18.4,70.3,76.7,37.8,52.8,87.3,83.2,71.7,52.3,54.3,49.9,38.1,38.5,46.3,58.5,52.3,29.7,19.5,97.4,88,96.2,82.9,100,96.2,100,91.9,91.2,98.1,100,89.5,92.6,77.8,100,100,100,100,85.1,95.4,78.1,87.9,92.4,96.6,92.6,99.3,84.4,88.4,94.5,71,67.6,96.7,51.9,98,54,72.9,65.3,69.1,80.8],"dis":[6.0622,6.0622,5.5605,5.9505,6.0821,6.5921,6.3467,6.2267,4.4986,4.4546,4.239,3.9342,5.1004,5.1004,6.8147,6.8147,7.3197,9.1876,7.2255,6.6115,6.6115,6.498,4.5026,4.5026,4.4272,3.7476,3.6659,3.615,3.4952,3.4952,2.4329,2.7592,2.0869,2.4699,2.1107,1.9669,1.4118,1.4191,1.6232,1.7494,1.8773,2.1,2.4259,2.7019,2.9153,2.5979,2.847,3.2797,6.4798,7.6534,6.27,3.875,3.9454,3.2721,3.2157,3.2157,3.6715,3.6519,6.1899,7.0355,7.9549,9.2203,6.3361,2.0107,2.1121,2.1398,2.0788,1.9865,4.2673,4.8628,5.4917,3.1827,3.1025,2.5194,2.6403,3.6023,3.9986,4.0317,4.5404,4.5404,4.7211,6.4584,6.4584,5.2311,4.8122,8.0136,8.344,10.5857,2.1222,2.5182,2.1036,1.9047,1.3325,1.3861,1.3861,1.4165,1.4395,1.4261,1.4672,1.5184,1.7912,1.5004,1.639,1.1781,1.4655,1.413,2.0218,1.9096,1.9356,1.8206,1.8662,2.198,2.3236,2.4527,2.7175,2.5671,2.5403,2.9084,2.5329,2.1705,3.9917,1.8226,2.3817,2.7986,2.4091,2.4786,2.505],"rad":[3,3,5,5,5,5,5,5,4,4,4,5,3,3,4,4,3,2,8,4,4,4,5,5,3,3,4,4,2,2,5,6,2,4,4,4,5,5,5,5,5,5,5,5,5,3,3,3,5,3,2,4,4,8,8,8,8,8,6,6,7,1,3,5,5,5,5,5,4,4,7,7,4,4,4,4,4,4,5,5,5,5,5,5,5,3,4,4,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,4,6,6,6,1,1],"tax":[222,222,311,311,311,311,311,311,307,307,307,279,233,233,243,243,469,313,284,337,337,345,398,398,247,247,270,270,276,276,384,432,188,437,437,437,403,403,403,403,403,403,403,296,296,193,193,193,398,402,348,277,277,307,307,307,307,307,300,300,330,315,244,264,264,264,264,264,254,254,329,222,304,304,304,304,304,304,287,287,287,224,224,224,224,352,280,334,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,711,391,391,391,273,273],"ptratio":[18.7,18.7,15.2,15.2,15.2,15.2,15.2,15.2,21,21,21,19.2,17.9,17.9,16.8,16.8,21.1,17.3,19.7,16.1,16.1,18.9,18.7,18.7,18.5,18.5,18.2,18.2,18,18,20.9,17.8,19.1,21.2,21.2,21.2,14.7,14.7,14.7,14.7,14.7,14.7,14.7,16.6,16.6,17.8,17.8,17.8,15.2,17,14.7,18.6,18.6,17.4,17.4,17.4,17.4,17.4,16.6,16.6,19.1,16.4,15.9,13,13,13,13,13,17.6,17.6,16.1,18.4,18.4,18.4,18.4,18.4,18.4,18.4,19.6,19.6,19.6,20.2,20.2,20.2,20.2,18.8,17,22,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.1,19.2,19.2,19.2,21,21],"lstat":[5.33,5.21,12.43,19.15,29.93,17.1,20.45,13.27,6.58,16.51,11.98,8.77,10.21,14.15,9.43,8.43,14.8,5.77,6.73,4.67,10.24,13.09,8.94,9.1,12.86,8.44,6.21,10.59,6.65,6.19,12.27,13.61,17.93,15.03,16.96,16.9,26.42,27.8,15.79,15.12,4.59,11.1,14.43,9.64,6.92,9.45,5.68,13.15,4.69,4.56,3.11,23.09,9.47,9.93,3.13,6.36,5.25,10.88,7.37,5.19,12.5,9.25,3.11,6.9,9.59,7.26,11.25,10.45,2.98,4.16,8.67,7.53,9.97,12.64,5.98,9.28,18.33,15.94,7.2,6.87,7.7,5.68,6.75,9.8,9.29,12.67,5.99,5.57,17.6,7.79,10.19,5.29,3.26,23.69,21.78,17.21,30.63,30.81,28.28,31.99,15.17,29.97,20.31,23.34,19.78,10.11,23.29,24.39,21.52,34.02,22.11,16.44,17.44,16.74,14.7,14.65,21.32,18.13,11.66,18.03,10.58,29.68,12.01,21.14,12.92,9.67,7.88],"medv":[36.2,28.7,22.9,27.1,16.5,18.9,15,18.9,23.1,13.9,21,21,19.3,20,20.5,23.4,18.9,24.7,22.2,23.5,19.4,17.4,21.4,20.3,22.5,22.2,25,20.6,28.4,33.2,19.8,19.3,20.5,18.4,18.1,17.4,15.6,13.8,19.4,17,41.3,23.8,17.4,22.6,29.9,36.2,32.5,29.6,30.5,34.9,42.3,20,25,27.5,37.6,31.6,31.7,24,23.3,23.7,17.6,20.9,44,30.1,33.8,43.1,31,22.8,32,33.1,26.4,28.2,20.3,16.1,22.1,23.8,17.8,19.8,23.8,23.1,20.4,22.2,20.7,19.5,18.7,17.2,24.5,20.6,17.8,25,20.8,21.9,50,13.1,10.2,10.4,8.8,7.2,10.5,7.4,13.8,6.3,12.1,11.9,27.5,15,13.4,8.3,11,8.4,10.5,12.6,13.4,17.8,20,17.7,19.1,19.1,29.8,14.6,21.2,8.1,21.8,19.7,21.2,22.4,11.9],".pred":[34.8527533333333,24.4627433333333,20.8850533333333,18.0791166666667,17.0618,19.7200933333333,17.6217066666667,20.25968,23.6811433333333,16.0723766666667,22.93123,21.2055,20.6276366666666,20.8824566666667,21.4118033333333,21.0589566666666,19.1138066666667,23.1156833333333,23.9362066666667,23.9356133333333,19.7209,20.1959633333333,22.21068,21.34041,20.8650766666667,22.31633,24.6972433333333,21.5236733333333,26.5705833333334,34.1259633333334,19.7525166666667,19.8398,18.7628533333333,17.1298633333333,17.0535833333334,16.7454733333333,13.93065,14.68441,15.7296933333334,16.24471,31.1917333333333,21.63599,19.22188,21.7797666666667,26.9176666666666,22.71951,27.7477933333333,22.55144,30.15453,32.5647366666667,47.0451133333334,17.28406,24.4233666666667,25.8968966666667,46.53265,31.6416233333334,33.2999466666667,22.8367266666666,26.0305033333333,24.1642633333333,19.5248766666666,20.19407,41.7374566666667,29.6866833333333,33.7232566666667,44.5759333333333,32.0055633333334,22.21267,30.56917,31.29906,23.11733,27.86111,20.89111,20.63312,24.5383,25.00426,18.7086733333333,20.1705533333333,24.39709,24.3544466666667,22.7436866666667,24.4696766666667,24.3248933333333,19.55263,19.96349,19.3806866666667,27.1029633333333,22.4851233333333,14.52776,23.32747,21.3438,41.6369900000001,39.1489033333333,11.3061966666667,12.1215966666667,18.50164,9.62607,9.46184666666666,8.00268666666666,8.41907333333333,14.1100166666667,11.1725766666667,10.8909233333333,14.0337166666667,15.7109566666667,28.9301033333333,14.80926,9.61479333333332,14.3590966666667,9.75212333333332,9.51110666666667,14.7552533333333,15.2614233333333,26.5638266666667,17.5078066666667,17.7342933333333,13.8186033333333,14.1327166666667,26.8338266666667,14.10874,21.82065,11.26883,20.1611633333333,18.6006333333333,21.1360966666666,24.3697866666667,20.92254]},"columns":[{"accessor":"crim","name":"crim","type":"numeric"},{"accessor":"zn","name":"zn","type":"numeric"},{"accessor":"indus","name":"indus","type":"numeric"},{"accessor":"chas","name":"chas","type":"numeric"},{"accessor":"nox","name":"nox","type":"numeric"},{"accessor":"rm","name":"rm","type":"numeric"},{"accessor":"age","name":"age","type":"numeric"},{"accessor":"dis","name":"dis","type":"numeric"},{"accessor":"rad","name":"rad","type":"numeric"},{"accessor":"tax","name":"tax","type":"numeric"},{"accessor":"ptratio","name":"ptratio","type":"numeric"},{"accessor":"lstat","name":"lstat","type":"numeric"},{"accessor":"medv","name":"medv","type":"numeric"},{"accessor":".pred","name":".pred","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"384a16ed23041da19cf1ea7ffe1435fb","key":"384a16ed23041da19cf1ea7ffe1435fb"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>We check how well the <code>.pred</code> column matches the <code>medv</code> using <a href="https://yardstick.tidymodels.org/reference/rmse.html"><code>yardstick::rmse</code></a>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">rmse</span>(<span class="at">truth =</span> .data[[<span class="st">&quot;medv&quot;</span>]], <span class="at">estimate =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-27424792bc78c3775352" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-27424792bc78c3775352">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["rmse"],".estimator":["standard"],".estimate":[3.99212923055419]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"bb80951c7b47b6e4a140e63647907848","key":"bb80951c7b47b6e4a140e63647907848"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Let us take a closer look at the predicted and actual response as a scatter plot.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;medv&quot;</span>]],</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_fixed</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-67-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="random-forest" class="section level1">
<h1>Random Forest</h1>
<p>Here we apply random forest to the <code>Boston</code> data, using the <code>randomForest</code> package in R</p>
<div id="create-the-rsample-object" class="section level2">
<h2>Create the rsample object</h2>
<p>First, we split the samples into a training set and a test set. From the training set, we create a 10-fold cross-validation data set from the training set.</p>
<p>This is done with <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::initial_split</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::training</code></a> and <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::testing</code></a></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>Boston_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(Boston)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>Boston_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(Boston_split)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>Boston_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(Boston_split)</span></code></pre></div>
</div>
<div id="create-the-preprocessor-3" class="section level2">
<h2>Create the preprocessor</h2>
<p>We create a recipe with <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipes::recipe</code></a>. No other preprocessing step is done.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>rf_recipe <span class="ot">&lt;-</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> medv <span class="sc">~</span> ., <span class="at">data =</span> Boston_train)</span></code></pre></div>
</div>
<div id="specify-the-model-3" class="section level2">
<h2>Specify the model</h2>
<p>Use <a href="https://parsnip.tidymodels.org/reference/rand_forest.html"><code>parsnip::rand_forest</code></a>, <a href="https://parsnip.tidymodels.org/reference/set_args.html"><code>parsnip::set_mode</code></a> and <a href="https://parsnip.tidymodels.org/reference/set_engine.html"><code>parsnip::set_engine</code></a> to create the model.</p>
<p><code>mtry</code> is the number of predictors that will be randomly sampled at each split when creating the tree models. For random forest, the <code>randomForest::randomForest</code> use <span class="math inline">\(\frac{p}{3}\)</span> variables when building a random forest of regression trees and <span class="math inline">\(\sqrt{p}\)</span> variables when building a random forest of classification trees.</p>
<p><code>importance</code> set to TRUE ensures the importance of predictors are assessed.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>rf_spec <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">rand_forest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;randomForest&quot;</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>rf_spec <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">translate</span>()</span></code></pre></div>
<pre><code>&gt; Random Forest Model Specification (regression)
&gt; 
&gt; Engine-Specific Arguments:
&gt;   importance = TRUE
&gt; 
&gt; Computational engine: randomForest 
&gt; 
&gt; Model fit template:
&gt; randomForest::randomForest(x = missing_arg(), y = missing_arg(), 
&gt;     importance = TRUE)</code></pre>
</div>
<div id="create-the-workflow-3" class="section level2">
<h2>Create the workflow</h2>
<p><a href="https://workflows.tidymodels.org/reference/workflow.html"><code>workflows::workflow</code></a>, <a href="https://workflows.tidymodels.org/reference/add_recipe.html"><code>workflows::add_recipe</code></a> and <a href="https://workflows.tidymodels.org/reference/add_model.html"><code>workflows::add_model</code></a> are used.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>rf_workflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_recipe</span>(rf_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_model</span>(rf_spec)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>rf_workflow</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: rand_forest()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; Random Forest Model Specification (regression)
&gt; 
&gt; Engine-Specific Arguments:
&gt;   importance = TRUE
&gt; 
&gt; Computational engine: randomForest</code></pre>
</div>
<div id="random-forest-on-training-data" class="section level2">
<h2>Random forest on training data</h2>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> rf_workflow,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Boston_train</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="variable-importance-3" class="section level2">
<h2>Variable Importance</h2>
<p>What are the most important variables in this tree for predicting <code>medv</code>?</p>
<p>Using the <code>vip</code> package and <a href="https://workflows.tidymodels.org/reference/extract-workflow.html"><code>workflows::extract_fit_parsnip</code></a>, we have</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>vip_table <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vi</span>()</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>vip_table <span class="sc">%&gt;%</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-f9c65f1018a28164aeae" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f9c65f1018a28164aeae">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Variable":["rm","lstat","crim","dis","nox","ptratio","age","tax","indus","rad","chas","zn"],"Importance":[34.0054969642068,29.511240194607,15.8040308362609,14.7297306088055,14.1024973861072,14.0624880692721,12.132564181169,10.80653782895,9.23077055771097,6.49062595434635,3.95413532053459,3.8250256191875]},"columns":[{"accessor":"Variable","name":"Variable","type":"character"},{"accessor":"Importance","name":"Importance","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"012c1988f6054beb2fd6094f388a3952","key":"012c1988f6054beb2fd6094f388a3952"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>(</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;col&quot;</span>,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">aesthetics =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">&quot;midnightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-75-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>The <code>randomForest</code> package also has functions like <code>randomForest::importance</code> to view the importance of each variable as well. The key is to use <a href="https://workflows.tidymodels.org/reference/extract-workflow.html"><code>workflows::extract_fit_engine</code></a></p>
<p>The first is based upon the mean decrease of accuracy in predictions on the out of bag samples when a given variable is permuted.</p>
<p>The second is a measure of the total decrease in node impurity that results from splits over that variable, averaged over all trees.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>importance_table <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  randomForest<span class="sc">::</span><span class="fu">importance</span>()</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>importance_table <span class="sc">%&gt;%</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-1d0915b830e2584f4893" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1d0915b830e2584f4893">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".rownames":["crim","zn","indus","chas","nox","rm","age","dis","rad","tax","ptratio","lstat"],"%IncMSE":[15.8040308362609,3.8250256191875,9.23077055771097,3.95413532053459,14.1024973861072,34.0054969642068,12.132564181169,14.7297306088055,6.49062595434635,10.80653782895,14.0624880692721,29.511240194607],"IncNodePurity":[1935.10204027607,245.731510125487,2054.73143058912,271.141932449932,1988.39844718041,10988.6271370745,1123.17280726575,1931.87337874561,254.027514871199,1032.24779663059,2083.83097697073,9424.66418247461]},"columns":[{"accessor":".rownames","name":"","type":"character","sortable":false,"filterable":false},{"accessor":"%IncMSE","name":"%IncMSE","type":"numeric"},{"accessor":"IncNodePurity","name":"IncNodePurity","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"da9e728728643bce23e68a63e287e08f","key":"da9e728728643bce23e68a63e287e08f"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Plots of these importance measures can be produced using the <code>randomForest::varImpPlot</code> function.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  randomForest<span class="sc">::</span><span class="fu">varImpPlot</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-77-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
<div id="random-forest-on-test-data" class="section level2">
<h2>Random forest on test data</h2>
<p>Finally, let’s turn to the testing data. For regression models, a <code>.pred</code>, column is added when <a href="https://parsnip.tidymodels.org/reference/augment.html"><code>parsnip::augment</code></a> is used.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> rf_fit,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_data =</span> Boston_test</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-0b2450c22e55e4a5515d" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0b2450c22e55e4a5515d">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"crim":[0.06905,0.02985,0.08829,0.14455,0.21124,0.17004,0.22489,0.11747,1.05393,0.84054,1.00245,0.08014,0.17142,0.18836,0.04337,0.04981,0.0136,0.02055,0.11027,0.03584,0.04379,0.13554,0.09512,0.08387,0.05188,0.07151,0.02875,0.04294,0.12204,0.0686,0.12802,0.14476,0.09299,0.32982,0.55778,0.32264,4.0974,2.37934,2.14918,1.41385,1.22358,2.3004,1.20742,0.08447,0.06642,0.06888,0.10008,0.06047,0.06911,0.0315,0.02177,0.43571,0.19802,0.62356,0.38214,0.41238,0.46296,0.33045,0.09252,0.12757,0.20608,0.03548,0.01538,0.65665,0.54011,0.53412,0.82526,0.76162,0.09604,0.06127,0.09266,0.04932,0.3494,2.63548,0.79041,0.3692,0.31827,0.24522,0.1676,0.18159,0.35114,0.05083,0.03738,0.03427,0.06151,0.06162,0.01501,0.10659,8.98296,4.54192,3.67822,3.47428,4.89822,23.6482,17.8667,88.9762,20.0849,16.8118,24.3938,22.5971,8.64476,9.91655,9.59571,20.7162,14.4383,51.1358,7.05042,15.8603,7.36711,13.6781,22.0511,9.92485,6.71772,8.24809,6.80117,3.69311,4.42228,15.5757,4.64689,10.233,3.67367,0.20746,0.17331,0.2896,0.23912,0.06263,0.04741],"zn":[0,0,12.5,12.5,12.5,12.5,12.5,12.5,0,0,0,0,0,0,21,21,75,85,25,80,80,12.5,0,0,0,0,28,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,95,82.5,0,0,0,0,0,0,0,30,30,22,80,90,20,20,20,20,20,40,40,34,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,80,80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"indus":[2.18,2.18,7.87,7.87,7.87,7.87,7.87,7.87,8.14,8.14,8.14,5.96,6.91,6.91,5.64,5.64,4,0.74,5.13,3.37,3.37,6.07,12.83,12.83,4.49,4.49,15.04,15.04,2.89,2.89,8.56,10.01,25.65,21.89,21.89,21.89,19.58,19.58,19.58,19.58,19.58,19.58,19.58,4.05,4.05,2.46,2.46,2.46,3.44,1.47,2.03,10.59,10.59,6.2,6.2,6.2,6.2,6.2,4.93,4.93,5.86,3.64,3.75,3.97,3.97,3.97,3.97,3.97,6.41,6.41,6.09,2.18,9.9,9.9,9.9,9.9,9.9,9.9,7.38,7.38,7.38,5.19,5.19,5.19,5.19,4.39,2.01,1.91,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,27.74,9.69,9.69,9.69,11.93,11.93],"chas":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"nox":[0.458,0.458,0.524,0.524,0.524,0.524,0.524,0.524,0.538,0.538,0.538,0.499,0.448,0.448,0.439,0.439,0.41,0.41,0.453,0.398,0.398,0.409,0.437,0.437,0.449,0.449,0.464,0.464,0.445,0.445,0.52,0.547,0.581,0.624,0.624,0.624,0.871,0.871,0.871,0.871,0.605,0.605,0.605,0.51,0.51,0.488,0.488,0.488,0.437,0.403,0.415,0.489,0.489,0.507,0.504,0.504,0.504,0.507,0.428,0.428,0.431,0.392,0.394,0.647,0.647,0.647,0.647,0.647,0.447,0.447,0.433,0.472,0.544,0.544,0.544,0.544,0.544,0.544,0.493,0.493,0.493,0.515,0.515,0.515,0.515,0.442,0.435,0.413,0.77,0.77,0.77,0.718,0.631,0.671,0.671,0.671,0.7,0.7,0.7,0.7,0.693,0.693,0.693,0.659,0.597,0.597,0.614,0.679,0.679,0.74,0.74,0.74,0.713,0.713,0.713,0.713,0.584,0.58,0.614,0.614,0.583,0.609,0.585,0.585,0.585,0.573,0.573],"rm":[7.147,6.43,6.012,6.172,5.631,6.004,6.377,6.009,5.935,5.599,6.674,5.85,5.682,5.786,6.115,5.998,5.888,6.383,6.456,6.29,5.787,5.594,6.286,5.874,6.015,6.121,6.211,6.249,6.625,7.416,6.474,5.731,5.961,5.822,6.335,5.942,5.468,6.13,5.709,6.129,6.943,6.319,5.875,5.859,6.86,6.144,6.563,6.153,6.739,6.975,7.61,5.344,6.182,6.879,8.04,7.163,7.412,6.086,6.606,6.393,5.593,5.876,7.454,6.842,7.203,7.52,7.327,5.56,6.854,6.826,6.495,6.849,5.972,4.973,6.122,6.567,5.914,5.782,6.426,6.376,6.041,6.316,6.31,5.869,5.968,5.898,6.635,5.936,6.212,6.398,5.362,8.78,4.97,6.38,6.223,6.968,4.368,5.277,4.652,5,6.193,5.852,6.404,4.138,6.852,5.757,6.103,5.896,6.193,5.935,5.818,6.251,6.749,7.393,6.081,6.376,6.003,5.926,6.98,6.185,6.312,5.093,5.707,5.39,6.019,6.593,6.03],"age":[54.2,58.7,66.6,96.1,100,85.9,94.3,82.9,29.3,85.7,87.3,41.5,33.8,33.3,63,21.4,47.6,35.7,67.8,17.8,31.1,36.8,45,36.6,45.1,56.8,28.9,77.3,57.8,62.5,97.1,65.2,92.9,95.4,98.2,93.5,100,100,98.5,96,97.4,96.1,94.6,68.7,74.4,62.2,95.6,68.8,30.8,15.3,15.7,100,42.4,77.7,86.5,79.9,76.9,61.5,42.2,7.8,76.5,19.1,34.2,100,81.8,89.4,94.5,62.8,42.8,27.6,18.4,70.3,76.7,37.8,52.8,87.3,83.2,71.7,52.3,54.3,49.9,38.1,38.5,46.3,58.5,52.3,29.7,19.5,97.4,88,96.2,82.9,100,96.2,100,91.9,91.2,98.1,100,89.5,92.6,77.8,100,100,100,100,85.1,95.4,78.1,87.9,92.4,96.6,92.6,99.3,84.4,88.4,94.5,71,67.6,96.7,51.9,98,54,72.9,65.3,69.1,80.8],"dis":[6.0622,6.0622,5.5605,5.9505,6.0821,6.5921,6.3467,6.2267,4.4986,4.4546,4.239,3.9342,5.1004,5.1004,6.8147,6.8147,7.3197,9.1876,7.2255,6.6115,6.6115,6.498,4.5026,4.5026,4.4272,3.7476,3.6659,3.615,3.4952,3.4952,2.4329,2.7592,2.0869,2.4699,2.1107,1.9669,1.4118,1.4191,1.6232,1.7494,1.8773,2.1,2.4259,2.7019,2.9153,2.5979,2.847,3.2797,6.4798,7.6534,6.27,3.875,3.9454,3.2721,3.2157,3.2157,3.6715,3.6519,6.1899,7.0355,7.9549,9.2203,6.3361,2.0107,2.1121,2.1398,2.0788,1.9865,4.2673,4.8628,5.4917,3.1827,3.1025,2.5194,2.6403,3.6023,3.9986,4.0317,4.5404,4.5404,4.7211,6.4584,6.4584,5.2311,4.8122,8.0136,8.344,10.5857,2.1222,2.5182,2.1036,1.9047,1.3325,1.3861,1.3861,1.4165,1.4395,1.4261,1.4672,1.5184,1.7912,1.5004,1.639,1.1781,1.4655,1.413,2.0218,1.9096,1.9356,1.8206,1.8662,2.198,2.3236,2.4527,2.7175,2.5671,2.5403,2.9084,2.5329,2.1705,3.9917,1.8226,2.3817,2.7986,2.4091,2.4786,2.505],"rad":[3,3,5,5,5,5,5,5,4,4,4,5,3,3,4,4,3,2,8,4,4,4,5,5,3,3,4,4,2,2,5,6,2,4,4,4,5,5,5,5,5,5,5,5,5,3,3,3,5,3,2,4,4,8,8,8,8,8,6,6,7,1,3,5,5,5,5,5,4,4,7,7,4,4,4,4,4,4,5,5,5,5,5,5,5,3,4,4,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,4,6,6,6,1,1],"tax":[222,222,311,311,311,311,311,311,307,307,307,279,233,233,243,243,469,313,284,337,337,345,398,398,247,247,270,270,276,276,384,432,188,437,437,437,403,403,403,403,403,403,403,296,296,193,193,193,398,402,348,277,277,307,307,307,307,307,300,300,330,315,244,264,264,264,264,264,254,254,329,222,304,304,304,304,304,304,287,287,287,224,224,224,224,352,280,334,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,711,391,391,391,273,273],"ptratio":[18.7,18.7,15.2,15.2,15.2,15.2,15.2,15.2,21,21,21,19.2,17.9,17.9,16.8,16.8,21.1,17.3,19.7,16.1,16.1,18.9,18.7,18.7,18.5,18.5,18.2,18.2,18,18,20.9,17.8,19.1,21.2,21.2,21.2,14.7,14.7,14.7,14.7,14.7,14.7,14.7,16.6,16.6,17.8,17.8,17.8,15.2,17,14.7,18.6,18.6,17.4,17.4,17.4,17.4,17.4,16.6,16.6,19.1,16.4,15.9,13,13,13,13,13,17.6,17.6,16.1,18.4,18.4,18.4,18.4,18.4,18.4,18.4,19.6,19.6,19.6,20.2,20.2,20.2,20.2,18.8,17,22,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.1,19.2,19.2,19.2,21,21],"lstat":[5.33,5.21,12.43,19.15,29.93,17.1,20.45,13.27,6.58,16.51,11.98,8.77,10.21,14.15,9.43,8.43,14.8,5.77,6.73,4.67,10.24,13.09,8.94,9.1,12.86,8.44,6.21,10.59,6.65,6.19,12.27,13.61,17.93,15.03,16.96,16.9,26.42,27.8,15.79,15.12,4.59,11.1,14.43,9.64,6.92,9.45,5.68,13.15,4.69,4.56,3.11,23.09,9.47,9.93,3.13,6.36,5.25,10.88,7.37,5.19,12.5,9.25,3.11,6.9,9.59,7.26,11.25,10.45,2.98,4.16,8.67,7.53,9.97,12.64,5.98,9.28,18.33,15.94,7.2,6.87,7.7,5.68,6.75,9.8,9.29,12.67,5.99,5.57,17.6,7.79,10.19,5.29,3.26,23.69,21.78,17.21,30.63,30.81,28.28,31.99,15.17,29.97,20.31,23.34,19.78,10.11,23.29,24.39,21.52,34.02,22.11,16.44,17.44,16.74,14.7,14.65,21.32,18.13,11.66,18.03,10.58,29.68,12.01,21.14,12.92,9.67,7.88],"medv":[36.2,28.7,22.9,27.1,16.5,18.9,15,18.9,23.1,13.9,21,21,19.3,20,20.5,23.4,18.9,24.7,22.2,23.5,19.4,17.4,21.4,20.3,22.5,22.2,25,20.6,28.4,33.2,19.8,19.3,20.5,18.4,18.1,17.4,15.6,13.8,19.4,17,41.3,23.8,17.4,22.6,29.9,36.2,32.5,29.6,30.5,34.9,42.3,20,25,27.5,37.6,31.6,31.7,24,23.3,23.7,17.6,20.9,44,30.1,33.8,43.1,31,22.8,32,33.1,26.4,28.2,20.3,16.1,22.1,23.8,17.8,19.8,23.8,23.1,20.4,22.2,20.7,19.5,18.7,17.2,24.5,20.6,17.8,25,20.8,21.9,50,13.1,10.2,10.4,8.8,7.2,10.5,7.4,13.8,6.3,12.1,11.9,27.5,15,13.4,8.3,11,8.4,10.5,12.6,13.4,17.8,20,17.7,19.1,19.1,29.8,14.6,21.2,8.1,21.8,19.7,21.2,22.4,11.9],".pred":[33.8693433333333,26.0088533333334,21.3494960784314,18.7044166666667,17.67387,20.050189714795,18.93172,20.6060830481284,21.7954949673203,16.325840681606,20.1385770308123,21.9082366666666,21.2237233333334,21.1903866666667,21.8856133333333,21.64986,19.0990933333333,24.2439466666667,23.4593333333333,25.7618366666667,20.4513366666667,20.22101,23.0944866666667,22.0684166666667,20.9679633333333,22.8423633333333,24.4194866666667,21.5973066666667,26.97045,32.95081,19.8295516666667,20.1398866666667,18.9606573809524,17.4219366666667,17.3088640476191,16.3418833333333,14.2272017301587,15.4885949047619,16.0969046825397,17.6764280952381,33.22694,21.7785188095238,20.6737433333333,22.3880433333333,27.4450233333333,25.0111866666666,28.22118,23.5316033333333,30.79298,31.97342,43.0812995238095,18.3467176190476,24.4058,26.29794,46.0858061904762,32.8969866666667,33.7793933333333,23.16598,25.3477066666667,24.9704966666667,19.3238466666667,20.73922,39.12809,31.55135,34.53624,41.5111833333333,32.7839566666667,24.9159833333334,31.7934033333333,31.6667133333333,23.6830711111111,28.8572133333333,20.96536,20.5263611111111,24.0431166666667,23.91997,19.1675833333333,19.7421633333333,24.2520066666667,24.2220966666667,22.9949733333333,23.5489583333334,23.152475,19.5973133333334,20.3242766666667,19.2209033333333,26.6926833333333,21.7896466666667,15.8312791886811,25.0452342156863,20.7750903508772,35.9711187394958,38.383568128655,11.0551357491028,11.3131706639253,14.9502147966948,10.5036717583946,9.96353608458708,8.9479142589195,9.81071853710606,13.7570133980647,10.7043591641084,10.7936735024513,16.4280487739349,15.7829998504231,21.8379045815311,14.593074190849,9.89700790314102,12.8338566922695,10.6117162988244,10.2395467506977,14.4985430097489,15.3042865816122,19.9603057194753,17.280886644103,17.7222208232572,14.6216820378738,15.4937015784216,24.5278325490197,14.6025203488368,21.2479250520721,11.9096965656566,20.59938,18.5434711111111,20.3916966666666,23.0293788888889,21.2446005555556]},"columns":[{"accessor":"crim","name":"crim","type":"numeric"},{"accessor":"zn","name":"zn","type":"numeric"},{"accessor":"indus","name":"indus","type":"numeric"},{"accessor":"chas","name":"chas","type":"numeric"},{"accessor":"nox","name":"nox","type":"numeric"},{"accessor":"rm","name":"rm","type":"numeric"},{"accessor":"age","name":"age","type":"numeric"},{"accessor":"dis","name":"dis","type":"numeric"},{"accessor":"rad","name":"rad","type":"numeric"},{"accessor":"tax","name":"tax","type":"numeric"},{"accessor":"ptratio","name":"ptratio","type":"numeric"},{"accessor":"lstat","name":"lstat","type":"numeric"},{"accessor":"medv","name":"medv","type":"numeric"},{"accessor":".pred","name":".pred","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"3bf77dc296bbbe243a59614adf766427","key":"3bf77dc296bbbe243a59614adf766427"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>We check how well the <code>.pred</code> column matches the <code>medv</code> using <a href="https://yardstick.tidymodels.org/reference/rmse.html"><code>yardstick::rmse</code></a>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">rmse</span>(<span class="at">truth =</span> .data[[<span class="st">&quot;medv&quot;</span>]], <span class="at">estimate =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-9291966aef1e05064703" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9291966aef1e05064703">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["rmse"],".estimator":["standard"],".estimate":[3.37929255644316]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"1740e767e542000d558b2a9f6cc22ae1","key":"1740e767e542000d558b2a9f6cc22ae1"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Let us take a closer look at the predicted and actual response as a scatter plot.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;medv&quot;</span>]],</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_fixed</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-80-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="boosting" class="section level1">
<h1>Boosting</h1>
<p>Here we apply bagging to the <code>Boston</code> data. The book uses the R package <code>gbm</code> to do the boosting. Unfortunately, <code>gbm</code> is not one of the list boosted tree models in the current <a href="https://parsnip.tidymodels.org/reference/boost_tree.html">parsnip list</a>.</p>
<p>The process of building it from scratch can be found in this <a href="https://github.com/tidymodels/parsnip/issues/220">github issue post</a></p>
<p>For simplicity, a different R package is used to create a bagging tree model. In this example, the default parsnip engine for boosted tree is the <code>xgboost</code> R package.</p>
<div id="create-the-resample-object-3" class="section level2">
<h2>Create the resample object</h2>
<p>First, we split the samples into a training set and a test set. From the training set, we create a 10-fold cross-validation data set from the training set.</p>
<p>This is done with <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::initial_split</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::training</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::testing</code></a> and <a href="https://rsample.tidymodels.org/reference/vfold_cv.html"><code>rsample::vfold_cv</code></a>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>Boston_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(Boston)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>Boston_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(Boston_split)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>Boston_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(Boston_split)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>Boston_fold <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(Boston_train, <span class="at">v =</span> <span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="create-the-preprocessor-4" class="section level2">
<h2>Create the preprocessor</h2>
<p>We create a recipe with <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipes::recipe</code></a>. No other preprocessing step is done.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>boost_recipe <span class="ot">&lt;-</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> medv <span class="sc">~</span> ., <span class="at">data =</span> Boston_train)</span></code></pre></div>
</div>
<div id="specify-the-model-4" class="section level2">
<h2>Specify the model</h2>
<p>Use <a href="https://parsnip.tidymodels.org/reference/boost_tree.html"><code>parsnip::boost_tree</code></a>, <a href="https://parsnip.tidymodels.org/reference/set_args.html"><code>parsnip::set_mode</code></a> and <a href="https://parsnip.tidymodels.org/reference/set_engine.html"><code>parsnip::set_engine</code></a> to create the model.</p>
<p>Recall in the book that we can tune the number of trees <code>trees</code>, the shrinkage parameter <code>learn_rate</code> and the number of splits/depth <code>tree_depth</code>.</p>
<p>These can be tuned using <a href="https://hardhat.tidymodels.org/reference/tune.html"><code>tune::tune</code></a></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>boost_spec <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">boost_tree</span>(</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">trees =</span> tune<span class="sc">::</span><span class="fu">tune</span>(),</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree_depth =</span> tune<span class="sc">::</span><span class="fu">tune</span>(),</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">learn_rate =</span> tune<span class="sc">::</span><span class="fu">tune</span>()</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>boost_spec <span class="sc">%&gt;%</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">translate</span>()</span></code></pre></div>
<pre><code>&gt; Boosted Tree Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   trees = tune::tune()
&gt;   tree_depth = tune::tune()
&gt;   learn_rate = tune::tune()
&gt; 
&gt; Computational engine: xgboost 
&gt; 
&gt; Model fit template:
&gt; parsnip::xgb_train(x = missing_arg(), y = missing_arg(), nrounds = tune::tune(), 
&gt;     max_depth = tune::tune(), eta = tune::tune(), nthread = 1, 
&gt;     verbose = 0)</code></pre>
</div>
<div id="create-the-workflow-4" class="section level2">
<h2>Create the workflow</h2>
<p><a href="https://workflows.tidymodels.org/reference/workflow.html"><code>workflows::workflow</code></a>, <a href="https://workflows.tidymodels.org/reference/add_recipe.html"><code>workflows::add_recipe</code></a> and <a href="https://workflows.tidymodels.org/reference/add_model.html"><code>workflows::add_model</code></a> are used.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>boost_workflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_recipe</span>(boost_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_model</span>(boost_spec)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>boost_workflow</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: boost_tree()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; Boosted Tree Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   trees = tune::tune()
&gt;   tree_depth = tune::tune()
&gt;   learn_rate = tune::tune()
&gt; 
&gt; Computational engine: xgboost</code></pre>
</div>
<div id="create-the-boosting-tree-grid" class="section level2">
<h2>Create the boosting tree grid</h2>
<p>Let’s use a space-filling design (non-regular grid) so that we can cover the hyperparameter space as well as possible. We do this using <a href="https://dials.tidymodels.org/reference/grid_max_entropy.html"><code>dials::grid_latin_hypercube</code></a></p>
<p>We use the default values for <a href="https://dials.tidymodels.org/reference/trees.html"><code>dials::trees</code></a>, <a href="https://dials.tidymodels.org/reference/trees.html"><code>dials::tree_depth</code></a> and <a href="https://dials.tidymodels.org/reference/learn_rate.html"><code>dials::learn_rate</code></a></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>boost_grid <span class="ot">&lt;-</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  dials<span class="sc">::</span><span class="fu">grid_latin_hypercube</span>(</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    dials<span class="sc">::</span><span class="fu">trees</span>(<span class="at">range =</span> <span class="fu">c</span>(1L, 2000L)),</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    dials<span class="sc">::</span><span class="fu">tree_depth</span>(<span class="at">range =</span> <span class="fu">c</span>(1L, 15L)),</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    dials<span class="sc">::</span><span class="fu">learn_rate</span>(</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">log10_trans</span>()</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">10</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>boost_grid <span class="sc">%&gt;%</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-2abc8e90aa2629d7ea22" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2abc8e90aa2629d7ea22">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"trees":[1768,756,1926,209,1266,837,61,492,1411,1106],"tree_depth":[9,14,2,7,12,11,3,5,6,10],"learn_rate":[1.6413038532827e-06,6.51822087975964e-05,2.0025760439862e-05,0.0682109951723791,1.20035737769819e-10,6.17902919250224e-09,0.000443630592542516,0.00996976561192888,2.07690864871826e-08,1.61750538198351e-07]},"columns":[{"accessor":"trees","name":"trees","type":"numeric"},{"accessor":"tree_depth","name":"tree_depth","type":"numeric"},{"accessor":"learn_rate","name":"learn_rate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"fc907a521424973d8d1658000ef987be","key":"fc907a521424973d8d1658000ef987be"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>You may refer to the <a href="https://www.tidyverse.org/blog/2019/10/dials-0-0-3/">Tidyverse blog</a> or <a href="https://tengkuhanis.netlify.app/post/hyperparameter-tuning-in-tidymodels/">Tengku Hanis blog</a> for more details about how the different grids work.</p>
</div>
<div id="boosting-tree-model-fitting-on-cross-validated-data" class="section level2">
<h2>Boosting tree model fitting on cross validated data</h2>
<p>Now we have everything we need and we can fit all the models on the cross validated data with <a href="https://tune.tidymodels.org/reference/tune_grid.html"><code>tune::tune_grid</code></a>. Note that this process may take some time.</p>
<p>We use <a href="https://yardstick.tidymodels.org/reference/metric_set.html"><code>yardstick::metric_set</code></a>, to choose a set of metrics to used to evaluate the model. In this example, <a href="https://yardstick.tidymodels.org/reference/rmse.html"><code>yardstick::rmse</code></a> and <a href="https://yardstick.tidymodels.org/reference/rsq.html"><code>yardstick::rsq</code></a> are used.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>()</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>foreach<span class="sc">::</span><span class="fu">getDoParWorkers</span>()</span></code></pre></div>
<pre><code>&gt; [1] 3</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>tune_res <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">tune_grid</span>(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> boost_workflow,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> Boston_fold,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> boost_grid,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    yardstick<span class="sc">::</span>rmse,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    yardstick<span class="sc">::</span>rsq</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>tune_res</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; # Tuning results
&gt; # 10-fold cross-validation 
&gt; # A tibble: 10 x 4
&gt;    splits           id     .metrics          .notes          
&gt;    &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
&gt;  1 &lt;split [341/38]&gt; Fold01 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt;  2 &lt;split [341/38]&gt; Fold02 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt;  3 &lt;split [341/38]&gt; Fold03 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt;  4 &lt;split [341/38]&gt; Fold04 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt;  5 &lt;split [341/38]&gt; Fold05 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt;  6 &lt;split [341/38]&gt; Fold06 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt;  7 &lt;split [341/38]&gt; Fold07 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt;  8 &lt;split [341/38]&gt; Fold08 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt;  9 &lt;split [341/38]&gt; Fold09 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt; 10 &lt;split [342/37]&gt; Fold10 &lt;tibble [20 x 7]&gt; &lt;tibble [1 x 3]&gt;
&gt; 
&gt; There were issues with some computations:
&gt; 
&gt;   - Warning(s) x10: A correlation computation is required, but `estimate` is constant...
&gt; 
&gt; Use `collect_notes(object)` for more information.</code></pre>
<p>Here we see that the different amount of trees, learning/shrinkage/rate and tree depth affects the performance metrics differently using <a href="https://tune.tidymodels.org/reference/autoplot.tune_results.html"><code>tune::autoplot</code></a>. Do note that using a different seed will give a different plot</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that a different seed will give different plots</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">autoplot</span>(tune_res)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-89-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>We can also see the raw metrics that created this chart by calling <a href="https://tune.tidymodels.org/reference/collect_predictions.html"><code>tune::collect_metrics()</code></a>.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">collect_metrics</span>(tune_res) <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-39918ab7e0c78715a964" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-39918ab7e0c78715a964">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"trees":[1926,1926,61,61,492,492,1411,1411,209,209,1768,1768,1106,1106,837,837,1266,1266,756,756],"tree_depth":[2,2,3,3,5,5,6,6,7,7,9,9,10,10,11,11,12,12,14,14],"learn_rate":[2.0025760439862e-05,2.0025760439862e-05,0.000443630592542516,0.000443630592542516,0.00996976561192888,0.00996976561192888,2.07690864871826e-08,2.07690864871826e-08,0.0682109951723791,0.0682109951723791,1.6413038532827e-06,1.6413038532827e-06,1.61750538198351e-07,1.61750538198351e-07,6.17902919250224e-09,6.17902919250224e-09,1.20035737769819e-10,1.20035737769819e-10,6.51822087975964e-05,6.51822087975964e-05],".metric":["rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq"],".estimator":["standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard"],"mean":[23.3615650797216,0.714401238903186,23.6081692795404,0.752728779496718,3.0686992108716,0.895092075713825,24.2260460673201,0.745310938446784,3.08550407217052,0.892696107576948,24.1599540240788,0.751441639698547,24.2225942491338,0.751813072842436,24.2265954394454,0.683376020101249,24.226715086074,"NaN",23.1204957184806,0.763107135340257],"n":[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,0,10,10],"std_err":[0.378631592933983,0.0435520530696706,0.379792656225674,0.0478238526338338,0.314763008905408,0.0240030162605012,0.388282924798131,0.0516331893389651,0.319595783042402,0.0253908820506351,0.387367289242943,0.048968496659261,0.388234279559318,0.0493571407352693,0.388289842155501,0.0453267037975971,0.388291603150384,"NA",0.373209220864362,0.0469071276868124],".config":["Preprocessor1_Model01","Preprocessor1_Model01","Preprocessor1_Model02","Preprocessor1_Model02","Preprocessor1_Model03","Preprocessor1_Model03","Preprocessor1_Model04","Preprocessor1_Model04","Preprocessor1_Model05","Preprocessor1_Model05","Preprocessor1_Model06","Preprocessor1_Model06","Preprocessor1_Model07","Preprocessor1_Model07","Preprocessor1_Model08","Preprocessor1_Model08","Preprocessor1_Model09","Preprocessor1_Model09","Preprocessor1_Model10","Preprocessor1_Model10"]},"columns":[{"accessor":"trees","name":"trees","type":"numeric"},{"accessor":"tree_depth","name":"tree_depth","type":"numeric"},{"accessor":"learn_rate","name":"learn_rate","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"391f26071b18e3b73ff2612bff8f1658","key":"391f26071b18e3b73ff2612bff8f1658"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Here is the <code>ggplot</code> way should <a href="https://tune.tidymodels.org/reference/autoplot.tune_results.html"><code>tune::autoplot</code></a> fails</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>for_plotting <span class="ot">&lt;-</span> tune_res <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;.metric&quot;</span>,</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;trees&quot;</span>, <span class="st">&quot;tree_depth&quot;</span>, <span class="st">&quot;learn_rate&quot;</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">%&gt;%</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&quot;trees&quot;</span>, <span class="st">&quot;tree_depth&quot;</span>, <span class="st">&quot;learn_rate&quot;</span>)),</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>for_plotting <span class="sc">%&gt;%</span></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-734b3ea993a03c75453a" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-734b3ea993a03c75453a">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"mean":[23.3615650797216,23.3615650797216,23.3615650797216,0.714401238903186,0.714401238903186,0.714401238903186,23.6081692795404,23.6081692795404,23.6081692795404,0.752728779496718,0.752728779496718,0.752728779496718,3.0686992108716,3.0686992108716,3.0686992108716,0.895092075713825,0.895092075713825,0.895092075713825,24.2260460673201,24.2260460673201,24.2260460673201,0.745310938446784,0.745310938446784,0.745310938446784,3.08550407217052,3.08550407217052,3.08550407217052,0.892696107576948,0.892696107576948,0.892696107576948,24.1599540240788,24.1599540240788,24.1599540240788,0.751441639698547,0.751441639698547,0.751441639698547,24.2225942491338,24.2225942491338,24.2225942491338,0.751813072842436,0.751813072842436,0.751813072842436,24.2265954394454,24.2265954394454,24.2265954394454,0.683376020101249,0.683376020101249,0.683376020101249,24.226715086074,24.226715086074,24.226715086074,"NaN","NaN","NaN",23.1204957184806,23.1204957184806,23.1204957184806,0.763107135340257,0.763107135340257,0.763107135340257],".metric":["rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq","rmse","rmse","rmse","rsq","rsq","rsq"],"parameter":["trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate","trees","tree_depth","learn_rate"],"value":[1926,2,2.0025760439862e-05,1926,2,2.0025760439862e-05,61,3,0.000443630592542516,61,3,0.000443630592542516,492,5,0.00996976561192888,492,5,0.00996976561192888,1411,6,2.07690864871826e-08,1411,6,2.07690864871826e-08,209,7,0.0682109951723791,209,7,0.0682109951723791,1768,9,1.6413038532827e-06,1768,9,1.6413038532827e-06,1106,10,1.61750538198351e-07,1106,10,1.61750538198351e-07,837,11,6.17902919250224e-09,837,11,6.17902919250224e-09,1266,12,1.20035737769819e-10,1266,12,1.20035737769819e-10,756,14,6.51822087975964e-05,756,14,6.51822087975964e-05]},"columns":[{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":"parameter","name":"parameter","type":"character"},{"accessor":"value","name":"value","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"94d7110efbdc923d551994facb2acacf","key":"94d7110efbdc923d551994facb2acacf"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>for_plotting <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;value&quot;</span>]],</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;mean&quot;</span>]],</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> .data[[<span class="st">&quot;parameter&quot;</span>]]</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">&quot;parameter&quot;</span>]]),</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">&quot;.metric&quot;</span>]]),</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>&gt; Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="docs/figures/unnamed-chunk-92-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>Use <a href="https://tune.tidymodels.org/reference/show_best.html"><code>tune::show_best</code></a> to see the top few values for a given metric.</p>
<p>The “best” values can be selected using <a href="https://tune.tidymodels.org/reference/show_best.html"><code>tune::select_best</code></a>.</p>
<p>Do note that using a different seed will give a different optimised value.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>top_boost_grid <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">show_best</span>(tune_res, <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&quot;rmse&quot;</span>), <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>top_boost_grid <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-82e323cae2e0f29c401d" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-82e323cae2e0f29c401d">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"trees":[492,209,756,1926,61],"tree_depth":[5,7,14,2,3],"learn_rate":[0.00996976561192888,0.0682109951723791,6.51822087975964e-05,2.0025760439862e-05,0.000443630592542516],".metric":["rmse","rmse","rmse","rmse","rmse"],".estimator":["standard","standard","standard","standard","standard"],"mean":[3.0686992108716,3.08550407217052,23.1204957184806,23.3615650797216,23.6081692795404],"n":[10,10,10,10,10],"std_err":[0.314763008905408,0.319595783042402,0.373209220864362,0.378631592933983,0.379792656225674],".config":["Preprocessor1_Model03","Preprocessor1_Model05","Preprocessor1_Model10","Preprocessor1_Model01","Preprocessor1_Model02"]},"columns":[{"accessor":"trees","name":"trees","type":"numeric"},{"accessor":"tree_depth","name":"tree_depth","type":"numeric"},{"accessor":"learn_rate","name":"learn_rate","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"13922bf5282a09723566b6d0de8ab083","key":"13922bf5282a09723566b6d0de8ab083"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>best_boost_grid <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">select_best</span>(tune_res, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>best_boost_grid</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; # A tibble: 1 x 4
&gt;   trees tree_depth learn_rate .config              
&gt;   &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;                
&gt; 1   492          5    0.00997 Preprocessor1_Model03</code></pre>
</div>
<div id="boosting-tree-model-with-optimised-grid" class="section level2">
<h2>Boosting tree model with optimised grid</h2>
<p>We create the boosting tree workflow with the best grid <a href="https://tune.tidymodels.org/reference/finalize_model.html"><code>tune::finalize_workflow</code></a>.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>boost_final <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> boost_workflow,</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> best_boost_grid</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>boost_final</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: boost_tree()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; Boosted Tree Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   trees = 492
&gt;   tree_depth = 5
&gt;   learn_rate = 0.00996976561192888
&gt; 
&gt; Computational engine: xgboost</code></pre>
<p>We now train the boosting tree model with the training data using <a href="https://parsnip.tidymodels.org/reference/fit.html"><code>parsnip::fit</code></a></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>boost_final_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">object =</span> boost_final, <span class="at">data =</span> Boston_train)</span></code></pre></div>
<p>We can see the tree in greater detail using <a href="https://tune.tidymodels.org/reference/extract-tune.html"><code>tune::extract_fit_engine</code></a></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> boost_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">extract_fit_engine</span>()</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>xgb_model</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; ##### xgb.Booster
&gt; raw: 1.1 Mb 
&gt; call:
&gt;   xgboost::xgb.train(params = list(eta = 0.00996976561192888, max_depth = 5L, 
&gt;     gamma = 0, colsample_bytree = 1, colsample_bynode = 1, min_child_weight = 1, 
&gt;     subsample = 1, objective = &quot;reg:squarederror&quot;), data = x$data, 
&gt;     nrounds = 492L, watchlist = x$watchlist, verbose = 0, nthread = 1)
&gt; params (as set within xgb.train):
&gt;   eta = &quot;0.00996976561192888&quot;, max_depth = &quot;5&quot;, gamma = &quot;0&quot;, colsample_bytree = &quot;1&quot;, colsample_bynode = &quot;1&quot;, min_child_weight = &quot;1&quot;, subsample = &quot;1&quot;, objective = &quot;reg:squarederror&quot;, nthread = &quot;1&quot;, validate_parameters = &quot;TRUE&quot;
&gt; xgb.attributes:
&gt;   niter
&gt; callbacks:
&gt;   cb.evaluation.log()
&gt; # of features: 12 
&gt; niter: 492
&gt; nfeatures : 12 
&gt; evaluation_log:
&gt;     iter training_rmse
&gt;        1     24.024105
&gt;        2     23.796181
&gt; ---                   
&gt;      491      1.172467
&gt;      492      1.170336</code></pre>
<p>We can visualise one of the trees with <code>xgboost::xgb.plot.tree</code></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># See the first tree</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">&lt;-</span> xgboost<span class="sc">::</span><span class="fu">xgb.plot.tree</span>(</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> xgb_model, <span class="at">trees =</span> <span class="dv">0</span>,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">render =</span> <span class="cn">FALSE</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>DiagrammeR<span class="sc">::</span><span class="fu">export_graph</span>(</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">graph =</span> gr,</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_name =</span> <span class="st">&quot;xgboost_single_tree.png&quot;</span>,</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">&quot;PNG&quot;</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;xgboost_single_tree.png&quot;</span>)</span></code></pre></div>
<p><img src="xgboost_single_tree.png" style="display: block; margin: auto;" /></p>
<p>We can visualise a summary of all the trees with <code>xgboost::xgb.plot.multi.trees</code></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">&lt;-</span> xgboost<span class="sc">::</span><span class="fu">xgb.plot.multi.trees</span>(</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> xgb_model,</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">features_keep =</span> <span class="dv">3</span>,</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">render =</span> <span class="cn">FALSE</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>DiagrammeR<span class="sc">::</span><span class="fu">export_graph</span>(</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">graph =</span> gr,</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_name =</span> <span class="st">&quot;xgboost_multiple_tree.png&quot;</span>,</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">&quot;PNG&quot;</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;xgboost_multiple_tree.png&quot;</span>)</span></code></pre></div>
<p><img src="xgboost_multiple_tree.png" style="display: block; margin: auto;" /></p>
</div>
<div id="variable-importance-4" class="section level2">
<h2>Variable Importance</h2>
<p>What are the most important variables in this tree for predicting <code>medv</code>?</p>
<p>We can extract the important features from the boosted tree model with <code>xgboost::xgb.importance</code></p>
<p>Details on what <code>Gain</code>, <code>Cover</code> and <code>Frequency</code> can be found in this <a href="https://www.r-bloggers.com/2019/10/explaining-predictions-boosted-trees-post-hoc-analysis-xgboost/">blog post</a></p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>importance_matrix <span class="ot">&lt;-</span> xgboost<span class="sc">::</span><span class="fu">xgb.importance</span>(<span class="at">model =</span> xgb_model)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>importance_matrix <span class="sc">%&gt;%</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-b8dbab3cd209948ccb1c" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b8dbab3cd209948ccb1c">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Feature":["rm","lstat","dis","crim","nox","age","ptratio","indus","tax","rad","zn","chas"],"Gain":[0.555636398268168,0.339037926670739,0.0364437642589365,0.0291475785283227,0.0166283162967469,0.00988004995655039,0.00576355780822283,0.00354600685169636,0.00269906789015889,0.0010507946202796,0.000138824634918199,2.77142152606834e-05],"Cover":[0.227082619206808,0.207501128461322,0.178025379349667,0.0909669923649269,0.0618362865646922,0.0839790168415075,0.06069255283405,0.0264269237861546,0.0503616167032639,0.0103908944767051,0.00234176935947517,0.000394820051428423],"Frequency":[0.173152445555159,0.108175651553017,0.144591217422349,0.182315839581102,0.0869927406878496,0.128049506128764,0.0637867428299417,0.0453409496608354,0.0420088063786743,0.017612757348566,0.00702130191598239,0.000952040937760324]},"columns":[{"accessor":"Feature","name":"Feature","type":"character"},{"accessor":"Gain","name":"Gain","type":"numeric"},{"accessor":"Cover","name":"Cover","type":"numeric"},{"accessor":"Frequency","name":"Frequency","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"2828e8e5977a806ae0c3b7a9f0b66239","key":"2828e8e5977a806ae0c3b7a9f0b66239"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>The <code>xgboost::xgb.ggplot.importance</code> uses the <code>Gain</code> variable importance measurement by default to calculate variable importance.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>xgboost<span class="sc">::</span><span class="fu">xgb.ggplot.importance</span>(importance_matrix,</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_to_first =</span> <span class="cn">FALSE</span>,</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Relative importance&quot;</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-102-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
<div id="boosting-tree-model-on-test-data" class="section level2">
<h2>Boosting tree model on test data</h2>
<p>Finally, let’s turn to the testing data. For regression models, a <code>.pred</code>, column is added when <a href="https://parsnip.tidymodels.org/reference/augment.html"><code>parsnip::augment</code></a> is used.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> boost_final_fit,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_data =</span> Boston_test</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-5e20f4ac09d5ccda67d1" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5e20f4ac09d5ccda67d1">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"crim":[0.06905,0.02985,0.08829,0.14455,0.21124,0.17004,0.22489,0.11747,1.05393,0.84054,1.00245,0.08014,0.17142,0.18836,0.04337,0.04981,0.0136,0.02055,0.11027,0.03584,0.04379,0.13554,0.09512,0.08387,0.05188,0.07151,0.02875,0.04294,0.12204,0.0686,0.12802,0.14476,0.09299,0.32982,0.55778,0.32264,4.0974,2.37934,2.14918,1.41385,1.22358,2.3004,1.20742,0.08447,0.06642,0.06888,0.10008,0.06047,0.06911,0.0315,0.02177,0.43571,0.19802,0.62356,0.38214,0.41238,0.46296,0.33045,0.09252,0.12757,0.20608,0.03548,0.01538,0.65665,0.54011,0.53412,0.82526,0.76162,0.09604,0.06127,0.09266,0.04932,0.3494,2.63548,0.79041,0.3692,0.31827,0.24522,0.1676,0.18159,0.35114,0.05083,0.03738,0.03427,0.06151,0.06162,0.01501,0.10659,8.98296,4.54192,3.67822,3.47428,4.89822,23.6482,17.8667,88.9762,20.0849,16.8118,24.3938,22.5971,8.64476,9.91655,9.59571,20.7162,14.4383,51.1358,7.05042,15.8603,7.36711,13.6781,22.0511,9.92485,6.71772,8.24809,6.80117,3.69311,4.42228,15.5757,4.64689,10.233,3.67367,0.20746,0.17331,0.2896,0.23912,0.06263,0.04741],"zn":[0,0,12.5,12.5,12.5,12.5,12.5,12.5,0,0,0,0,0,0,21,21,75,85,25,80,80,12.5,0,0,0,0,28,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,95,82.5,0,0,0,0,0,0,0,30,30,22,80,90,20,20,20,20,20,40,40,34,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,80,80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"indus":[2.18,2.18,7.87,7.87,7.87,7.87,7.87,7.87,8.14,8.14,8.14,5.96,6.91,6.91,5.64,5.64,4,0.74,5.13,3.37,3.37,6.07,12.83,12.83,4.49,4.49,15.04,15.04,2.89,2.89,8.56,10.01,25.65,21.89,21.89,21.89,19.58,19.58,19.58,19.58,19.58,19.58,19.58,4.05,4.05,2.46,2.46,2.46,3.44,1.47,2.03,10.59,10.59,6.2,6.2,6.2,6.2,6.2,4.93,4.93,5.86,3.64,3.75,3.97,3.97,3.97,3.97,3.97,6.41,6.41,6.09,2.18,9.9,9.9,9.9,9.9,9.9,9.9,7.38,7.38,7.38,5.19,5.19,5.19,5.19,4.39,2.01,1.91,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,27.74,9.69,9.69,9.69,11.93,11.93],"chas":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"nox":[0.458,0.458,0.524,0.524,0.524,0.524,0.524,0.524,0.538,0.538,0.538,0.499,0.448,0.448,0.439,0.439,0.41,0.41,0.453,0.398,0.398,0.409,0.437,0.437,0.449,0.449,0.464,0.464,0.445,0.445,0.52,0.547,0.581,0.624,0.624,0.624,0.871,0.871,0.871,0.871,0.605,0.605,0.605,0.51,0.51,0.488,0.488,0.488,0.437,0.403,0.415,0.489,0.489,0.507,0.504,0.504,0.504,0.507,0.428,0.428,0.431,0.392,0.394,0.647,0.647,0.647,0.647,0.647,0.447,0.447,0.433,0.472,0.544,0.544,0.544,0.544,0.544,0.544,0.493,0.493,0.493,0.515,0.515,0.515,0.515,0.442,0.435,0.413,0.77,0.77,0.77,0.718,0.631,0.671,0.671,0.671,0.7,0.7,0.7,0.7,0.693,0.693,0.693,0.659,0.597,0.597,0.614,0.679,0.679,0.74,0.74,0.74,0.713,0.713,0.713,0.713,0.584,0.58,0.614,0.614,0.583,0.609,0.585,0.585,0.585,0.573,0.573],"rm":[7.147,6.43,6.012,6.172,5.631,6.004,6.377,6.009,5.935,5.599,6.674,5.85,5.682,5.786,6.115,5.998,5.888,6.383,6.456,6.29,5.787,5.594,6.286,5.874,6.015,6.121,6.211,6.249,6.625,7.416,6.474,5.731,5.961,5.822,6.335,5.942,5.468,6.13,5.709,6.129,6.943,6.319,5.875,5.859,6.86,6.144,6.563,6.153,6.739,6.975,7.61,5.344,6.182,6.879,8.04,7.163,7.412,6.086,6.606,6.393,5.593,5.876,7.454,6.842,7.203,7.52,7.327,5.56,6.854,6.826,6.495,6.849,5.972,4.973,6.122,6.567,5.914,5.782,6.426,6.376,6.041,6.316,6.31,5.869,5.968,5.898,6.635,5.936,6.212,6.398,5.362,8.78,4.97,6.38,6.223,6.968,4.368,5.277,4.652,5,6.193,5.852,6.404,4.138,6.852,5.757,6.103,5.896,6.193,5.935,5.818,6.251,6.749,7.393,6.081,6.376,6.003,5.926,6.98,6.185,6.312,5.093,5.707,5.39,6.019,6.593,6.03],"age":[54.2,58.7,66.6,96.1,100,85.9,94.3,82.9,29.3,85.7,87.3,41.5,33.8,33.3,63,21.4,47.6,35.7,67.8,17.8,31.1,36.8,45,36.6,45.1,56.8,28.9,77.3,57.8,62.5,97.1,65.2,92.9,95.4,98.2,93.5,100,100,98.5,96,97.4,96.1,94.6,68.7,74.4,62.2,95.6,68.8,30.8,15.3,15.7,100,42.4,77.7,86.5,79.9,76.9,61.5,42.2,7.8,76.5,19.1,34.2,100,81.8,89.4,94.5,62.8,42.8,27.6,18.4,70.3,76.7,37.8,52.8,87.3,83.2,71.7,52.3,54.3,49.9,38.1,38.5,46.3,58.5,52.3,29.7,19.5,97.4,88,96.2,82.9,100,96.2,100,91.9,91.2,98.1,100,89.5,92.6,77.8,100,100,100,100,85.1,95.4,78.1,87.9,92.4,96.6,92.6,99.3,84.4,88.4,94.5,71,67.6,96.7,51.9,98,54,72.9,65.3,69.1,80.8],"dis":[6.0622,6.0622,5.5605,5.9505,6.0821,6.5921,6.3467,6.2267,4.4986,4.4546,4.239,3.9342,5.1004,5.1004,6.8147,6.8147,7.3197,9.1876,7.2255,6.6115,6.6115,6.498,4.5026,4.5026,4.4272,3.7476,3.6659,3.615,3.4952,3.4952,2.4329,2.7592,2.0869,2.4699,2.1107,1.9669,1.4118,1.4191,1.6232,1.7494,1.8773,2.1,2.4259,2.7019,2.9153,2.5979,2.847,3.2797,6.4798,7.6534,6.27,3.875,3.9454,3.2721,3.2157,3.2157,3.6715,3.6519,6.1899,7.0355,7.9549,9.2203,6.3361,2.0107,2.1121,2.1398,2.0788,1.9865,4.2673,4.8628,5.4917,3.1827,3.1025,2.5194,2.6403,3.6023,3.9986,4.0317,4.5404,4.5404,4.7211,6.4584,6.4584,5.2311,4.8122,8.0136,8.344,10.5857,2.1222,2.5182,2.1036,1.9047,1.3325,1.3861,1.3861,1.4165,1.4395,1.4261,1.4672,1.5184,1.7912,1.5004,1.639,1.1781,1.4655,1.413,2.0218,1.9096,1.9356,1.8206,1.8662,2.198,2.3236,2.4527,2.7175,2.5671,2.5403,2.9084,2.5329,2.1705,3.9917,1.8226,2.3817,2.7986,2.4091,2.4786,2.505],"rad":[3,3,5,5,5,5,5,5,4,4,4,5,3,3,4,4,3,2,8,4,4,4,5,5,3,3,4,4,2,2,5,6,2,4,4,4,5,5,5,5,5,5,5,5,5,3,3,3,5,3,2,4,4,8,8,8,8,8,6,6,7,1,3,5,5,5,5,5,4,4,7,7,4,4,4,4,4,4,5,5,5,5,5,5,5,3,4,4,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,4,6,6,6,1,1],"tax":[222,222,311,311,311,311,311,311,307,307,307,279,233,233,243,243,469,313,284,337,337,345,398,398,247,247,270,270,276,276,384,432,188,437,437,437,403,403,403,403,403,403,403,296,296,193,193,193,398,402,348,277,277,307,307,307,307,307,300,300,330,315,244,264,264,264,264,264,254,254,329,222,304,304,304,304,304,304,287,287,287,224,224,224,224,352,280,334,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,711,391,391,391,273,273],"ptratio":[18.7,18.7,15.2,15.2,15.2,15.2,15.2,15.2,21,21,21,19.2,17.9,17.9,16.8,16.8,21.1,17.3,19.7,16.1,16.1,18.9,18.7,18.7,18.5,18.5,18.2,18.2,18,18,20.9,17.8,19.1,21.2,21.2,21.2,14.7,14.7,14.7,14.7,14.7,14.7,14.7,16.6,16.6,17.8,17.8,17.8,15.2,17,14.7,18.6,18.6,17.4,17.4,17.4,17.4,17.4,16.6,16.6,19.1,16.4,15.9,13,13,13,13,13,17.6,17.6,16.1,18.4,18.4,18.4,18.4,18.4,18.4,18.4,19.6,19.6,19.6,20.2,20.2,20.2,20.2,18.8,17,22,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.1,19.2,19.2,19.2,21,21],"lstat":[5.33,5.21,12.43,19.15,29.93,17.1,20.45,13.27,6.58,16.51,11.98,8.77,10.21,14.15,9.43,8.43,14.8,5.77,6.73,4.67,10.24,13.09,8.94,9.1,12.86,8.44,6.21,10.59,6.65,6.19,12.27,13.61,17.93,15.03,16.96,16.9,26.42,27.8,15.79,15.12,4.59,11.1,14.43,9.64,6.92,9.45,5.68,13.15,4.69,4.56,3.11,23.09,9.47,9.93,3.13,6.36,5.25,10.88,7.37,5.19,12.5,9.25,3.11,6.9,9.59,7.26,11.25,10.45,2.98,4.16,8.67,7.53,9.97,12.64,5.98,9.28,18.33,15.94,7.2,6.87,7.7,5.68,6.75,9.8,9.29,12.67,5.99,5.57,17.6,7.79,10.19,5.29,3.26,23.69,21.78,17.21,30.63,30.81,28.28,31.99,15.17,29.97,20.31,23.34,19.78,10.11,23.29,24.39,21.52,34.02,22.11,16.44,17.44,16.74,14.7,14.65,21.32,18.13,11.66,18.03,10.58,29.68,12.01,21.14,12.92,9.67,7.88],"medv":[36.2,28.7,22.9,27.1,16.5,18.9,15,18.9,23.1,13.9,21,21,19.3,20,20.5,23.4,18.9,24.7,22.2,23.5,19.4,17.4,21.4,20.3,22.5,22.2,25,20.6,28.4,33.2,19.8,19.3,20.5,18.4,18.1,17.4,15.6,13.8,19.4,17,41.3,23.8,17.4,22.6,29.9,36.2,32.5,29.6,30.5,34.9,42.3,20,25,27.5,37.6,31.6,31.7,24,23.3,23.7,17.6,20.9,44,30.1,33.8,43.1,31,22.8,32,33.1,26.4,28.2,20.3,16.1,22.1,23.8,17.8,19.8,23.8,23.1,20.4,22.2,20.7,19.5,18.7,17.2,24.5,20.6,17.8,25,20.8,21.9,50,13.1,10.2,10.4,8.8,7.2,10.5,7.4,13.8,6.3,12.1,11.9,27.5,15,13.4,8.3,11,8.4,10.5,12.6,13.4,17.8,20,17.7,19.1,19.1,29.8,14.6,21.2,8.1,21.8,19.7,21.2,22.4,11.9],".pred":[33.7728881835938,25.0803661346436,21.2572383880615,17.1578521728516,16.2789306640625,18.9087390899658,17.2000312805176,20.2503471374512,21.5417079925537,15.1794443130493,19.5237979888916,23.6630229949951,20.5601997375488,21.0835113525391,21.7705268859863,20.9958591461182,16.0408420562744,22.5131244659424,22.9509048461914,23.2899742126465,18.3355770111084,19.2598457336426,23.390266418457,21.8534049987793,20.6358947753906,23.2870540618896,25.1151828765869,21.5840435028076,26.0039291381836,32.0051002502441,20.0739765167236,21.2355403900146,19.4768695831299,17.10426902771,17.1252536773682,16.9286823272705,13.6814203262329,13.7163543701172,15.4187316894531,15.7874584197998,33.5458831787109,21.3319988250732,19.1275386810303,22.2616710662842,27.2207279205322,23.3386917114258,25.2034301757812,22.6001491546631,31.4498195648193,32.0533027648926,44.9353523254395,16.948112487793,25.7852954864502,24.888053894043,48.5285720825195,32.8982315063477,33.2692108154297,21.7695140838623,26.4036693572998,25.3088531494141,19.0599708557129,19.8668670654297,40.9744644165039,28.3193511962891,36.2147369384766,44.1717338562012,33.806396484375,22.05344581604,30.3148365020752,30.166898727417,22.983247756958,27.3763427734375,20.8986034393311,21.344690322876,23.6090869903564,23.2241821289062,18.8367099761963,18.6682586669922,23.4569225311279,23.4472560882568,22.1612148284912,23.5119018554688,23.3100700378418,19.4250755310059,20.5439968109131,18.870288848877,26.2328071594238,20.6693840026855,14.5406694412231,24.992504119873,20.5362930297852,42.7810897827148,42.3238639831543,11.4486303329468,11.5322113037109,11.4664840698242,11.0656337738037,9.84285831451416,9.24966621398926,9.74190235137939,13.1090364456177,10.4501066207886,10.6355772018433,13.9407405853271,15.7975244522095,30.0320911407471,14.5010871887207,8.96727561950684,11.9444198608398,10.3326511383057,9.91948318481445,14.4818830490112,16.1510238647461,24.671314239502,18.2221755981445,18.6765174865723,15.7598466873169,12.7997541427612,27.2740726470947,14.8332586288452,21.4582633972168,10.0657320022583,21.3277206420898,17.6648178100586,20.6092185974121,23.4293079376221,20.062313079834]},"columns":[{"accessor":"crim","name":"crim","type":"numeric"},{"accessor":"zn","name":"zn","type":"numeric"},{"accessor":"indus","name":"indus","type":"numeric"},{"accessor":"chas","name":"chas","type":"numeric"},{"accessor":"nox","name":"nox","type":"numeric"},{"accessor":"rm","name":"rm","type":"numeric"},{"accessor":"age","name":"age","type":"numeric"},{"accessor":"dis","name":"dis","type":"numeric"},{"accessor":"rad","name":"rad","type":"numeric"},{"accessor":"tax","name":"tax","type":"numeric"},{"accessor":"ptratio","name":"ptratio","type":"numeric"},{"accessor":"lstat","name":"lstat","type":"numeric"},{"accessor":"medv","name":"medv","type":"numeric"},{"accessor":".pred","name":".pred","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"2c0b0e2af559a13cb7f9b7b45be0ab62","key":"2c0b0e2af559a13cb7f9b7b45be0ab62"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>We check how well the <code>.pred</code> column matches the <code>medv</code> using <a href="https://yardstick.tidymodels.org/reference/rmse.html"><code>yardstick::rmse</code></a>.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">rmse</span>(<span class="at">truth =</span> .data[[<span class="st">&quot;medv&quot;</span>]], <span class="at">estimate =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-d69e41576558348d25a4" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d69e41576558348d25a4">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["rmse"],".estimator":["standard"],".estimate":[3.93160999801295]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"14c82a14866f784281f67da0d5b21830","key":"14c82a14866f784281f67da0d5b21830"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Let us take a closer look at the predicted and actual response as a scatter plot.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;medv&quot;</span>]],</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_fixed</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-105-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="baysesian-additive-regression-tree-bart" class="section level1">
<h1>Baysesian Additive Regression Tree (BART)</h1>
<p>Here we apply bagging to the <code>Boston</code> data. The book uses the R package <code>BART</code> to do the boosting. Unfortunately, <code>BART</code> is not one of the list bart models in the current <a href="https://parsnip.tidymodels.org/reference/bart.html">parsnip list</a>.</p>
<p>For simplicity, a different R package is used to create a BART model. In this example, the default parsnip engine for bosted tree is the <code>dbarts</code> R package.</p>
<div id="create-the-resample-object-4" class="section level2">
<h2>Create the resample object</h2>
<p>First, we split the samples into a training set and a test set. From the training set, we create a 10-fold cross-validation data set from the training set.</p>
<p>This is done with <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::initial_split</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::training</code></a>, <a href="https://rsample.tidymodels.org/reference/initial_split.html"><code>rsample::testing</code></a> and <a href="https://rsample.tidymodels.org/reference/vfold_cv.html"><code>rsample::vfold_cv</code></a>.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>Boston_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(Boston)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>Boston_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(Boston_split)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>Boston_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(Boston_split)</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>Boston_fold <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(Boston_train, <span class="at">v =</span> <span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="create-the-preprocessor-5" class="section level2">
<h2>Create the preprocessor</h2>
<p>We create a recipe with <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipes::recipe</code></a>. No other preprocessing step is done.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>bart_recipe <span class="ot">&lt;-</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> medv <span class="sc">~</span> ., <span class="at">data =</span> Boston_train)</span></code></pre></div>
</div>
<div id="specify-the-model-5" class="section level2">
<h2>Specify the model</h2>
<p>Use <a href="https://parsnip.tidymodels.org/reference/bart.html"><code>parsnip::bart</code></a>, <a href="https://parsnip.tidymodels.org/reference/set_args.html"><code>parsnip::set_mode</code></a> and <a href="https://parsnip.tidymodels.org/reference/set_engine.html"><code>parsnip::set_engine</code></a> to create the model.</p>
<p><code>ndpost</code> is the number of MCMC interations. <code>nskip</code> is the number of burn-in iterations.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>bart_spec <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">bart</span>(</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">trees =</span> tune<span class="sc">::</span><span class="fu">tune</span>()</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;dbarts&quot;</span>,</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nskip =</span> <span class="dv">100</span>,</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ndpost =</span> <span class="dv">500</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>bart_spec <span class="sc">%&gt;%</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">translate</span>()</span></code></pre></div>
<pre><code>&gt; BART Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   trees = tune::tune()
&gt; 
&gt; Engine-Specific Arguments:
&gt;   nskip = 100
&gt;   ndpost = 500
&gt; 
&gt; Computational engine: dbarts 
&gt; 
&gt; Model fit template:
&gt; dbarts::bart(x = missing_arg(), y = missing_arg(), ntree = tune::tune(), 
&gt;     nskip = 100, ndpost = 500, verbose = FALSE, keeptrees = TRUE, 
&gt;     keepcall = FALSE)</code></pre>
</div>
<div id="create-the-workflow-5" class="section level2">
<h2>Create the workflow</h2>
<p><a href="https://workflows.tidymodels.org/reference/workflow.html"><code>workflows::workflow</code></a>, <a href="https://workflows.tidymodels.org/reference/add_recipe.html"><code>workflows::add_recipe</code></a> and <a href="https://workflows.tidymodels.org/reference/add_model.html"><code>workflows::add_model</code></a> are used.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>bart_workflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_recipe</span>(bart_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_model</span>(bart_spec)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>bart_workflow</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: bart()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; BART Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   trees = tune::tune()
&gt; 
&gt; Engine-Specific Arguments:
&gt;   nskip = 100
&gt;   ndpost = 500
&gt; 
&gt; Computational engine: dbarts</code></pre>
</div>
<div id="create-the-bart-grid" class="section level2">
<h2>Create the BART grid</h2>
<p>Let’s use a space-filling design (non-regular grid) so that we can cover the hyperparameter space as well as possible. We do this using <a href="https://dials.tidymodels.org/reference/grid_regular.html"><code>dials::grid_regular</code></a></p>
<p>We use the default values for <a href="https://dials.tidymodels.org/reference/trees.html"><code>dials::trees</code></a>, <a href="https://dials.tidymodels.org/reference/trees.html"><code>dials::tree_depth</code></a> and <a href="https://dials.tidymodels.org/reference/learn_rate.html"><code>dials::learn_rate</code></a></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>bart_grid <span class="ot">&lt;-</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  dials<span class="sc">::</span><span class="fu">grid_regular</span>(</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> dials<span class="sc">::</span><span class="fu">trees</span>(<span class="at">range =</span> <span class="fu">c</span>(1L, 10L)),</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="dv">10</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>bart_grid <span class="sc">%&gt;%</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-ca9fad3bdbff68b373a0" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ca9fad3bdbff68b373a0">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"trees":[1,2,3,4,5,6,7,8,9,10]},"columns":[{"accessor":"trees","name":"trees","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"9942cc2def3219e00ab4ef645d7baf91","key":"9942cc2def3219e00ab4ef645d7baf91"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="bart-model-fitting-on-cross-validated-data" class="section level2">
<h2>BART model fitting on cross validated data</h2>
<p>Now we have everything we need and we can fit all the models on the cross validated data with <a href="https://tune.tidymodels.org/reference/tune_grid.html"><code>tune::tune_grid</code></a>. Note that this process may take some time.</p>
<p>We use <a href="https://yardstick.tidymodels.org/reference/metric_set.html"><code>yardstick::metric_set</code></a>, to choose a set of metrics to used to evaluate the model. In this example, <a href="https://yardstick.tidymodels.org/reference/rmse.html"><code>yardstick::rmse</code></a> and <a href="https://yardstick.tidymodels.org/reference/rsq.html"><code>yardstick::rsq</code></a> are used.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>()</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>foreach<span class="sc">::</span><span class="fu">getDoParWorkers</span>()</span></code></pre></div>
<pre><code>&gt; [1] 3</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>tune_res <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">tune_grid</span>(</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> bart_workflow,</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> Boston_fold,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> bart_grid,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>    yardstick<span class="sc">::</span>rmse,</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    yardstick<span class="sc">::</span>rsq</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>tune_res</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; # Tuning results
&gt; # 10-fold cross-validation 
&gt; # A tibble: 10 x 4
&gt;    splits           id     .metrics          .notes          
&gt;    &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
&gt;  1 &lt;split [341/38]&gt; Fold01 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  2 &lt;split [341/38]&gt; Fold02 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  3 &lt;split [341/38]&gt; Fold03 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  4 &lt;split [341/38]&gt; Fold04 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  5 &lt;split [341/38]&gt; Fold05 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  6 &lt;split [341/38]&gt; Fold06 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  7 &lt;split [341/38]&gt; Fold07 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  8 &lt;split [341/38]&gt; Fold08 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt;  9 &lt;split [341/38]&gt; Fold09 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;
&gt; 10 &lt;split [342/37]&gt; Fold10 &lt;tibble [20 x 5]&gt; &lt;tibble [0 x 3]&gt;</code></pre>
<p>Here we see that the different amount of trees affects the performance metrics differently using <a href="https://tune.tidymodels.org/reference/autoplot.tune_results.html"><code>tune::autoplot</code></a>. Do note that using a different seed will give a different plot</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that a different seed will give different plots</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">autoplot</span>(tune_res)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-114-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>We can also see the raw metrics that created this chart by calling <a href="https://tune.tidymodels.org/reference/collect_predictions.html"><code>tune::collect_metrics()</code></a>.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">collect_metrics</span>(tune_res) <span class="sc">%&gt;%</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-e0df0ee5fdd4c921ea18" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e0df0ee5fdd4c921ea18">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"trees":[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10],".metric":["rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq","rmse","rsq"],".estimator":["standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard"],"mean":[5.15367686278772,0.707320146383181,4.31701415505927,0.794449130546048,4.26526404331123,0.791680500977598,3.89358481964465,0.82542992365412,3.52380240674384,0.861426025340289,3.83440011707278,0.841992154780069,3.67805916830234,0.845108143975347,3.60891577636306,0.856532282340771,3.5473416808178,0.854962028341372,3.75071156745903,0.839967850758659],"n":[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],"std_err":[0.46943111834567,0.0431896298685181,0.324151637436066,0.0312365088200156,0.385037773347211,0.0306819233624588,0.436616020302711,0.0429708554093372,0.255361181620518,0.0135135151144423,0.318404247753231,0.0243040092116823,0.367807755498941,0.028436717315182,0.270347523261234,0.0178520911167405,0.329858607113695,0.0260503237630321,0.312775754729301,0.0240529363524148],".config":["Preprocessor1_Model01","Preprocessor1_Model01","Preprocessor1_Model02","Preprocessor1_Model02","Preprocessor1_Model03","Preprocessor1_Model03","Preprocessor1_Model04","Preprocessor1_Model04","Preprocessor1_Model05","Preprocessor1_Model05","Preprocessor1_Model06","Preprocessor1_Model06","Preprocessor1_Model07","Preprocessor1_Model07","Preprocessor1_Model08","Preprocessor1_Model08","Preprocessor1_Model09","Preprocessor1_Model09","Preprocessor1_Model10","Preprocessor1_Model10"]},"columns":[{"accessor":"trees","name":"trees","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"7e00c48a50ebcda7ebd2ed55be219140","key":"7e00c48a50ebcda7ebd2ed55be219140"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Here is the <code>ggplot</code> way should <a href="https://tune.tidymodels.org/reference/autoplot.tune_results.html"><code>tune::autoplot</code></a> fails</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>tune_res <span class="sc">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;trees&quot;</span>]],</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;mean&quot;</span>]],</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> .data[[<span class="st">&quot;.metric&quot;</span>]]</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_errorbar</span>(</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> .data[[<span class="st">&quot;mean&quot;</span>]] <span class="sc">-</span> .data[[<span class="st">&quot;std_err&quot;</span>]],</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> .data[[<span class="st">&quot;mean&quot;</span>]] <span class="sc">+</span> .data[[<span class="st">&quot;std_err&quot;</span>]]</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(</span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">&quot;.metric&quot;</span>]]),</span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-116-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<p>Use <a href="https://tune.tidymodels.org/reference/show_best.html"><code>tune::show_best</code></a> to see the top few values for a given metric.</p>
<p>The “best” values can be selected using <a href="https://tune.tidymodels.org/reference/show_best.html"><code>tune::select_best</code></a>.</p>
<p>Do note that using a different seed will give a different optimised value.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>top_number_of_trees <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">show_best</span>(tune_res, <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&quot;rmse&quot;</span>), <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>top_number_of_trees <span class="sc">%&gt;%</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-b1ab6a72a478c1e5c184" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b1ab6a72a478c1e5c184">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"trees":[5,9,8,7,10],".metric":["rmse","rmse","rmse","rmse","rmse"],".estimator":["standard","standard","standard","standard","standard"],"mean":[3.52380240674384,3.5473416808178,3.60891577636306,3.67805916830234,3.75071156745903],"n":[10,10,10,10,10],"std_err":[0.255361181620518,0.329858607113695,0.270347523261234,0.367807755498941,0.312775754729301],".config":["Preprocessor1_Model05","Preprocessor1_Model09","Preprocessor1_Model08","Preprocessor1_Model07","Preprocessor1_Model10"]},"columns":[{"accessor":"trees","name":"trees","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"226aa1d0a3ead211f6c892f8f50336ef","key":"226aa1d0a3ead211f6c892f8f50336ef"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>best_number_of_trees <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">select_best</span>(tune_res, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>best_number_of_trees</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; # A tibble: 1 x 2
&gt;   trees .config              
&gt;   &lt;int&gt; &lt;chr&gt;                
&gt; 1     5 Preprocessor1_Model05</code></pre>
</div>
<div id="bart-model-with-optimised-grid" class="section level2">
<h2>BART model with optimised grid</h2>
<p>We create the BART workflow with the best grid <a href="https://tune.tidymodels.org/reference/finalize_model.html"><code>tune::finalize_workflow</code></a>.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>bart_final <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> bart_workflow,</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> best_number_of_trees</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>bart_final</span></code></pre></div>
<pre style="max-height: 150px;"><code>&gt; == Workflow ====================================================================
&gt; Preprocessor: Recipe
&gt; Model: bart()
&gt; 
&gt; -- Preprocessor ----------------------------------------------------------------
&gt; 0 Recipe Steps
&gt; 
&gt; -- Model -----------------------------------------------------------------------
&gt; BART Model Specification (regression)
&gt; 
&gt; Main Arguments:
&gt;   trees = 5
&gt; 
&gt; Engine-Specific Arguments:
&gt;   nskip = 100
&gt;   ndpost = 500
&gt; 
&gt; Computational engine: dbarts</code></pre>
<p>We now train the boosting tree model with the training data using <a href="https://parsnip.tidymodels.org/reference/fit.html"><code>parsnip::fit</code></a></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>bart_final_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">object =</span> bart_final, <span class="at">data =</span> Boston_train)</span></code></pre></div>
<p>We can see the tree in greater detail using <a href="https://tune.tidymodels.org/reference/extract-tune.html"><code>tune::extract_fit_engine</code></a></p>
<p>For example, to see the 2nd tree on the third iteration</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>bart_model <span class="ot">&lt;-</span> bart_final_fit <span class="sc">%&gt;%</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">extract_fit_engine</span>()</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>bart_model<span class="sc">$</span>fit<span class="sc">$</span><span class="fu">plotTree</span>(<span class="at">sampleNum =</span> <span class="dv">3</span>, <span class="at">treeNum =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-120-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
<div id="variable-importance-5" class="section level2">
<h2>Variable Importance</h2>
<p>What are the most important variables in this tree for predicting <code>medv</code>?</p>
<p>We can extract the important features from the bart tree model with <code>embarcadero::varimp</code></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>embarcadero<span class="sc">::</span><span class="fu">varimp</span>(bart_model, <span class="at">plots =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-121-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
<div id="htmlwidget-7d566c79b3a4c8369aa5" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7d566c79b3a4c8369aa5">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".rownames":["crim","zn","indus","chas","nox","rm","age","dis","rad","tax","ptratio","lstat"],"names":["crim","zn","indus","chas","nox","rm","age","dis","rad","tax","ptratio","lstat"],"varimps":[0.0235492894876022,0.00379188752424047,0.00620922459893048,0.141942338268886,0.0988802841980861,0.146763080323529,0.0126368194413086,0.0864534970877076,0.030353277828123,0.0466768697504766,0.153780044783218,0.248963386707891]},"columns":[{"accessor":".rownames","name":"","type":"character","sortable":false,"filterable":false},{"accessor":"names","name":"names","type":"factor"},{"accessor":"varimps","name":"varimps","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"ad61cce71c173049c520695a09ab78fa","key":"ad61cce71c173049c520695a09ab78fa"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="bart-model-on-test-data" class="section level2">
<h2>BART model on test data</h2>
<p>Finally, let’s turn to the testing data. For regression models, a <code>.pred</code>, column is added when <a href="https://parsnip.tidymodels.org/reference/augment.html"><code>parsnip::augment</code></a> is used.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> bart_final_fit,</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_data =</span> Boston_test</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-ced5d368e14a17cbb784" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ced5d368e14a17cbb784">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"crim":[0.06905,0.02985,0.08829,0.14455,0.21124,0.17004,0.22489,0.11747,1.05393,0.84054,1.00245,0.08014,0.17142,0.18836,0.04337,0.04981,0.0136,0.02055,0.11027,0.03584,0.04379,0.13554,0.09512,0.08387,0.05188,0.07151,0.02875,0.04294,0.12204,0.0686,0.12802,0.14476,0.09299,0.32982,0.55778,0.32264,4.0974,2.37934,2.14918,1.41385,1.22358,2.3004,1.20742,0.08447,0.06642,0.06888,0.10008,0.06047,0.06911,0.0315,0.02177,0.43571,0.19802,0.62356,0.38214,0.41238,0.46296,0.33045,0.09252,0.12757,0.20608,0.03548,0.01538,0.65665,0.54011,0.53412,0.82526,0.76162,0.09604,0.06127,0.09266,0.04932,0.3494,2.63548,0.79041,0.3692,0.31827,0.24522,0.1676,0.18159,0.35114,0.05083,0.03738,0.03427,0.06151,0.06162,0.01501,0.10659,8.98296,4.54192,3.67822,3.47428,4.89822,23.6482,17.8667,88.9762,20.0849,16.8118,24.3938,22.5971,8.64476,9.91655,9.59571,20.7162,14.4383,51.1358,7.05042,15.8603,7.36711,13.6781,22.0511,9.92485,6.71772,8.24809,6.80117,3.69311,4.42228,15.5757,4.64689,10.233,3.67367,0.20746,0.17331,0.2896,0.23912,0.06263,0.04741],"zn":[0,0,12.5,12.5,12.5,12.5,12.5,12.5,0,0,0,0,0,0,21,21,75,85,25,80,80,12.5,0,0,0,0,28,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,95,82.5,0,0,0,0,0,0,0,30,30,22,80,90,20,20,20,20,20,40,40,34,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,80,80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"indus":[2.18,2.18,7.87,7.87,7.87,7.87,7.87,7.87,8.14,8.14,8.14,5.96,6.91,6.91,5.64,5.64,4,0.74,5.13,3.37,3.37,6.07,12.83,12.83,4.49,4.49,15.04,15.04,2.89,2.89,8.56,10.01,25.65,21.89,21.89,21.89,19.58,19.58,19.58,19.58,19.58,19.58,19.58,4.05,4.05,2.46,2.46,2.46,3.44,1.47,2.03,10.59,10.59,6.2,6.2,6.2,6.2,6.2,4.93,4.93,5.86,3.64,3.75,3.97,3.97,3.97,3.97,3.97,6.41,6.41,6.09,2.18,9.9,9.9,9.9,9.9,9.9,9.9,7.38,7.38,7.38,5.19,5.19,5.19,5.19,4.39,2.01,1.91,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,27.74,9.69,9.69,9.69,11.93,11.93],"chas":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"nox":[0.458,0.458,0.524,0.524,0.524,0.524,0.524,0.524,0.538,0.538,0.538,0.499,0.448,0.448,0.439,0.439,0.41,0.41,0.453,0.398,0.398,0.409,0.437,0.437,0.449,0.449,0.464,0.464,0.445,0.445,0.52,0.547,0.581,0.624,0.624,0.624,0.871,0.871,0.871,0.871,0.605,0.605,0.605,0.51,0.51,0.488,0.488,0.488,0.437,0.403,0.415,0.489,0.489,0.507,0.504,0.504,0.504,0.507,0.428,0.428,0.431,0.392,0.394,0.647,0.647,0.647,0.647,0.647,0.447,0.447,0.433,0.472,0.544,0.544,0.544,0.544,0.544,0.544,0.493,0.493,0.493,0.515,0.515,0.515,0.515,0.442,0.435,0.413,0.77,0.77,0.77,0.718,0.631,0.671,0.671,0.671,0.7,0.7,0.7,0.7,0.693,0.693,0.693,0.659,0.597,0.597,0.614,0.679,0.679,0.74,0.74,0.74,0.713,0.713,0.713,0.713,0.584,0.58,0.614,0.614,0.583,0.609,0.585,0.585,0.585,0.573,0.573],"rm":[7.147,6.43,6.012,6.172,5.631,6.004,6.377,6.009,5.935,5.599,6.674,5.85,5.682,5.786,6.115,5.998,5.888,6.383,6.456,6.29,5.787,5.594,6.286,5.874,6.015,6.121,6.211,6.249,6.625,7.416,6.474,5.731,5.961,5.822,6.335,5.942,5.468,6.13,5.709,6.129,6.943,6.319,5.875,5.859,6.86,6.144,6.563,6.153,6.739,6.975,7.61,5.344,6.182,6.879,8.04,7.163,7.412,6.086,6.606,6.393,5.593,5.876,7.454,6.842,7.203,7.52,7.327,5.56,6.854,6.826,6.495,6.849,5.972,4.973,6.122,6.567,5.914,5.782,6.426,6.376,6.041,6.316,6.31,5.869,5.968,5.898,6.635,5.936,6.212,6.398,5.362,8.78,4.97,6.38,6.223,6.968,4.368,5.277,4.652,5,6.193,5.852,6.404,4.138,6.852,5.757,6.103,5.896,6.193,5.935,5.818,6.251,6.749,7.393,6.081,6.376,6.003,5.926,6.98,6.185,6.312,5.093,5.707,5.39,6.019,6.593,6.03],"age":[54.2,58.7,66.6,96.1,100,85.9,94.3,82.9,29.3,85.7,87.3,41.5,33.8,33.3,63,21.4,47.6,35.7,67.8,17.8,31.1,36.8,45,36.6,45.1,56.8,28.9,77.3,57.8,62.5,97.1,65.2,92.9,95.4,98.2,93.5,100,100,98.5,96,97.4,96.1,94.6,68.7,74.4,62.2,95.6,68.8,30.8,15.3,15.7,100,42.4,77.7,86.5,79.9,76.9,61.5,42.2,7.8,76.5,19.1,34.2,100,81.8,89.4,94.5,62.8,42.8,27.6,18.4,70.3,76.7,37.8,52.8,87.3,83.2,71.7,52.3,54.3,49.9,38.1,38.5,46.3,58.5,52.3,29.7,19.5,97.4,88,96.2,82.9,100,96.2,100,91.9,91.2,98.1,100,89.5,92.6,77.8,100,100,100,100,85.1,95.4,78.1,87.9,92.4,96.6,92.6,99.3,84.4,88.4,94.5,71,67.6,96.7,51.9,98,54,72.9,65.3,69.1,80.8],"dis":[6.0622,6.0622,5.5605,5.9505,6.0821,6.5921,6.3467,6.2267,4.4986,4.4546,4.239,3.9342,5.1004,5.1004,6.8147,6.8147,7.3197,9.1876,7.2255,6.6115,6.6115,6.498,4.5026,4.5026,4.4272,3.7476,3.6659,3.615,3.4952,3.4952,2.4329,2.7592,2.0869,2.4699,2.1107,1.9669,1.4118,1.4191,1.6232,1.7494,1.8773,2.1,2.4259,2.7019,2.9153,2.5979,2.847,3.2797,6.4798,7.6534,6.27,3.875,3.9454,3.2721,3.2157,3.2157,3.6715,3.6519,6.1899,7.0355,7.9549,9.2203,6.3361,2.0107,2.1121,2.1398,2.0788,1.9865,4.2673,4.8628,5.4917,3.1827,3.1025,2.5194,2.6403,3.6023,3.9986,4.0317,4.5404,4.5404,4.7211,6.4584,6.4584,5.2311,4.8122,8.0136,8.344,10.5857,2.1222,2.5182,2.1036,1.9047,1.3325,1.3861,1.3861,1.4165,1.4395,1.4261,1.4672,1.5184,1.7912,1.5004,1.639,1.1781,1.4655,1.413,2.0218,1.9096,1.9356,1.8206,1.8662,2.198,2.3236,2.4527,2.7175,2.5671,2.5403,2.9084,2.5329,2.1705,3.9917,1.8226,2.3817,2.7986,2.4091,2.4786,2.505],"rad":[3,3,5,5,5,5,5,5,4,4,4,5,3,3,4,4,3,2,8,4,4,4,5,5,3,3,4,4,2,2,5,6,2,4,4,4,5,5,5,5,5,5,5,5,5,3,3,3,5,3,2,4,4,8,8,8,8,8,6,6,7,1,3,5,5,5,5,5,4,4,7,7,4,4,4,4,4,4,5,5,5,5,5,5,5,3,4,4,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,4,6,6,6,1,1],"tax":[222,222,311,311,311,311,311,311,307,307,307,279,233,233,243,243,469,313,284,337,337,345,398,398,247,247,270,270,276,276,384,432,188,437,437,437,403,403,403,403,403,403,403,296,296,193,193,193,398,402,348,277,277,307,307,307,307,307,300,300,330,315,244,264,264,264,264,264,254,254,329,222,304,304,304,304,304,304,287,287,287,224,224,224,224,352,280,334,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,666,711,391,391,391,273,273],"ptratio":[18.7,18.7,15.2,15.2,15.2,15.2,15.2,15.2,21,21,21,19.2,17.9,17.9,16.8,16.8,21.1,17.3,19.7,16.1,16.1,18.9,18.7,18.7,18.5,18.5,18.2,18.2,18,18,20.9,17.8,19.1,21.2,21.2,21.2,14.7,14.7,14.7,14.7,14.7,14.7,14.7,16.6,16.6,17.8,17.8,17.8,15.2,17,14.7,18.6,18.6,17.4,17.4,17.4,17.4,17.4,16.6,16.6,19.1,16.4,15.9,13,13,13,13,13,17.6,17.6,16.1,18.4,18.4,18.4,18.4,18.4,18.4,18.4,19.6,19.6,19.6,20.2,20.2,20.2,20.2,18.8,17,22,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.2,20.1,19.2,19.2,19.2,21,21],"lstat":[5.33,5.21,12.43,19.15,29.93,17.1,20.45,13.27,6.58,16.51,11.98,8.77,10.21,14.15,9.43,8.43,14.8,5.77,6.73,4.67,10.24,13.09,8.94,9.1,12.86,8.44,6.21,10.59,6.65,6.19,12.27,13.61,17.93,15.03,16.96,16.9,26.42,27.8,15.79,15.12,4.59,11.1,14.43,9.64,6.92,9.45,5.68,13.15,4.69,4.56,3.11,23.09,9.47,9.93,3.13,6.36,5.25,10.88,7.37,5.19,12.5,9.25,3.11,6.9,9.59,7.26,11.25,10.45,2.98,4.16,8.67,7.53,9.97,12.64,5.98,9.28,18.33,15.94,7.2,6.87,7.7,5.68,6.75,9.8,9.29,12.67,5.99,5.57,17.6,7.79,10.19,5.29,3.26,23.69,21.78,17.21,30.63,30.81,28.28,31.99,15.17,29.97,20.31,23.34,19.78,10.11,23.29,24.39,21.52,34.02,22.11,16.44,17.44,16.74,14.7,14.65,21.32,18.13,11.66,18.03,10.58,29.68,12.01,21.14,12.92,9.67,7.88],"medv":[36.2,28.7,22.9,27.1,16.5,18.9,15,18.9,23.1,13.9,21,21,19.3,20,20.5,23.4,18.9,24.7,22.2,23.5,19.4,17.4,21.4,20.3,22.5,22.2,25,20.6,28.4,33.2,19.8,19.3,20.5,18.4,18.1,17.4,15.6,13.8,19.4,17,41.3,23.8,17.4,22.6,29.9,36.2,32.5,29.6,30.5,34.9,42.3,20,25,27.5,37.6,31.6,31.7,24,23.3,23.7,17.6,20.9,44,30.1,33.8,43.1,31,22.8,32,33.1,26.4,28.2,20.3,16.1,22.1,23.8,17.8,19.8,23.8,23.1,20.4,22.2,20.7,19.5,18.7,17.2,24.5,20.6,17.8,25,20.8,21.9,50,13.1,10.2,10.4,8.8,7.2,10.5,7.4,13.8,6.3,12.1,11.9,27.5,15,13.4,8.3,11,8.4,10.5,12.6,13.4,17.8,20,17.7,19.1,19.1,29.8,14.6,21.2,8.1,21.8,19.7,21.2,22.4,11.9],".pred":[29.5161875597398,28.2655748506282,20.5899772585842,20.2818446008832,16.2437529733599,20.3108622166895,16.2667301781108,19.9649935381497,21.6960587123255,17.0326641215416,18.9739755412857,24.3352616973812,23.5479259070227,20.2484468567023,23.6820597633329,23.6144489844457,18.4408778226638,23.3096268100798,23.4857665943201,28.2884811613044,23.475611465424,20.2448371370569,23.7983987422096,23.6421236570514,20.4762662419388,23.9567440151114,24.1712985302313,20.7695878088838,24.0274577810626,29.5945334531993,18.8813548867299,20.5480637624666,20.6072886660882,17.2727172124486,17.3859315408572,17.5825893015614,15.359519475639,15.1664579128441,19.5617934754164,19.998011831157,39.5047629031325,20.6571147433268,20.4973831423528,23.7985607117276,24.0928927891974,23.9267331276952,24.1001674146547,20.5716204438677,28.3573976852992,34.1496343113612,46.9672225676553,17.4289936093543,23.83290144641,24.7875609933663,46.0862586232562,29.5690991773614,34.4036258377693,20.5547915749513,23.8135002226028,28.1624368963012,20.2165098043826,23.462751138197,35.4997290307895,26.5405914067494,33.4041198057904,33.0869234872195,30.092860925761,22.8943636032811,28.6115927113506,32.6739097652852,23.7103374589427,23.8698307696924,23.8751958109644,20.8048979348623,24.0225263197456,24.0187968247661,20.7984464531398,20.5114280240117,23.8149834413907,23.7588929525724,23.497081992015,21.9611845568309,21.928869483225,22.0494208169673,21.8524497290761,20.0991290647916,23.7079249467956,21.990541368424,21.9127278036675,17.6089531461429,17.6195891344949,51.9205118203458,38.3451162913811,13.3721322626377,13.243840182916,20.6032881353213,9.95099843073465,9.98613715686889,9.83749560911701,9.96263311149124,14.4583027736014,10.0312791667787,10.1476831306921,13.4097067705689,17.6126777688928,37.7452933949687,13.7732454691756,10.078986646239,10.271454192762,10.2642023841682,9.88927439713575,14.3252384796774,14.3181149700853,17.9997212311631,14.4361424419894,14.2570253540909,13.5666624685203,17.4680027990452,23.8075830431841,17.4141904805553,19.2171689743099,13.0230773593385,20.5125767680012,16.496282493586,20.4841938093065,22.1088897753563,22.0482655738031]},"columns":[{"accessor":"crim","name":"crim","type":"numeric"},{"accessor":"zn","name":"zn","type":"numeric"},{"accessor":"indus","name":"indus","type":"numeric"},{"accessor":"chas","name":"chas","type":"numeric"},{"accessor":"nox","name":"nox","type":"numeric"},{"accessor":"rm","name":"rm","type":"numeric"},{"accessor":"age","name":"age","type":"numeric"},{"accessor":"dis","name":"dis","type":"numeric"},{"accessor":"rad","name":"rad","type":"numeric"},{"accessor":"tax","name":"tax","type":"numeric"},{"accessor":"ptratio","name":"ptratio","type":"numeric"},{"accessor":"lstat","name":"lstat","type":"numeric"},{"accessor":"medv","name":"medv","type":"numeric"},{"accessor":".pred","name":".pred","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"7a1dfc4365f8fd8ca6d444b38cbb34f6","key":"7a1dfc4365f8fd8ca6d444b38cbb34f6"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>We check how well the <code>.pred</code> column matches the <code>medv</code> using <a href="https://yardstick.tidymodels.org/reference/rmse.html"><code>yardstick::rmse</code></a>.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">rmse</span>(<span class="at">truth =</span> .data[[<span class="st">&quot;medv&quot;</span>]], <span class="at">estimate =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code></pre></div>
<div id="htmlwidget-f2defae6332564cede63" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f2defae6332564cede63">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["rmse"],".estimator":["standard"],".estimate":[5.08353192712968]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"156aef0ca5d538a1966e8aaf5f83cff4","key":"156aef0ca5d538a1966e8aaf5f83cff4"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<p>Let us take a closer look at the predicted and actual response as a scatter plot.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .data[[<span class="st">&quot;medv&quot;</span>]],</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .data[[<span class="st">&quot;.pred&quot;</span>]]</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_fixed</span>()</span></code></pre></div>
<p><img src="docs/figures/unnamed-chunk-124-1.png" width="3883.2" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="blog-references" class="section level1">
<h1>Blog References</h1>
<ul>
<li><p>Emil Hvitfeldt’s <a href="https://emilhvitfeldt.github.io/ISLR-tidymodels-labs/tree-based-methods.html">ISLR tidymodels Labs</a></p></li>
<li><p>Julia Silge’s <a href="https://juliasilge.com/blog/scooby-doo.html">blog</a> titled “Predict which #TidyTuesday Scooby Doo monsters are REAL with a tuned decision tree model”</p></li>
<li><p>Julia Silge’s <a href="https://juliasilge.com/blog/wind-turbine.html">blog</a> titled “Tune and interpret decision trees for #TidyTuesday wind turbines”</p></li>
<li><p>Julia Silge’s <a href="https://juliasilge.com/blog/xgboost-tune-volleyball.html">blog</a> titled “Tune XGBoost with tidymodels and #TidyTuesday beach volleyball”</p></li>
<li><p>R-bloggers’ <a href="https://www.r-bloggers.com/2019/10/explaining-predictions-boosted-trees-post-hoc-analysis-xgboost/">blog</a> titled “Explaining Predictions: Boosted Trees Post-hoc Analysis (Xgboost)”</p></li>
</ul>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAnKipDaGFwdGVyIDggTGFiKionCmF1dGhvcjogIkplcmVteSBTZWx2YSIKc3VidGl0bGU6IFRoaXMgZG9jdW1lbnQgd2FzIHByZXBhcmVkIG9uIGByIGZvcm1hdChTeXMuRGF0ZSgpKWAuCm91dHB1dDoKICBodG1sX2RvY3VtZW50OgogICAgdGhlbWU6IGNlcnVsZWFuCiAgICBoaWdobGlnaHQ6IHB5Z21lbnRzCiAgICB0b2M6IHllcwogICAgdG9jX2RlcHRoOiAzCiAgICB0b2NfZmxvYXQ6CiAgICAgIGNvbGxhcHNlZDogdHJ1ZQogICAgICBzbW9vdGhfc2Nyb2xsOiB0cnVlCiAgICBudW1iZXJfc2VjdGlvbnM6IG5vCiAgICBjb2RlX2ZvbGRpbmc6IHNob3cKICAgIGNvZGVfZG93bmxvYWQ6IHllcwogICAgc2VsZl9jb250YWluZWQ6IGZhbHNlCiAgICBsaWJfZGlyOiAiZG9jcy9ybWFya2Rvd25fbGlicyIKICBybWFya2Rvd246Omh0bWxfdmlnbmV0dGU6CiAgICB0b2M6IHllcwogICAgdG9jX2RlcHRoOiAyCmVkaXRvcl9vcHRpb25zOgogIGNodW5rX291dHB1dF90eXBlOiBjb25zb2xlCiAgbWFya2Rvd246IAogICAgd3JhcDogNzIKLS0tCjwhLS0gCiEhISEgSU1QT1JUQU5UOiBydW4gYHNvdXJjZSgidXRpbHMvcmVuZGVyLlIiKWAgdG8gcHVibGlzaCBpbnN0ZWFkIG9mIGNsaWNraW5nIG9uICdLbml0JwojIFNlZSBodHRwczovL3lpaHVpLm9yZy9rbml0ci9vcHRpb25zLwotLT4KCmBgYHtyIHNldHVwLCB3YXJuaW5nPUZBTFNFLCBtZXNzYWdlPVRSVUUsIGluY2x1ZGU9RkFMU0V9CiMgU2V0IHVwIHRoZSBlbnZpcm9ubWVudAoKIyBPcHRpb25zIHJlbGF0aXZlIHRvIGZpZ3VyZSBzaXplCiMgMS42MTggaXMgdGhlIGdvbGRlbiByYXRpbwpmaWdoZWlnaHQgPC0gNApmaWd3aWR0aCA8LSA0ICogMS42MTggCgojIEdlbmVyYWwgb3B0aW9ucwpvcHRpb25zKGtuaXRyLmthYmxlLk5BID0gIiIsCiAgICAgICAgbnNtYWxsID0gMywKICAgICAgICB0aWR5dmVyc2UucXVpZXQgPSBUUlVFCiAgICAgICAgKQpob29rX291dHB1dCA8LSBrbml0cjo6a25pdF9ob29rcyRnZXQoJ291dHB1dCcpCgprbml0cjo6a25pdF9ob29rcyRzZXQoCiAgb3V0cHV0ID0gZnVuY3Rpb24oeCwgb3B0aW9ucykgewogICAgaWYgKCFpcy5udWxsKG9wdGlvbnMkbWF4LmhlaWdodCkpIHsKICAgICAgb3B0aW9ucyRhdHRyLm91dHB1dCA8LSBjKG9wdGlvbnMkYXR0ci5vdXRwdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHJpbnRmKCdzdHlsZT0ibWF4LWhlaWdodDogJXM7IicsIG9wdGlvbnMkbWF4LmhlaWdodCkpCiAgICB9CiAgICBob29rX291dHB1dCh4LCBvcHRpb25zKQogICAgfQogICkKCiMgQ2h1bmsgb3B0aW9ucyAoc2VlIGh0dHBzOi8veWlodWkub3JnL2tuaXRyL29wdGlvbnMvI2NodW5rX29wdGlvbnMpCmtuaXRyOjpvcHRzX2NodW5rJHNldCgKICBjb21tZW50ID0gIj4iLCAgIyBUaGUgcHJlZml4IHRvIGJlIGFkZGVkIGJlZm9yZSBlYWNoIGxpbmUgb2YgdGhlIHRleHQgb3V0cHV0LgogIGRwaSA9IDYwMCwKICBmaWcucGF0aCA9ICJkb2NzL2ZpZ3VyZXMvIiwKICBmaWcuaGVpZ2h0ID0gZmlnaGVpZ2h0LAogIGZpZy53aWR0aCA9IGZpZ3dpZHRoLAogIGZpZy5hbGlnbiA9ICJjZW50ZXIiLAogICMgU2VlIGh0dHBzOi8vY29tbXVuaXR5LnJzdHVkaW8uY29tL3QvY2VudGVyaW5nLWltYWdlcy1pbi1ibG9nZG93bi1wb3N0LzIwOTYyCiAgIyB0byBsZWFybiBob3cgdG8gY2VudGVyIGltYWdlcwogICMgU2VlIGh0dHBzOi8vYm9va2Rvd24ub3JnL3lpaHVpL3JtYXJrZG93bi1jb29rYm9vay9vcHRzLXRpZHkuaHRtbAogICMgU2VlIGh0dHBzOi8vd3d3LnpvdGVyby5vcmcvc3R5bGVzIGZvciBjaXRhdGlvbiBzdHlsZSByZXNwb3NpdG9yeQogIHRpZHk9J3N0eWxlcicsCiAgdGlkeS5vcHRzPWxpc3Qoc3RyaWN0PVRSVUUpCikKCmBgYAoKYGBge3Igd2FybmluZz1GQUxTRSwgbWVzc2FnZT1GQUxTRSwgcmVzdWx0cz0nYXNpcycsIGNsYXNzLnNvdXJjZSA9ICdmb2xkLWhpZGUnfQojIFJtYXJrZG93biBzdHVmZgpsaWJyYXJ5KHJtYXJrZG93biwgcXVpZXRseT1UUlVFKQpsaWJyYXJ5KGtuaXRyLCBxdWlldGx5PVRSVUUpCiNsaWJyYXJ5KGh0bWx0b29scywgcXVpZXRseT1UUlVFKQpsaWJyYXJ5KHN0eWxlciwgcXVpZXRseT1UUlVFKQojbGlicmFyeSh4YXJpbmdhbkV4dHJhLCBxdWlldGx5PVRSVUUpCgojIERhdGFzZXQKbGlicmFyeShJU0xSMiwgcXVpZXRseT1UUlVFKQoKIyBTZXNzaW9uIGluZm8gYW5kIHBhY2thZ2UgcmVwb3J0aW5nCmxpYnJhcnkocmVwb3J0LCBxdWlldGx5PVRSVUUpCgojIERhdGEgd3JhbmdsaW5nCgpsaWJyYXJ5KGRwbHlyLCBxdWlldGx5PVRSVUUpCmxpYnJhcnkobWFncml0dHIsIHF1aWV0bHk9VFJVRSkKCiMgQ3JlYXRlIGludGVyYWN0aXZlIHRhYmxlcwpsaWJyYXJ5KHJlYWN0YWJsZSwgcXVpZXRseT1UUlVFKQoKIyBGb3IgcGxvdHRpbmcKCmxpYnJhcnkoZ2dwbG90MiwgcXVpZXRseT1UUlVFKQojIEZyb20gZ2l0aHViCmxpYnJhcnkocGFydHRyZWUsIHF1aWV0bHk9VFJVRSkKbGlicmFyeShDb25mdXNpb25UYWJsZVIsIHF1aWV0bHkgPSBUUlVFKQoKIyBGb3IgRGVjaXNpb24gQ2xhc3NpZmljYXRpb24gVHJlZXMKbGlicmFyeShycGFydCwgcXVpZXRseT1UUlVFKQpsaWJyYXJ5KHJwYXJ0LnBsb3QsIHF1aWV0bHk9VFJVRSkKCiMgRm9yIEJhZ2dpbmcgYW5kIFJhbmRvbSBGb3Jlc3QKbGlicmFyeShyYW5kb21Gb3Jlc3QsIHF1aWV0bHk9VFJVRSkKCiMgRm9yIEJvb3N0aW5nCmxpYnJhcnkoeGdib29zdCwgcXVpZXRseT1UUlVFKQpsaWJyYXJ5KERpYWdyYW1tZVIsIHF1aWV0bHk9VFJVRSkKbGlicmFyeShEaWFncmFtbWVSc3ZnLCBxdWlldGx5PVRSVUUpCmxpYnJhcnkocnN2ZywgcXVpZXRseT1UUlVFKQoKIyBGb3IgQkFSVApsaWJyYXJ5KGRiYXJ0cywgcXVpZXRseT1UUlVFKQojIEZyb20gZ2l0aHViCmxpYnJhcnkoZW1iYXJjYWRlcm8sIHF1aWV0bHk9VFJVRSkKCiMgRm9yIHZhcmlhYmxlIGltcG9ydGFuY2UKbGlicmFyeSh2aXAsIHF1aWV0bHk9VFJVRSkKCiMgRm9yIHBhcmFsbGVsIHByb2Nlc3NpbmcgZm9yIHR1bmluZwpsaWJyYXJ5KGZvcmVhY2gsIHF1aWV0bHk9VFJVRSkKbGlicmFyeShkb1BhcmFsbGVsLCBxdWlldGx5PVRSVUUpCgojIEZvciBhcHBseWluZyB0aWR5bW9kZWxzCgpsaWJyYXJ5KHJzYW1wbGUsIHF1aWV0bHk9VFJVRSkKbGlicmFyeShyZWNpcGVzLCBxdWlldGx5PVRSVUUpCmxpYnJhcnkocGFyc25pcCwgcXVpZXRseT1UUlVFKQpsaWJyYXJ5KGRpYWxzLCBxdWlldGx5PVRSVUUpCmxpYnJhcnkodHVuZSwgcXVpZXRseT1UUlVFKQpsaWJyYXJ5KHdvcmtmbG93cywgcXVpZXRseT1UUlVFKQpsaWJyYXJ5KHlhcmRzdGljaywgcXVpZXRseT1UUlVFKQoKc3VtbWFyeShyZXBvcnQ6OnJlcG9ydChzZXNzaW9uSW5mbygpKSkKYGBgCgojIEZpdHRpbmcgQ2xhc3NpZmljYXRpb24gVHJlZXMKCmBgYHtyLCBlY2hvPUZBTFNFfQpzZXQuc2VlZCgxMjM0KQpgYGAKCkluIHRoZSBgQ2Fyc2VhdHNgIGRhdGEgc2V0LCBgU2FsZXNgIGlzIGEgY29udGludW91cyB2YXJpYWJsZSwgYW5kIHNvIHdlIGJlZ2luIGJ5IHJlY29yZGluZyBpdCBhcyBhIGJpbmFyeSB2YXJpYWJsZSBjYWxsZWQgYEhpZ2hgLCB3aGljaCB0YWtlcyBvbiBhIHZhbHVlIG9mIFllcyBpZiB0aGUgU2FsZXMgdmFyaWFibGUgZXhjZWVkcyA4LCBhbmQgdGFrZXMgb24gYSB2YWx1ZSBvZiBObyBvdGhlcndpc2UuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCkNhcnNlYXRzIDwtIGRwbHlyOjphc190aWJibGUoSVNMUjI6OkNhcnNlYXRzKSAlPiUKICBkcGx5cjo6bXV0YXRlKAogICAgSGlnaCA9IGZhY3RvcihkcGx5cjo6aWZfZWxzZSguZGF0YVtbIlNhbGVzIl1dIDw9IDgsICJObyIsICJZZXMiKSkKICAgICkgJT4lCiAgZHBseXI6OnNlbGVjdCgtZHBseXI6OmFsbF9vZihjKCJTYWxlcyIpKSkKCkNhcnNlYXRzICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUsCiAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyYWJsZSA9IFRSVUUpCmBgYAoKIyMgQ3JlYXRlIHRoZSByZXNhbXBsZSBvYmplY3QKCkZpcnN0LCB3ZSBzcGxpdCB0aGUgc2FtcGxlcyBpbnRvIGEgdHJhaW5pbmcgc2V0IGFuZCBhIHRlc3Qgc2V0LiBGcm9tIHRoZSB0cmFpbmluZyBzZXQsIHdlIGNyZWF0ZSBhIDEwLWZvbGQgY3Jvc3MtdmFsaWRhdGlvbiBkYXRhIHNldCBmcm9tIHRoZSB0cmFpbmluZyBzZXQuCgpUaGlzIGlzIGRvbmUgd2l0aCBbYHJzYW1wbGU6OmluaXRpYWxfc3BsaXRgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCksCltgcnNhbXBsZTo6dHJhaW5pbmdgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCksCltgcnNhbXBsZTo6dGVzdGluZ2BdKGh0dHBzOi8vcnNhbXBsZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvaW5pdGlhbF9zcGxpdC5odG1sKQphbmQKW2Byc2FtcGxlOjp2Zm9sZF9jdmBdKGh0dHBzOi8vcnNhbXBsZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvdmZvbGRfY3YuaHRtbCkuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCkNhcnNlYXRzX3NwbGl0IDwtIHJzYW1wbGU6OmluaXRpYWxfc3BsaXQoQ2Fyc2VhdHMpCgpDYXJzZWF0c190cmFpbiA8LSByc2FtcGxlOjp0cmFpbmluZyhDYXJzZWF0c19zcGxpdCkKQ2Fyc2VhdHNfdGVzdCA8LSByc2FtcGxlOjp0ZXN0aW5nKENhcnNlYXRzX3NwbGl0KQoKQ2Fyc2VhdHNfZm9sZCA8LSByc2FtcGxlOjp2Zm9sZF9jdihDYXJzZWF0c190cmFpbiwgdiA9IDEwKQoKCmBgYAoKIyMgQ3JlYXRlIHRoZSBwcmVwcm9jZXNzb3IKCldlIGNyZWF0ZSBhIHJlY2lwZSB3aXRoIFtgcmVjaXBlczo6cmVjaXBlYF0oaHR0cHM6Ly9yZWNpcGVzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9yZWNpcGUuaHRtbCkuCk5vIG90aGVyIHByZXByb2Nlc3Npbmcgc3RlcCBpcyBkb25lLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpjbGFzc190cmVlX3JlY2lwZSA8LSAKICByZWNpcGVzOjpyZWNpcGUoZm9ybXVsYSA9IEhpZ2ggfiAuLCBkYXRhID0gQ2Fyc2VhdHNfdHJhaW4pCgpgYGAKCiMjIFNwZWNpZnkgdGhlIG1vZGVsCgpVc2UKW2BwYXJzbmlwOjpkZWNpc2lvbl90cmVlYF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9kZWNpc2lvbl90cmVlLmh0bWwpLApbYHBhcnNuaXA6OnNldF9tb2RlYF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zZXRfYXJncy5odG1sKQphbmQKW2BwYXJzbmlwOjpzZXRfZW5naW5lYF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zZXRfZW5naW5lLmh0bWwpCnRvIGNyZWF0ZSB0aGUgbW9kZWwuCgpUaGUgY29zdCBjb21wbGV4aXR5IGlzIHR1bmVkIHVzaW5nCltgdHVuZTo6dHVuZWBdKGh0dHBzOi8vaGFyZGhhdC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvdHVuZS5odG1sKQoKQW4gZW5naW5lIHNwZWNpZmljIHBhcmFtZXRlciBgbW9kZWwgPSBUUlVFYCBpcyBzZXQgZm9yIHJwYXJ0IHRvIHByZXZlbnQgdGhpcyB3YXJuaW5nIG1lc3NhZ2UgZnJvbSBjb21pbmcgdXAgbGF0ZXIgd2hlbiBgcnBhcnQucGxvdDo6cnBhcnQucGxvdGAgaXMgdXNlZCBsYXRlci4KCmBgYHtyfQojPiBXYXJuaW5nOiBDYW5ub3QgcmV0cmlldmUgdGhlIGRhdGEgdXNlZCB0byBidWlsZCB0aGUgbW9kZWwgKHNvIGNhbm5vdCBkZXRlcm1pbmUgcm91bmRpbnQgYW5kIGlzLmJpbmFyeSBmb3IgdGhlIHZhcmlhYmxlcykuCiM+IFRvIHNpbGVuY2UgdGhpcyB3YXJuaW5nOgojPiAgICAgQ2FsbCBycGFydC5wbG90IHdpdGggcm91bmRpbnQ9RkFMU0UsCiM+ICAgICBvciByZWJ1aWxkIHRoZSBycGFydCBtb2RlbCB3aXRoIG1vZGVsPVRSVUUuCmBgYAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpjbGFzc190cmVlX3NwZWMgPC0gcGFyc25pcDo6ZGVjaXNpb25fdHJlZSgKICB0cmVlX2RlcHRoID0gNCwKICBjb3N0X2NvbXBsZXhpdHkgPSB0dW5lOjp0dW5lKCkpICU+JQogIHBhcnNuaXA6OnNldF9tb2RlKCJjbGFzc2lmaWNhdGlvbiIpICU+JSAKICBwYXJzbmlwOjpzZXRfZW5naW5lKCJycGFydCIsIG1vZGVsID0gVFJVRSkKCmNsYXNzX3RyZWVfc3BlYyAlPiUKICBwYXJzbmlwOjp0cmFuc2xhdGUoKQpgYGAKCiMjIENyZWF0ZSB0aGUgd29ya2Zsb3cKCltgd29ya2Zsb3dzOjp3b3JrZmxvd2BdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS93b3JrZmxvdy5odG1sKSwKW2B3b3JrZmxvd3M6OmFkZF9yZWNpcGVgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYWRkX3JlY2lwZS5odG1sKQphbmQKW2B3b3JrZmxvd3M6OmFkZF9tb2RlbGBdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9hZGRfbW9kZWwuaHRtbCkKYXJlIHVzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKY2xhc3NfdHJlZV93b3JrZmxvdyA8LSAgd29ya2Zsb3dzOjp3b3JrZmxvdygpICU+JSAKICB3b3JrZmxvd3M6OmFkZF9yZWNpcGUoY2xhc3NfdHJlZV9yZWNpcGUpICU+JSAKICB3b3JrZmxvd3M6OmFkZF9tb2RlbChjbGFzc190cmVlX3NwZWMpCgpjbGFzc190cmVlX3dvcmtmbG93IApgYGAKCiMjIENyZWF0ZSB0aGUgY29zdCBjb21wbGV4aXR5IGdyaWQKCkEgY29zdCBjb21wbGV4aXR5IGdyaWQgb2YgJDEwJCBudW1iZXJzIGZyb20gJDAuMDAxJCAoJDEwXnstM30kKSB0bwokMTAkICgkMTBeMSQpIGlzIGNyZWF0ZWQuCgpSZWd1bGFyIGdyaWQgaXMgY3JlYXRlZCB1c2luZwpbYGRpYWxzOjpncmlkX3JlZ3VsYXJgXShodHRwczovL2RpYWxzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9ncmlkX3JlZ3VsYXIuaHRtbCksCltgZGlhbHM6OmNvc3RfY29tcGxleGl0eWBdKGh0dHBzOi8vZGlhbHMudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3RyZWVzLmh0bWwpCmFuZApbYHNjYWxlczo6bG9nMTBfdHJhbnNgXShodHRwczovL3NjYWxlcy5yLWxpYi5vcmcvcmVmZXJlbmNlL2xvZ190cmFucy5odG1sKQoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgojIENyZWF0ZSBhIHJhbmdlIGZyb20gMTAKY29zdF9jb21wbGV4aXR5X2dyaWQgPC0gCiAgZGlhbHM6OmdyaWRfcmVndWxhcigKICAgIHggPSBkaWFsczo6Y29zdF9jb21wbGV4aXR5KHJhbmdlID0gYygtMywgMSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFucyA9IHNjYWxlczo6bG9nMTBfdHJhbnMoKSksCiAgICBsZXZlbHMgPSAxMAogICkKCmNvc3RfY29tcGxleGl0eV9ncmlkICAlPiUgCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKYGBgCgojIyBDbGFzc2lmaWNhdGlvbiB0cmVlIG1vZGVsIGZpdHRpbmcgb24gY3Jvc3MgdmFsaWRhdGVkIGRhdGEKCk5vdyB3ZSBoYXZlIGV2ZXJ5dGhpbmcgd2UgbmVlZCBhbmQgd2UgY2FuIGZpdCBhbGwgdGhlIG1vZGVscyBvbiB0aGUKY3Jvc3MgdmFsaWRhdGVkIGRhdGEgd2l0aApbYHR1bmU6OnR1bmVfZ3JpZGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvdHVuZV9ncmlkLmh0bWwpLgpOb3RlIHRoYXQgdGhpcyBwcm9jZXNzIG1heSB0YWtlIHNvbWUgdGltZS4KCldlIHVzZSBbYHlhcmRzdGljazo6bWV0cmljX3NldGBdKGh0dHBzOi8veWFyZHN0aWNrLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9tZXRyaWNfc2V0Lmh0bWwpLCB0byBjaG9vc2UgYSBzZXQgb2YgbWV0cmljcyB0byB1c2VkIHRvIGV2YWx1YXRlIHRoZSBtb2RlbC4gSW4gdGhpcyBleGFtcGxlLCBbYHlhcmRzdGljazo6YWNjdXJhY3lgXShodHRwczovL3lhcmRzdGljay50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYWNjdXJhY3kuaHRtbCksCltgeWFyZHN0aWNrOjpyb2NfYXVjYF0oaHR0cHM6Ly95YXJkc3RpY2sudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3JvY19jdXJ2ZS5odG1sKSwKW2B5YXJkc3RpY2s6OnNlbnNpdGl2aXR5YF0oaHR0cHM6Ly95YXJkc3RpY2sudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3NlbnMuaHRtbCkgYW5kIFtgeWFyZHN0aWNrOjpzcGVjaWZpY2l0eWBdKGh0dHBzOi8veWFyZHN0aWNrLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zcGVjLmh0bWwpIGFyZSB1c2VkLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CmRvUGFyYWxsZWw6OnJlZ2lzdGVyRG9QYXJhbGxlbCgpCmZvcmVhY2g6OmdldERvUGFyV29ya2VycygpCmBgYAoKYGBge3IsIG1lc3NhZ2U9RkFMU0UsIG1heC5oZWlnaHQ9JzE1MHB4J30KdHVuZV9yZXMgPC0gdHVuZTo6dHVuZV9ncmlkKAogIG9iamVjdCA9IGNsYXNzX3RyZWVfd29ya2Zsb3csCiAgcmVzYW1wbGVzID0gQ2Fyc2VhdHNfZm9sZCwgCiAgZ3JpZCA9IGNvc3RfY29tcGxleGl0eV9ncmlkLAogIG1ldHJpY3MgPSB5YXJkc3RpY2s6Om1ldHJpY19zZXQoeWFyZHN0aWNrOjphY2N1cmFjeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlhcmRzdGljazo6cm9jX2F1YywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlhcmRzdGljazo6c2Vuc2l0aXZpdHksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeWFyZHN0aWNrOjpzcGVjaWZpY2l0eSkKKQoKdHVuZV9yZXMKYGBgCgpIZXJlIHdlIHNlZSB0aGF0IHRoZSBhbW91bnQgb2YgY29zdCBjb21wbGV4aXR5IGFmZmVjdHMgdGhlIHBlcmZvcm1hbmNlCm1ldHJpY3MgZGlmZmVyZW50bHkgdXNpbmcKW2B0dW5lOjphdXRvcGxvdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXV0b3Bsb3QudHVuZV9yZXN1bHRzLmh0bWwpLgpEbyBub3RlIHRoYXQgdXNpbmcgYSBkaWZmZXJlbnQgc2VlZCB3aWxsIGdpdmUgYSBkaWZmZXJlbnQgcGxvdAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CiMgTm90ZSB0aGF0IGEgZGlmZmVyZW50IHNlZWQgd2lsbCBnaXZlIGRpZmZlcmVudCBwbG90cwp0dW5lOjphdXRvcGxvdCh0dW5lX3JlcykKYGBgCgpXZSBjYW4gYWxzbyBzZWUgdGhlIHJhdyBtZXRyaWNzIHRoYXQgY3JlYXRlZCB0aGlzIGNoYXJ0IGJ5IGNhbGxpbmcKW2B0dW5lOjpjb2xsZWN0X21ldHJpY3MoKWBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvY29sbGVjdF9wcmVkaWN0aW9ucy5odG1sKS4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9Cgp0dW5lOjpjb2xsZWN0X21ldHJpY3ModHVuZV9yZXMpICU+JSAKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQpgYGAKCkhlcmUgaXMgdGhlIGBnZ3Bsb3RgIHdheSBzaG91bGQKW2B0dW5lOjphdXRvcGxvdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXV0b3Bsb3QudHVuZV9yZXN1bHRzLmh0bWwpCmZhaWxzCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKdHVuZV9yZXMgJT4lCiAgdHVuZTo6Y29sbGVjdF9tZXRyaWNzKCkgJT4lCiAgZ2dwbG90Mjo6Z2dwbG90KG1hcHBpbmcgPSBnZ3Bsb3QyOjphZXMoeCA9IC5kYXRhW1siY29zdF9jb21wbGV4aXR5Il1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAuZGF0YVtbIm1lYW4iXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3VyID0gLmRhdGFbWyIubWV0cmljIl1dKSkgKwogIGdncGxvdDI6Omdlb21fZXJyb3JiYXIobWFwcGluZyA9IGdncGxvdDI6OmFlcyh5bWluID0gLmRhdGFbWyJtZWFuIl1dIC0gLmRhdGFbWyJzdGRfZXJyIl1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5bWF4ID0gLmRhdGFbWyJtZWFuIl1dICsgLmRhdGFbWyJzdGRfZXJyIl1dKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhID0gMC41KSArCiAgZ2dwbG90Mjo6Z2VvbV9saW5lKHNpemUgPSAxLjUpICsKICBnZ3Bsb3QyOjpmYWNldF93cmFwKGZhY2V0cyA9IGdncGxvdDI6OnZhcnMoLmRhdGFbWyIubWV0cmljIl1dKSwgCiAgICAgICAgICAgICAgICAgICAgICBzY2FsZXMgPSAiZnJlZSIsIAogICAgICAgICAgICAgICAgICAgICAgbnJvdyA9IDIpICsKICBnZ3Bsb3QyOjpzY2FsZV94X2xvZzEwKCkgKwogIGdncGxvdDI6OnRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJub25lIikKYGBgCgpVc2UKW2B0dW5lOjpzaG93X2Jlc3RgXShodHRwczovL3R1bmUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3Nob3dfYmVzdC5odG1sKQp0byBzZWUgdGhlIHRvcCBmZXcgdmFsdWVzIGZvciBhIGdpdmVuIG1ldHJpYy4KClRoZSAiYmVzdCIgdmFsdWVzIGNhbiBiZSBzZWxlY3RlZCB1c2luZwpbYHR1bmU6OnNlbGVjdF9iZXN0YF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zaG93X2Jlc3QuaHRtbCksCnRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgeW91IHRvIHNwZWNpZnkgYSBtZXRyaWMgdGhhdCBpdCBzaG91bGQgc2VsZWN0CmFnYWluc3QuIFRoZSBjb3N0IGNvbXBsZXhpdHkgdmFsdWUgaXMgMC4wMDEgZm9yIG1ldHJpYyBgYWNjdXJhY3lgIHNpbmNlIGl0CmdpdmVzIHRoZSBoaWdoZXN0IHZhbHVlLiBEbyBub3RlIHRoYXQgdXNpbmcgYSBkaWZmZXJlbnQgc2VlZCB3aWxsIGdpdmUgYQpkaWZmZXJlbnQgYmVzdCBjb3N0IGNvbXBsZXhpdHkgdmFsdWUuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKdG9wX2Nvc3RfY29tcGxleGl0eSA8LSB0dW5lOjpzaG93X2Jlc3QodHVuZV9yZXMsIG1ldHJpYyA9IGMoImFjY3VyYWN5IiksIG4gPSA1KQp0b3BfY29zdF9jb21wbGV4aXR5ICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCgpiZXN0X2Nvc3RfY29tcGxleGl0eSA8LSB0dW5lOjpzZWxlY3RfYmVzdCh0dW5lX3JlcywgbWV0cmljID0gImFjY3VyYWN5IikKYmVzdF9jb3N0X2NvbXBsZXhpdHkKCmBgYAoKIyMgQ2xhc3NpZmljYXRpb24gdHJlZSBtb2RlbCB3aXRoIG9wdGltaXNlZCBjb3N0IGNvbXBsZXhpdHkgdmFsdWUKCldlIGNyZWF0ZSB0aGUgY2xhc3NpZmljYXRpb24gdHJlZSB3b3JrZmxvdyB3aXRoIHRoZSBiZXN0IGNvc3QgY29tcGxleGl0eSBzY29yZQp1c2luZwpbYHR1bmU6OmZpbmFsaXplX3dvcmtmbG93YF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9maW5hbGl6ZV9tb2RlbC5odG1sKS4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9CgpjbGFzc190cmVlX2ZpbmFsIDwtIHR1bmU6OmZpbmFsaXplX3dvcmtmbG93KAogIHggPSBjbGFzc190cmVlX3dvcmtmbG93LCAKICBwYXJhbWV0ZXJzID0gYmVzdF9jb3N0X2NvbXBsZXhpdHkpCgpjbGFzc190cmVlX2ZpbmFsCmBgYAoKV2Ugbm93IHRyYWluIHRoZSBjbGFzc2lmaWNhdGlvbiB0cmVlIG1vZGVsIHdpdGggdGhlIHRyYWluaW5nIGRhdGEgdXNpbmcgW2BwYXJzbmlwOjpmaXRgXShodHRwczovL3BhcnNuaXAudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2ZpdC5odG1sKQoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpjbGFzc190cmVlX2ZpbmFsX2ZpdCA8LSBwYXJzbmlwOjpmaXQob2JqZWN0ID0gY2xhc3NfdHJlZV9maW5hbCwgZGF0YSA9IENhcnNlYXRzX3RyYWluKQpgYGAKCldlIGNhbiBzZWUgdGhlIHRyZWUgaW4gZ3JlYXRlciBkZXRhaWwgdXNpbmcKW2B0dW5lOjpleHRyYWN0X2ZpdF9lbmdpbmVgXShodHRwczovL3R1bmUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2V4dHJhY3QtdHVuZS5odG1sKQoKYGBge3IsIG1lc3NhZ2U9RkFMU0UsIG1heC5oZWlnaHQ9JzE1MHB4J30KY2xhc3NfdHJlZV9maW5hbF9maXQgJT4lCiAgdHVuZTo6ZXh0cmFjdF9maXRfZW5naW5lKCkKYGBgCgpXZSBjYW4gdmlzdWFsaXNlIHRoZSBhYm92ZSBiZXR0ZXIgd2l0aCBgcnBhcnQucGxvdDo6cnBhcnQucGxvdGAKCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9CmNsYXNzX3RyZWVfZmluYWxfZml0ICU+JQogIHR1bmU6OmV4dHJhY3RfZml0X2VuZ2luZSgpICU+JQogIHJwYXJ0LnBsb3Q6OnJwYXJ0LnBsb3QoKQpgYGAKCiMjIFZhcmlhYmxlIEltcG9ydGFuY2UKCldoYXQgYXJlIHRoZSBtb3N0IGltcG9ydGFudCB2YXJpYWJsZXMgaW4gdGhpcyB0cmVlIGZvciBwcmVkaWN0aW5nIGBTYWxlc2A/CgpVc2luZyB0aGUgYHZpcGAgcGFja2FnZSBhbmQKW2B3b3JrZmxvd3M6OmV4dHJhY3RfZml0X3BhcnNuaXBgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvZXh0cmFjdC13b3JrZmxvdy5odG1sKSwgd2UgaGF2ZQoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgp2aXBfdGFibGUgPC0gY2xhc3NfdHJlZV9maW5hbF9maXQgJT4lCiAgd29ya2Zsb3dzOjpleHRyYWN0X2ZpdF9wYXJzbmlwKCkgJT4lCiAgdmlwOjp2aSgpIAoKdmlwX3RhYmxlICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CmNsYXNzX3RyZWVfZmluYWxfZml0ICU+JQogIHdvcmtmbG93czo6ZXh0cmFjdF9maXRfcGFyc25pcCgpICU+JQogIHZpcDo6dmlwKGdlb20gPSAiY29sIiwgCiAgICAgICAgICAgYWVzdGhldGljcyA9IGxpc3QoZmlsbCA9ICJtaWRuaWdodGJsdWUiLCBhbHBoYSA9IDAuOCkpICsKICBnZ3Bsb3QyOjpzY2FsZV95X2NvbnRpbnVvdXMoZXhwYW5kID0gYygwLCAwKSkKYGBgCgpXZSBjYW4gdXNlIFtgcGFydHRyZWVgXShodHRwczovL2dpdGh1Yi5jb20vZ3JhbnRtY2Rlcm1vdHQvcGFydHRyZWUpIHRvIHVuZGVyc3RhbmQgd2h5IHRoZXNlIHR3byBwYXJhbWV0ZXJzIHdvcmsgc28gd2VsbCBvbiB0aGUgdHJhaW5pbmcgc2V0LgoKSG93ZXZlciB0aGlzIHBhY2thZ2Ugb25seSB3b3JrcyB3aXRoIHR3byBjb250aW51b3VzIHByZWRpY3RvcnMuIEFzIGBTaGVsdmVMb2NgIGlzIGEgY2F0ZWdvcmljYWwgdmFyaWFibGUsIHRoZXJlIGlzIGEgbmVlZCB0byAiY29udmVydCIgdGhlbSB0byBjb250aW51b3VzIGJ5IG1ha2luZyAiQmFkIiBhcyAtMSwgIk1lZGl1bSIgYXMgMCBhbmQgIkdvb2QiIGFzIDEuIAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpDYXJzZWF0c190cmFpbl9tb2RmaWZpZWQgPC0gQ2Fyc2VhdHNfdHJhaW4gJT4lIAogIGRwbHlyOjptdXRhdGUoCiAgICBTaGVsdmVMb2MgPSBkcGx5cjo6Y2FzZV93aGVuKAogICAgICAuZGF0YVtbIlNoZWx2ZUxvYyJdXSA9PSAiQmFkIiB+ICItMSIsCiAgICAgIC5kYXRhW1siU2hlbHZlTG9jIl1dID09ICJNZWRpdW0iIH4gIjAiLAogICAgICAuZGF0YVtbIlNoZWx2ZUxvYyJdXSA9PSJHb29kIiB+ICIxIgogICAgKSkgJT4lIAogIGRwbHlyOjptdXRhdGUoCiAgICBTaGVsdmVMb2MgPSBhcy5udW1lcmljKC5kYXRhW1siU2hlbHZlTG9jIl1dKQogICkKCnBhcnRpYWxfdHJlZSA8LSBwYXJzbmlwOjpkZWNpc2lvbl90cmVlKAogIHRyZWVfZGVwdGggPSAzMCwKICBjb3N0X2NvbXBsZXhpdHkgPSBiZXN0X2Nvc3RfY29tcGxleGl0eSRjb3N0X2NvbXBsZXhpdHkpICU+JQogIHBhcnNuaXA6OnNldF9tb2RlKCJjbGFzc2lmaWNhdGlvbiIpICU+JSAKICBwYXJzbmlwOjpzZXRfZW5naW5lKCJycGFydCIsIG1vZGVsID0gVFJVRSkgJT4lCiAgcGFyc25pcDo6Zml0KEhpZ2ggfiBQcmljZSArIFNoZWx2ZUxvYywgCiAgICAgICAgICAgICAgIGRhdGEgPSBDYXJzZWF0c190cmFpbl9tb2RmaWZpZWQpICU+JQogIHR1bmU6OmV4dHJhY3RfZml0X2VuZ2luZSgpCgpDYXJzZWF0c190cmFpbl9tb2RmaWZpZWQgJT4lCiAgZ2dwbG90Mjo6Z2dwbG90KAogICAgbWFwcGluZyA9IGdncGxvdDI6OmFlcyh4ID0gLmRhdGFbWyJTaGVsdmVMb2MiXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAuZGF0YVtbIlByaWNlIl1dKSkgKwogIHBhcnR0cmVlOjpnZW9tX3BhcnR0cmVlKAogICAgZGF0YSA9IHBhcnRpYWxfdHJlZSwgCiAgICBtYXBwaW5nID0gZ2dwbG90Mjo6YWVzKGZpbGwgPSAuZGF0YVtbIkhpZ2giXV0pLCAKICAgIGFscGhhID0gMC4yKSArCiAgZ2dwbG90Mjo6Z2VvbV9qaXR0ZXIoYWxwaGEgPSAwLjcsIAogICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gMC4wNSwgCiAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gMC4yLCAKICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nID0gZ2dwbG90Mjo6YWVzKGNvbG9yID0gLmRhdGFbWyJIaWdoIl1dKSkKYGBgCgojIyBDbGFzc2lmaWNhdGlvbiB0cmVlIG1vZGVsIG9uIHRlc3QgZGF0YQoKRmluYWxseSwgbGV04oCZcyB0dXJuIHRvIHRoZSB0ZXN0aW5nIGRhdGEuCkZvciBjbGFzc2lmaWNhdGlvbiBtb2RlbHMsIGEKYC5wcmVkX2NsYXNzYCwgY29sdW1uIGFuZCBjbGFzcyBwcm9iYWJpbGl0eSBjb2x1bW5zIG5hbWVkIC5wcmVkX3tsZXZlbH0gYXJlIGFkZGVkIHdoZW4KW2BwYXJzbmlwOjphdWdtZW50YF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9hdWdtZW50Lmh0bWwpCmlzIHVzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCnRlc3RfcmVzdWx0cyA8LSBwYXJzbmlwOjphdWdtZW50KHggPSBjbGFzc190cmVlX2ZpbmFsX2ZpdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19kYXRhID0gQ2Fyc2VhdHNfdGVzdCkKICAKdGVzdF9yZXN1bHRzICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCgpgYGAKCldlIGNhbiB2aWV3IHRoZSBjb25mdXNpb24gbWF0cml4IHVzaW5nIFtgeWFyZHN0aWNrOjpjb25mX21hdGBdKGh0dHBzOi8veWFyZHN0aWNrLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9jb25mX21hdC5odG1sKQoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgp0ZXN0X3Jlc3VsdHMgJT4lCiAgeWFyZHN0aWNrOjpjb25mX21hdCh0cnV0aCA9IC5kYXRhW1siSGlnaCJdXSwgCiAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZSA9IC5kYXRhW1siLnByZWRfY2xhc3MiXV0pICU+JQogIGdncGxvdDI6OmF1dG9wbG90KHR5cGUgPSAiaGVhdG1hcCIpCmBgYAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgp0ZXN0X3Jlc3VsdHMgJT4lCiAgeWFyZHN0aWNrOjpjb25mX21hdCh0cnV0aCA9IC5kYXRhW1siSGlnaCJdXSwgZXN0aW1hdGUgPSAuZGF0YVtbIi5wcmVkX2NsYXNzIl1dKSAlPiUKICBzdW1tYXJ5KCkgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKYGBgCgpvciBieSBgQ29uZnVzaW9uVGFibGVSOjpiaW5hcnlfdmlzdWFsaXNlUmAKCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBmaWcuaGVpZ2h0ID0gOH0KQ29uZnVzaW9uVGFibGVSOjpiaW5hcnlfdmlzdWFsaXNlUih0cmFpbl9sYWJlbHMgPSB0ZXN0X3Jlc3VsdHNbWyJIaWdoIl1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydXRoX2xhYmVscyA9IHRlc3RfcmVzdWx0c1tbIi5wcmVkX2NsYXNzIl1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzX2xhYmVsMSA9ICJZZXMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19sYWJlbDIgPSAiTm8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1YWRyYW50X2NvbDEgPSAiIzI4QUNCNCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1YWRyYW50X2NvbDIgPSAiIzQzOTdEMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90aXRsZSA9ICJIaWdoIENvbmZ1c2lvbiBNYXRyaXgiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0X2NvbD0gImJsYWNrIikKCgpgYGAKCldlIGNhbiB2aWV3IHRoZSBST0MgY3VydmUgdXNpbmcgW2B5YXJkc3RpY2s6OnJvY19jdXJ2ZWBdKGh0dHBzOi8veWFyZHN0aWNrLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9yb2NfY3VydmUuaHRtbCkgCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCnJvY19wbG90X2RhdGEgPC0gdGVzdF9yZXN1bHRzICU+JQogIHlhcmRzdGljazo6cm9jX2N1cnZlKHRydXRoID0gdGVzdF9yZXN1bHRzW1siSGlnaCJdXSwKICAgICAgICAgICAgICAgICAgICAgICAuZGF0YVtbIi5wcmVkX05vIl1dKQoKcm9jX3Bsb3RfZGF0YSAlPiUgCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKYGBgCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCnJvY19wbG90X2RhdGEgJT4lIAogIGdncGxvdDI6OmF1dG9wbG90KCkKCmBgYAoKSGVyZSBpcyBhIGBnZ3Bsb3QyYCB2ZXJzaW9uLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgpyb2NfcGxvdF9kYXRhICU+JSAKICBnZ3Bsb3QyOjpnZ3Bsb3QobWFwcGluZyA9IGdncGxvdDI6OmFlcyh4ID0gMSAtIC5kYXRhW1sic3BlY2lmaWNpdHkiXV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAuZGF0YVtbInNlbnNpdGl2aXR5Il1dKSkgKwogIGdncGxvdDI6Omdlb21fbGluZShzaXplID0gMS41LCBjb2xvciA9ICJtaWRuaWdodGJsdWUiKSArCiAgZ2dwbG90Mjo6Z2VvbV9hYmxpbmUoCiAgICBsdHkgPSAyLCBhbHBoYSA9IDAuNSwKICAgIGNvbG9yID0gImdyYXk1MCIsCiAgICBzaXplID0gMS4yCiAgKSArCiAgZ2dwbG90Mjo6Y29vcmRfZXF1YWwoKQoKYGBgCgoKVG8gdmlldyB0aGUgbWV0cmljcywgd2UgY2FuIGFsc28gdXNlCltgdHVuZTo6bGFzdF9maXRgXShodHRwczovL3R1bmUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2xhc3RfZml0Lmh0bWwpCmFuZApbYHR1bmU6OmNvbGxlY3RfbWV0cmljc2BdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvY29sbGVjdF9wcmVkaWN0aW9ucy5odG1sKS4KCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCm1ldHJpY3NfcmVzdWx0cyA8LSB0dW5lOjpsYXN0X2ZpdChvYmplY3QgPSBjbGFzc190cmVlX2ZpbmFsX2ZpdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdCA9IENhcnNlYXRzX3NwbGl0KSAlPiUKICB0dW5lOjpjb2xsZWN0X21ldHJpY3MoKQogIAptZXRyaWNzX3Jlc3VsdHMgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKICAKYGBgCgojIEZpdHRpbmcgUmVncmVzc2lvbiBUcmVlcwoKYGBge3IsIGVjaG89RkFMU0V9CnNldC5zZWVkKDEyMzQpCmBgYAoKSW4gdGhlIFtgQm9zdG9uYF0oaHR0cHM6Ly93d3cuY3MudG9yb250by5lZHUvfmRlbHZlL2RhdGEvYm9zdG9uL2Jvc3RvbkRldGFpbC5odG1sKSBkYXRhIHNldCwgd2Ugd2FudCB0byBwcmVkaWN0IGBtZWR2YCwgdGhlIG1lZGlhbiB2YWx1ZSBvZiBvd25lci1vY2N1cGllZCBob21lcyBpbiAkMTAwMCdzLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpCb3N0b24gPC0gZHBseXI6OmFzX3RpYmJsZShJU0xSMjo6Qm9zdG9uKQoKQm9zdG9uICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUsCiAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyYWJsZSA9IFRSVUUpCmBgYAoKIyMgQ3JlYXRlIHRoZSByZXNhbXBsZSBvYmplY3QKCkZpcnN0LCB3ZSBzcGxpdCB0aGUgc2FtcGxlcyBpbnRvIGEgdHJhaW5pbmcgc2V0IGFuZCBhIHRlc3Qgc2V0LiBGcm9tIHRoZSB0cmFpbmluZyBzZXQsIHdlIGNyZWF0ZSBhIDEwLWZvbGQgY3Jvc3MtdmFsaWRhdGlvbiBkYXRhIHNldCBmcm9tIHRoZSB0cmFpbmluZyBzZXQuCgpUaGlzIGlzIGRvbmUgd2l0aCBbYHJzYW1wbGU6OmluaXRpYWxfc3BsaXRgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCksCltgcnNhbXBsZTo6dHJhaW5pbmdgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCksCltgcnNhbXBsZTo6dGVzdGluZ2BdKGh0dHBzOi8vcnNhbXBsZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvaW5pdGlhbF9zcGxpdC5odG1sKQphbmQKW2Byc2FtcGxlOjp2Zm9sZF9jdmBdKGh0dHBzOi8vcnNhbXBsZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvdmZvbGRfY3YuaHRtbCkuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCkJvc3Rvbl9zcGxpdCA8LSByc2FtcGxlOjppbml0aWFsX3NwbGl0KEJvc3RvbikKCkJvc3Rvbl90cmFpbiA8LSByc2FtcGxlOjp0cmFpbmluZyhCb3N0b25fc3BsaXQpCkJvc3Rvbl90ZXN0IDwtIHJzYW1wbGU6OnRlc3RpbmcoQm9zdG9uX3NwbGl0KQoKQm9zdG9uX2ZvbGQgPC0gcnNhbXBsZTo6dmZvbGRfY3YoQm9zdG9uX3RyYWluLCB2ID0gMTApCgoKYGBgCgojIyBDcmVhdGUgdGhlIHByZXByb2Nlc3NvcgoKV2UgY3JlYXRlIGEgcmVjaXBlIHdpdGggW2ByZWNpcGVzOjpyZWNpcGVgXShodHRwczovL3JlY2lwZXMudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3JlY2lwZS5odG1sKS4KTm8gb3RoZXIgcHJlcHJvY2Vzc2luZyBzdGVwIGlzIGRvbmUuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCnJlZ190cmVlX3JlY2lwZSA8LSAKICByZWNpcGVzOjpyZWNpcGUoZm9ybXVsYSA9IG1lZHYgfiAuLCBkYXRhID0gQm9zdG9uX3RyYWluKQoKYGBgCgojIyBTcGVjaWZ5IHRoZSBtb2RlbAoKVXNlCltgcGFyc25pcDo6ZGVjaXNpb25fdHJlZWBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvZGVjaXNpb25fdHJlZS5odG1sKSwKW2BwYXJzbmlwOjpzZXRfbW9kZWBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvc2V0X2FyZ3MuaHRtbCkKYW5kCltgcGFyc25pcDo6c2V0X2VuZ2luZWBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvc2V0X2VuZ2luZS5odG1sKQp0byBjcmVhdGUgdGhlIG1vZGVsLgoKVGhlIGNvc3QgY29tcGxleGl0eSBpcyB0dW5lZCB1c2luZwpbYHR1bmU6OnR1bmVgXShodHRwczovL2hhcmRoYXQudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3R1bmUuaHRtbCkKCkFuIGVuZ2luZSBzcGVjaWZpYyBwYXJhbWV0ZXIgYG1vZGVsID0gVFJVRWAgaXMgc2V0IGZvciBycGFydCB0byBwcmV2ZW50IHRoaXMgd2FybmluZyBtZXNzYWdlIGZyb20gY29taW5nIHVwIGxhdGVyIHdoZW4gYHJwYXJ0LnBsb3Q6OnJwYXJ0LnBsb3RgIGlzIHVzZWQgbGF0ZXIuCgpgYGB7cn0KIz4gV2FybmluZzogQ2Fubm90IHJldHJpZXZlIHRoZSBkYXRhIHVzZWQgdG8gYnVpbGQgdGhlIG1vZGVsIChzbyBjYW5ub3QgZGV0ZXJtaW5lIHJvdW5kaW50IGFuZCBpcy5iaW5hcnkgZm9yIHRoZSB2YXJpYWJsZXMpLgojPiBUbyBzaWxlbmNlIHRoaXMgd2FybmluZzoKIz4gICAgIENhbGwgcnBhcnQucGxvdCB3aXRoIHJvdW5kaW50PUZBTFNFLAojPiAgICAgb3IgcmVidWlsZCB0aGUgcnBhcnQgbW9kZWwgd2l0aCBtb2RlbD1UUlVFLgpgYGAKCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKcmVnX3RyZWVfc3BlYyA8LSBwYXJzbmlwOjpkZWNpc2lvbl90cmVlKAogICN0cmVlX2RlcHRoID0gNCwKICBjb3N0X2NvbXBsZXhpdHkgPSB0dW5lOjp0dW5lKCkpICU+JQogIHBhcnNuaXA6OnNldF9tb2RlKCJyZWdyZXNzaW9uIikgJT4lIAogIHBhcnNuaXA6OnNldF9lbmdpbmUoInJwYXJ0IiwgbW9kZWwgPSBUUlVFKQoKcmVnX3RyZWVfc3BlYyAlPiUKICBwYXJzbmlwOjp0cmFuc2xhdGUoKQpgYGAKCiMjIENyZWF0ZSB0aGUgd29ya2Zsb3cKCltgd29ya2Zsb3dzOjp3b3JrZmxvd2BdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS93b3JrZmxvdy5odG1sKSwKW2B3b3JrZmxvd3M6OmFkZF9yZWNpcGVgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYWRkX3JlY2lwZS5odG1sKQphbmQKW2B3b3JrZmxvd3M6OmFkZF9tb2RlbGBdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9hZGRfbW9kZWwuaHRtbCkKYXJlIHVzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKcmVnX3RyZWVfd29ya2Zsb3cgPC0gIHdvcmtmbG93czo6d29ya2Zsb3coKSAlPiUgCiAgd29ya2Zsb3dzOjphZGRfcmVjaXBlKHJlZ190cmVlX3JlY2lwZSkgJT4lIAogIHdvcmtmbG93czo6YWRkX21vZGVsKHJlZ190cmVlX3NwZWMpCgpyZWdfdHJlZV93b3JrZmxvdyAKYGBgCgojIyBDcmVhdGUgdGhlIGNvc3QgY29tcGxleGl0eSBncmlkCgpBIGNvc3QgY29tcGxleGl0eSBncmlkIG9mICQxMCQgbnVtYmVycyBmcm9tICQwLjAwMSQgKCQxMF57LTR9JCkgdG8KJDEwJCAoJDEwXjEkKSBpcyBjcmVhdGVkLgoKUmVndWxhciBncmlkIGlzIGNyZWF0ZWQgdXNpbmcKW2BkaWFsczo6Z3JpZF9yZWd1bGFyYF0oaHR0cHM6Ly9kaWFscy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvZ3JpZF9yZWd1bGFyLmh0bWwpLApbYGRpYWxzOjpjb3N0X2NvbXBsZXhpdHlgXShodHRwczovL2RpYWxzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS90cmVlcy5odG1sKQphbmQKW2BzY2FsZXM6OmxvZzEwX3RyYW5zYF0oaHR0cHM6Ly9zY2FsZXMuci1saWIub3JnL3JlZmVyZW5jZS9sb2dfdHJhbnMuaHRtbCkKCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKIyBDcmVhdGUgYSByYW5nZSBmcm9tIDEwCmNvc3RfY29tcGxleGl0eV9ncmlkIDwtIAogIGRpYWxzOjpncmlkX3JlZ3VsYXIoCiAgICB4ID0gZGlhbHM6OmNvc3RfY29tcGxleGl0eShyYW5nZSA9IGMoLTQsIDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnMgPSBzY2FsZXM6OmxvZzEwX3RyYW5zKCkpLAogICAgbGV2ZWxzID0gMTAKICApCgpjb3N0X2NvbXBsZXhpdHlfZ3JpZCAgJT4lIAogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKIyMgUmVncmVzc2lvbiB0cmVlIG1vZGVsIGZpdHRpbmcgb24gY3Jvc3MgdmFsaWRhdGVkIGRhdGEKCk5vdyB3ZSBoYXZlIGV2ZXJ5dGhpbmcgd2UgbmVlZCBhbmQgd2UgY2FuIGZpdCBhbGwgdGhlIG1vZGVscyBvbiB0aGUKY3Jvc3MgdmFsaWRhdGVkIGRhdGEgd2l0aApbYHR1bmU6OnR1bmVfZ3JpZGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvdHVuZV9ncmlkLmh0bWwpLgpOb3RlIHRoYXQgdGhpcyBwcm9jZXNzIG1heSB0YWtlIHNvbWUgdGltZS4KCldlIHVzZSBbYHlhcmRzdGljazo6bWV0cmljX3NldGBdKGh0dHBzOi8veWFyZHN0aWNrLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9tZXRyaWNfc2V0Lmh0bWwpLCB0byBjaG9vc2UgYSBzZXQgb2YgbWV0cmljcyB0byB1c2VkIHRvIGV2YWx1YXRlIHRoZSBtb2RlbC4gSW4gdGhpcyBleGFtcGxlLCBbYHlhcmRzdGljazo6cm1zZWBdKGh0dHBzOi8veWFyZHN0aWNrLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9ybXNlLmh0bWwpIGFuZApbYHlhcmRzdGljazo6cnNxYF0oaHR0cHM6Ly95YXJkc3RpY2sudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3JzcS5odG1sKSBhcmUgdXNlZC4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQpkb1BhcmFsbGVsOjpyZWdpc3RlckRvUGFyYWxsZWwoKQpmb3JlYWNoOjpnZXREb1BhcldvcmtlcnMoKQpgYGAKCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9CnR1bmVfcmVzIDwtIHR1bmU6OnR1bmVfZ3JpZCgKICBvYmplY3QgPSByZWdfdHJlZV93b3JrZmxvdywKICByZXNhbXBsZXMgPSBCb3N0b25fZm9sZCwgCiAgZ3JpZCA9IGNvc3RfY29tcGxleGl0eV9ncmlkLAogICNtZXRyaWNzID0geWFyZHN0aWNrOjptZXRyaWNfc2V0KHlhcmRzdGljazo6cm1zZSwKICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXJkc3RpY2s6OnJzcSkKKQoKdHVuZV9yZXMKYGBgCgpIZXJlIHdlIHNlZSB0aGF0IHRoZSBhbW91bnQgb2YgY29zdCBjb21wbGV4aXR5IGFmZmVjdHMgdGhlIHBlcmZvcm1hbmNlCm1ldHJpY3MgZGlmZmVyZW50bHkgdXNpbmcKW2B0dW5lOjphdXRvcGxvdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXV0b3Bsb3QudHVuZV9yZXN1bHRzLmh0bWwpLgpEbyBub3RlIHRoYXQgdXNpbmcgYSBkaWZmZXJlbnQgc2VlZCB3aWxsIGdpdmUgYSBkaWZmZXJlbnQgcGxvdAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CiMgTm90ZSB0aGF0IGEgZGlmZmVyZW50IHNlZWQgd2lsbCBnaXZlIGRpZmZlcmVudCBwbG90cwp0dW5lOjphdXRvcGxvdCh0dW5lX3JlcykKYGBgCgpXZSBjYW4gYWxzbyBzZWUgdGhlIHJhdyBtZXRyaWNzIHRoYXQgY3JlYXRlZCB0aGlzIGNoYXJ0IGJ5IGNhbGxpbmcKW2B0dW5lOjpjb2xsZWN0X21ldHJpY3MoKWBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvY29sbGVjdF9wcmVkaWN0aW9ucy5odG1sKS4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9Cgp0dW5lOjpjb2xsZWN0X21ldHJpY3ModHVuZV9yZXMpICU+JSAKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQpgYGAKCkhlcmUgaXMgdGhlIGBnZ3Bsb3RgIHdheSBzaG91bGQKW2B0dW5lOjphdXRvcGxvdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXV0b3Bsb3QudHVuZV9yZXN1bHRzLmh0bWwpCmZhaWxzCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKdHVuZV9yZXMgJT4lCiAgdHVuZTo6Y29sbGVjdF9tZXRyaWNzKCkgJT4lCiAgZ2dwbG90Mjo6Z2dwbG90KG1hcHBpbmcgPSBnZ3Bsb3QyOjphZXMoeCA9IC5kYXRhW1siY29zdF9jb21wbGV4aXR5Il1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAuZGF0YVtbIm1lYW4iXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3VyID0gLmRhdGFbWyIubWV0cmljIl1dKSkgKwogIGdncGxvdDI6Omdlb21fZXJyb3JiYXIobWFwcGluZyA9IGdncGxvdDI6OmFlcyh5bWluID0gLmRhdGFbWyJtZWFuIl1dIC0gLmRhdGFbWyJzdGRfZXJyIl1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5bWF4ID0gLmRhdGFbWyJtZWFuIl1dICsgLmRhdGFbWyJzdGRfZXJyIl1dKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhID0gMC41KSArCiAgZ2dwbG90Mjo6Z2VvbV9saW5lKHNpemUgPSAxLjUpICsKICBnZ3Bsb3QyOjpmYWNldF93cmFwKGZhY2V0cyA9IGdncGxvdDI6OnZhcnMoLmRhdGFbWyIubWV0cmljIl1dKSwgCiAgICAgICAgICAgICAgICAgICAgICBzY2FsZXMgPSAiZnJlZSIsIAogICAgICAgICAgICAgICAgICAgICAgbnJvdyA9IDIpICsKICBnZ3Bsb3QyOjpzY2FsZV94X2xvZzEwKCkgKwogIGdncGxvdDI6OnRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJub25lIikKYGBgCgpVc2UKW2B0dW5lOjpzaG93X2Jlc3RgXShodHRwczovL3R1bmUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3Nob3dfYmVzdC5odG1sKQp0byBzZWUgdGhlIHRvcCBmZXcgdmFsdWVzIGZvciBhIGdpdmVuIG1ldHJpYy4KClRoZSAiYmVzdCIgdmFsdWVzIGNhbiBiZSBzZWxlY3RlZCB1c2luZwpbYHR1bmU6OnNlbGVjdF9iZXN0YF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zaG93X2Jlc3QuaHRtbCksCnRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgeW91IHRvIHNwZWNpZnkgYSBtZXRyaWMgdGhhdCBpdCBzaG91bGQgc2VsZWN0CmFnYWluc3QuIFRoZSBjb3N0IGNvbXBsZXhpdHkgdmFsdWUgaXMgMC4wMDEyOSBmb3IgbWV0cmljIGBybXNlYCBzaW5jZSBpdApnaXZlcyB0aGUgbG93ZXN0IHZhbHVlLiBEbyBub3RlIHRoYXQgdXNpbmcgYSBkaWZmZXJlbnQgc2VlZCB3aWxsIGdpdmUgYQpkaWZmZXJlbnQgYmVzdCBjb3N0IGNvbXBsZXhpdHkgdmFsdWUuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKdG9wX2Nvc3RfY29tcGxleGl0eSA8LSB0dW5lOjpzaG93X2Jlc3QodHVuZV9yZXMsIG1ldHJpYyA9IGMoInJtc2UiKSwgbiA9IDUpCnRvcF9jb3N0X2NvbXBsZXhpdHkgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKCmJlc3RfY29zdF9jb21wbGV4aXR5IDwtIHR1bmU6OnNlbGVjdF9iZXN0KHR1bmVfcmVzLCBtZXRyaWMgPSAicm1zZSIpCmJlc3RfY29zdF9jb21wbGV4aXR5CgpgYGAKCiMjIFJlZ3Jlc3Npb24gdHJlZSBtb2RlbCB3aXRoIG9wdGltaXNlZCBjb3N0IGNvbXBsZXhpdHkgdmFsdWUKCldlIGNyZWF0ZSB0aGUgcmVncmVzc2lvbiB0cmVlIHdvcmtmbG93IHdpdGggdGhlIGJlc3QgY29zdCBjb21wbGV4aXR5IHNjb3JlCnVzaW5nCltgdHVuZTo6ZmluYWxpemVfd29ya2Zsb3dgXShodHRwczovL3R1bmUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2ZpbmFsaXplX21vZGVsLmh0bWwpLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0UsIG1heC5oZWlnaHQ9JzE1MHB4J30KCnJlZ190cmVlX2ZpbmFsIDwtIHR1bmU6OmZpbmFsaXplX3dvcmtmbG93KAogIHggPSByZWdfdHJlZV93b3JrZmxvdywgCiAgcGFyYW1ldGVycyA9IGJlc3RfY29zdF9jb21wbGV4aXR5KQoKcmVnX3RyZWVfZmluYWwKYGBgCgpXZSBub3cgdHJhaW4gdGhlIHJlZ3Jlc3Npb24gdHJlZSBtb2RlbCB3aXRoIHRoZSB0cmFpbmluZyBkYXRhIHVzaW5nIFtgcGFyc25pcDo6Zml0YF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9maXQuaHRtbCkKCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKcmVnX3RyZWVfZmluYWxfZml0IDwtIHBhcnNuaXA6OmZpdChvYmplY3QgPSByZWdfdHJlZV9maW5hbCwgZGF0YSA9IEJvc3Rvbl90cmFpbikKYGBgCgpXZSBjYW4gc2VlIHRoZSB0cmVlIGluIGdyZWF0ZXIgZGV0YWlsIHVzaW5nCltgdHVuZTo6ZXh0cmFjdF9maXRfZW5naW5lYF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9leHRyYWN0LXR1bmUuaHRtbCkKCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9CnJlZ190cmVlX2ZpbmFsX2ZpdCAlPiUKICB0dW5lOjpleHRyYWN0X2ZpdF9lbmdpbmUoKQpgYGAKCldlIGNhbiB2aXN1YWxpc2UgdGhlIGFib3ZlIGJldHRlciB3aXRoIGBycGFydC5wbG90OjpycGFydC5wbG90YAoKYGBge3IsIG1lc3NhZ2U9RkFMU0UsIG1heC5oZWlnaHQ9JzE1MHB4J30KcmVnX3RyZWVfZmluYWxfZml0ICU+JQogIHR1bmU6OmV4dHJhY3RfZml0X2VuZ2luZSgpICU+JQogIHJwYXJ0LnBsb3Q6OnJwYXJ0LnBsb3QoKQpgYGAKCiMjIFZhcmlhYmxlIEltcG9ydGFuY2UKCldoYXQgYXJlIHRoZSBtb3N0IGltcG9ydGFudCB2YXJpYWJsZXMgaW4gdGhpcyB0cmVlIGZvciBwcmVkaWN0aW5nIGBtZWR2YD8KClVzaW5nIHRoZSBgdmlwYCBwYWNrYWdlIGFuZApbYHdvcmtmbG93czo6ZXh0cmFjdF9maXRfcGFyc25pcGBdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9leHRyYWN0LXdvcmtmbG93Lmh0bWwpLCB3ZSBoYXZlCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCnZpcF90YWJsZSA8LSByZWdfdHJlZV9maW5hbF9maXQgJT4lCiAgd29ya2Zsb3dzOjpleHRyYWN0X2ZpdF9wYXJzbmlwKCkgJT4lCiAgdmlwOjp2aSgpIAoKdmlwX3RhYmxlICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CnJlZ190cmVlX2ZpbmFsX2ZpdCAlPiUKICB3b3JrZmxvd3M6OmV4dHJhY3RfZml0X3BhcnNuaXAoKSAlPiUKICB2aXA6OnZpcChnZW9tID0gImNvbCIsIAogICAgICAgICAgIGFlc3RoZXRpY3MgPSBsaXN0KGZpbGwgPSAibWlkbmlnaHRibHVlIiwgYWxwaGEgPSAwLjgpKSArCiAgZ2dwbG90Mjo6c2NhbGVfeV9jb250aW51b3VzKGV4cGFuZCA9IGMoMCwgMCkpCmBgYAoKV2UgY2FuIHVzZSBbYHBhcnR0cmVlYF0oaHR0cHM6Ly9naXRodWIuY29tL2dyYW50bWNkZXJtb3R0L3BhcnR0cmVlKSB0byB1bmRlcnN0YW5kIHdoeSB0aGVzZSB0d28gcGFyYW1ldGVycyB3b3JrIHNvIHdlbGwgb24gdGhlIHRyYWluaW5nIHNldC4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKcGFydGlhbF90cmVlIDwtIHBhcnNuaXA6OmRlY2lzaW9uX3RyZWUoCiAgY29zdF9jb21wbGV4aXR5ID0gYmVzdF9jb3N0X2NvbXBsZXhpdHkkY29zdF9jb21wbGV4aXR5KSAlPiUKICBwYXJzbmlwOjpzZXRfbW9kZSgicmVncmVzc2lvbiIpICU+JSAKICBwYXJzbmlwOjpzZXRfZW5naW5lKCJycGFydCIsIG1vZGVsID0gVFJVRSkgJT4lCiAgcGFyc25pcDo6Zml0KG1lZHYgfiBybSArIGxzdGF0LCAKICAgICAgICAgICAgICAgZGF0YSA9IEJvc3Rvbl90cmFpbikgJT4lCiAgdHVuZTo6ZXh0cmFjdF9maXRfZW5naW5lKCkKCkJvc3Rvbl90cmFpbiAlPiUKICBnZ3Bsb3QyOjpnZ3Bsb3QoCiAgICBtYXBwaW5nID0gZ2dwbG90Mjo6YWVzKHggPSAuZGF0YVtbInJtIl1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gLmRhdGFbWyJsc3RhdCJdXSkpICsKICBwYXJ0dHJlZTo6Z2VvbV9wYXJ0dHJlZSgKICAgIGRhdGEgPSBwYXJ0aWFsX3RyZWUsIAogICAgbWFwcGluZyA9IGdncGxvdDI6OmFlcyhmaWxsID0gLmRhdGFbWyJtZWR2Il1dKSwgCiAgICBhbHBoYSA9IDAuMikgKwogIGdncGxvdDI6Omdlb21faml0dGVyKGFscGhhID0gMC43LAogICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gMC4wNSwKICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSAwLjIsCiAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZyA9IGdncGxvdDI6OmFlcyhjb2xvciA9IC5kYXRhW1sibWVkdiJdXSkpICsKICBnZ3Bsb3QyOjpzY2FsZV9jb2xvdXJfdmlyaWRpc19jKGFlc3RoZXRpY3MgPSBjKCJjb2xvciIsICJmaWxsIikpCmBgYAoKIyMgUmVncmVzc2lvbiB0cmVlIG1vZGVsIG9uIHRlc3QgZGF0YQoKRmluYWxseSwgbGV04oCZcyB0dXJuIHRvIHRoZSB0ZXN0aW5nIGRhdGEuCkZvciByZWdyZXNzaW9uIG1vZGVscywgYQpgLnByZWRgLCBjb2x1bW4gaXMgYWRkZWQgd2hlbgpbYHBhcnNuaXA6OmF1Z21lbnRgXShodHRwczovL3BhcnNuaXAudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2F1Z21lbnQuaHRtbCkKaXMgdXNlZC4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKdGVzdF9yZXN1bHRzIDwtIHBhcnNuaXA6OmF1Z21lbnQoeCA9IHJlZ190cmVlX2ZpbmFsX2ZpdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19kYXRhID0gQm9zdG9uX3Rlc3QpCiAgCnRlc3RfcmVzdWx0cyAlPiUKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQoKYGBgCgpXZSBjaGVjayBob3cgd2VsbCB0aGUgYC5wcmVkYCBjb2x1bW4gbWF0Y2hlcyB0aGUgYG1lZHZgIHVzaW5nCltgeWFyZHN0aWNrOjpybXNlYF0oaHR0cHM6Ly95YXJkc3RpY2sudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3Jtc2UuaHRtbCkuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KdGVzdF9yZXN1bHRzICU+JQogIHlhcmRzdGljazo6cm1zZSh0cnV0aCA9IC5kYXRhW1sibWVkdiJdXSwgZXN0aW1hdGUgPSAuZGF0YVtbIi5wcmVkIl1dKSAlPiUKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQpgYGAKCkFsdGVybmF0aXZlbHksIHdlIGNhbiB1c2UKW2B0dW5lOjpsYXN0X2ZpdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvbGFzdF9maXQuaHRtbCkKYW5kCltgdHVuZTo6Y29sbGVjdF9tZXRyaWNzYF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9jb2xsZWN0X3ByZWRpY3Rpb25zLmh0bWwpLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgp0ZXN0X3JzIDwtIHR1bmU6Omxhc3RfZml0KG9iamVjdCA9IHJlZ190cmVlX2ZpbmFsX2ZpdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXQgPSBCb3N0b25fc3BsaXQpCiAgCnRlc3RfcnMgJT4lCiAgdHVuZTo6Y29sbGVjdF9tZXRyaWNzKCkgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKICAKYGBgCgpVc2UgW2B0dW5lOjpjb2xsZWN0X3ByZWRpY3Rpb25zYF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9jb2xsZWN0X3ByZWRpY3Rpb25zLmh0bWwpLCB0byBzZWUgb25seSB0aGUgYWN0dWFsIGFuZCBwcmVkaWN0ZWQgdmFsdWVzIG9mIHRoZSB0ZXN0IGRhdGEuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KdGVzdF9ycyAlPiUKICB0dW5lOjpjb2xsZWN0X3ByZWRpY3Rpb25zKCkgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKYGBgCgpMZXQgdXMgdGFrZSBhIGNsb3NlciBsb29rIGF0IHRoZSBwcmVkaWN0ZWQgYW5kIGFjdHVhbCByZXNwb25zZSBhcyBhIHNjYXR0ZXIgcGxvdC4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQp0ZXN0X3JzICU+JQogIHR1bmU6OmNvbGxlY3RfcHJlZGljdGlvbnMoKSAlPiUKICBnZ3Bsb3QyOjpnZ3Bsb3QobWFwcGluZyA9IGdncGxvdDI6OmFlcyh4ID0gLmRhdGFbWyJtZWR2Il1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAuZGF0YVtbIi5wcmVkIl1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICApICsKICBnZ3Bsb3QyOjpnZW9tX2FibGluZShzbG9wZSA9IDEsIGx0eSA9IDIsIGNvbG9yID0gImdyYXk1MCIsIGFscGhhID0gMC41KSArCiAgZ2dwbG90Mjo6Z2VvbV9wb2ludChhbHBoYSA9IDAuNiwgY29sb3IgPSAibWlkbmlnaHRibHVlIikgKwogIGdncGxvdDI6OmNvb3JkX2ZpeGVkKCkKYGBgCgojIEJhZ2dpbmcKCkhlcmUgd2UgYXBwbHkgYmFnZ2luZyB0byB0aGUgYEJvc3RvbmAgZGF0YSwgdXNpbmcgdGhlIGByYW5kb21Gb3Jlc3RgIHBhY2thZ2UgaW4gUgoKYGBge3IsIGVjaG89RkFMU0V9CnNldC5zZWVkKDEpCmBgYAoKIyMgQ3JlYXRlIHRoZSByZXNhbXBsZSBvYmplY3QKCkZpcnN0LCB3ZSBzcGxpdCB0aGUgc2FtcGxlcyBpbnRvIGEgdHJhaW5pbmcgc2V0IGFuZCBhIHRlc3Qgc2V0LiBGcm9tIHRoZSB0cmFpbmluZyBzZXQsIHdlIGNyZWF0ZSBhIDEwLWZvbGQgY3Jvc3MtdmFsaWRhdGlvbiBkYXRhIHNldCBmcm9tIHRoZSB0cmFpbmluZyBzZXQuCgpUaGlzIGlzIGRvbmUgd2l0aCBbYHJzYW1wbGU6OmluaXRpYWxfc3BsaXRgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCksCltgcnNhbXBsZTo6dHJhaW5pbmdgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCkgYW5kCltgcnNhbXBsZTo6dGVzdGluZ2BdKGh0dHBzOi8vcnNhbXBsZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvaW5pdGlhbF9zcGxpdC5odG1sKQoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpCb3N0b25fc3BsaXQgPC0gcnNhbXBsZTo6aW5pdGlhbF9zcGxpdChCb3N0b24pCgpCb3N0b25fdHJhaW4gPC0gcnNhbXBsZTo6dHJhaW5pbmcoQm9zdG9uX3NwbGl0KQpCb3N0b25fdGVzdCA8LSByc2FtcGxlOjp0ZXN0aW5nKEJvc3Rvbl9zcGxpdCkKCmBgYAoKIyMgQ3JlYXRlIHRoZSBwcmVwcm9jZXNzb3IKCldlIGNyZWF0ZSBhIHJlY2lwZSB3aXRoIFtgcmVjaXBlczo6cmVjaXBlYF0oaHR0cHM6Ly9yZWNpcGVzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9yZWNpcGUuaHRtbCkuCk5vIG90aGVyIHByZXByb2Nlc3Npbmcgc3RlcCBpcyBkb25lLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpiYWdnaW5nX3JlY2lwZSA8LSAKICByZWNpcGVzOjpyZWNpcGUoZm9ybXVsYSA9IG1lZHYgfiAuLCBkYXRhID0gQm9zdG9uX3RyYWluKQoKYGBgCgojIyBTcGVjaWZ5IHRoZSBtb2RlbAoKVXNlCltgcGFyc25pcDo6cmFuZF9mb3Jlc3RgXShodHRwczovL3BhcnNuaXAudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3JhbmRfZm9yZXN0Lmh0bWwpLApbYHBhcnNuaXA6OnNldF9tb2RlYF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zZXRfYXJncy5odG1sKQphbmQKW2BwYXJzbmlwOjpzZXRfZW5naW5lYF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zZXRfZW5naW5lLmh0bWwpCnRvIGNyZWF0ZSB0aGUgbW9kZWwuCgpgbXRyeWAgaXMgdGhlIG51bWJlciBvZiBwcmVkaWN0b3JzIHRoYXQgd2lsbCBiZSByYW5kb21seSBzYW1wbGVkIGF0IGVhY2ggc3BsaXQgd2hlbiBjcmVhdGluZyB0aGUgdHJlZSBtb2RlbHMuIEZvciBiYWdnaW5nLCB0aGF0IG51bWJlciBpcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHByZWRpY3RvciBtYXRyaXggZGVub3RlZCBieSBbYHBhcnNuaXA6Oi5jb2xzYF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9kZXNjcmlwdG9ycy5odG1sKQoKYGltcG9ydGFuY2VgIHNldCB0byBUUlVFIGVuc3VyZXMgdGhlIGltcG9ydGFuY2Ugb2YgcHJlZGljdG9ycyBhcmUgYXNzZXNzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCmJhZ2dpbmdfc3BlYyA8LSBwYXJzbmlwOjpyYW5kX2ZvcmVzdChtdHJ5ID0gLmNvbHMoKSkgJT4lCiAgcGFyc25pcDo6c2V0X2VuZ2luZSgicmFuZG9tRm9yZXN0IiwgaW1wb3J0YW5jZSA9IFRSVUUpICU+JQogIHBhcnNuaXA6OnNldF9tb2RlKCJyZWdyZXNzaW9uIikKCmJhZ2dpbmdfc3BlYyAlPiUKICBwYXJzbmlwOjp0cmFuc2xhdGUoKQpgYGAKCiMjIENyZWF0ZSB0aGUgd29ya2Zsb3cKCltgd29ya2Zsb3dzOjp3b3JrZmxvd2BdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS93b3JrZmxvdy5odG1sKSwKW2B3b3JrZmxvd3M6OmFkZF9yZWNpcGVgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYWRkX3JlY2lwZS5odG1sKQphbmQKW2B3b3JrZmxvd3M6OmFkZF9tb2RlbGBdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9hZGRfbW9kZWwuaHRtbCkKYXJlIHVzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKYmFnZ2luZ193b3JrZmxvdyA8LSAgd29ya2Zsb3dzOjp3b3JrZmxvdygpICU+JSAKICB3b3JrZmxvd3M6OmFkZF9yZWNpcGUoYmFnZ2luZ19yZWNpcGUpICU+JSAKICB3b3JrZmxvd3M6OmFkZF9tb2RlbChiYWdnaW5nX3NwZWMpCgpiYWdnaW5nX3dvcmtmbG93IApgYGAKCiMjIEJhZ2dpbmcgbW9kZWwgb24gdHJhaW5pbmcgZGF0YQoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpiYWdnaW5nX2ZpdCA8LSBwYXJzbmlwOjpmaXQob2JqZWN0ID0gYmFnZ2luZ193b3JrZmxvdywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gQm9zdG9uX3RyYWluKQpgYGAKCiMjIFZhcmlhYmxlIEltcG9ydGFuY2UKCldoYXQgYXJlIHRoZSBtb3N0IGltcG9ydGFudCB2YXJpYWJsZXMgaW4gdGhpcyB0cmVlIGZvciBwcmVkaWN0aW5nIGBtZWR2YD8KClVzaW5nIHRoZSBgdmlwYCBwYWNrYWdlIGFuZApbYHdvcmtmbG93czo6ZXh0cmFjdF9maXRfcGFyc25pcGBdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9leHRyYWN0LXdvcmtmbG93Lmh0bWwpLCB3ZSBoYXZlCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCnZpcF90YWJsZSA8LSBiYWdnaW5nX2ZpdCAlPiUKICB3b3JrZmxvd3M6OmV4dHJhY3RfZml0X3BhcnNuaXAoKSAlPiUKICB2aXA6OnZpKCkgCgp2aXBfdGFibGUgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKYGBgCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KYmFnZ2luZ19maXQgJT4lCiAgd29ya2Zsb3dzOjpleHRyYWN0X2ZpdF9wYXJzbmlwKCkgJT4lCiAgdmlwOjp2aXAoZ2VvbSA9ICJjb2wiLCAKICAgICAgICAgICBhZXN0aGV0aWNzID0gbGlzdChmaWxsID0gIm1pZG5pZ2h0Ymx1ZSIsIGFscGhhID0gMC44KSkgKwogIGdncGxvdDI6OnNjYWxlX3lfY29udGludW91cyhleHBhbmQgPSBjKDAsIDApKQpgYGAKCiMjIEJhZ2dpbmcgbW9kZWwgb24gdGVzdCBkYXRhCgpGaW5hbGx5LCBsZXTigJlzIHR1cm4gdG8gdGhlIHRlc3RpbmcgZGF0YS4KRm9yIHJlZ3Jlc3Npb24gbW9kZWxzLCBhCmAucHJlZGAsIGNvbHVtbiBpcyBhZGRlZCB3aGVuCltgcGFyc25pcDo6YXVnbWVudGBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXVnbWVudC5odG1sKQppcyB1c2VkLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgp0ZXN0X3Jlc3VsdHMgPC0gcGFyc25pcDo6YXVnbWVudCh4ID0gYmFnZ2luZ19maXQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdfZGF0YSA9IEJvc3Rvbl90ZXN0KQogIAp0ZXN0X3Jlc3VsdHMgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKCmBgYAoKV2UgY2hlY2sgaG93IHdlbGwgdGhlIGAucHJlZGAgY29sdW1uIG1hdGNoZXMgdGhlIGBtZWR2YCB1c2luZwpbYHlhcmRzdGljazo6cm1zZWBdKGh0dHBzOi8veWFyZHN0aWNrLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9ybXNlLmh0bWwpLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CnRlc3RfcmVzdWx0cyAlPiUKICB5YXJkc3RpY2s6OnJtc2UodHJ1dGggPSAuZGF0YVtbIm1lZHYiXV0sIGVzdGltYXRlID0gLmRhdGFbWyIucHJlZCJdXSkgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKYGBgCgpMZXQgdXMgdGFrZSBhIGNsb3NlciBsb29rIGF0IHRoZSBwcmVkaWN0ZWQgYW5kIGFjdHVhbCByZXNwb25zZSBhcyBhIHNjYXR0ZXIgcGxvdC4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQp0ZXN0X3Jlc3VsdHMgJT4lCiAgZ2dwbG90Mjo6Z2dwbG90KG1hcHBpbmcgPSBnZ3Bsb3QyOjphZXMoeCA9IC5kYXRhW1sibWVkdiJdXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gLmRhdGFbWyIucHJlZCJdXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgKSArCiAgZ2dwbG90Mjo6Z2VvbV9hYmxpbmUoc2xvcGUgPSAxLCBsdHkgPSAyLCBjb2xvciA9ICJncmF5NTAiLCBhbHBoYSA9IDAuNSkgKwogIGdncGxvdDI6Omdlb21fcG9pbnQoYWxwaGEgPSAwLjYsIGNvbG9yID0gIm1pZG5pZ2h0Ymx1ZSIpICsKICBnZ3Bsb3QyOjpjb29yZF9maXhlZCgpCmBgYAoKIyBSYW5kb20gRm9yZXN0CgpIZXJlIHdlIGFwcGx5IHJhbmRvbSBmb3Jlc3QgdG8gdGhlIGBCb3N0b25gIGRhdGEsIHVzaW5nIHRoZSBgcmFuZG9tRm9yZXN0YCBwYWNrYWdlIGluIFIKCmBgYHtyLCBlY2hvPUZBTFNFfQpzZXQuc2VlZCgxKQpgYGAKCiMjIENyZWF0ZSB0aGUgcnNhbXBsZSBvYmplY3QKCkZpcnN0LCB3ZSBzcGxpdCB0aGUgc2FtcGxlcyBpbnRvIGEgdHJhaW5pbmcgc2V0IGFuZCBhIHRlc3Qgc2V0LiBGcm9tIHRoZSB0cmFpbmluZyBzZXQsIHdlIGNyZWF0ZSBhIDEwLWZvbGQgY3Jvc3MtdmFsaWRhdGlvbiBkYXRhIHNldCBmcm9tIHRoZSB0cmFpbmluZyBzZXQuCgpUaGlzIGlzIGRvbmUgd2l0aCBbYHJzYW1wbGU6OmluaXRpYWxfc3BsaXRgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCksCltgcnNhbXBsZTo6dHJhaW5pbmdgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCkgYW5kCltgcnNhbXBsZTo6dGVzdGluZ2BdKGh0dHBzOi8vcnNhbXBsZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvaW5pdGlhbF9zcGxpdC5odG1sKQoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpCb3N0b25fc3BsaXQgPC0gcnNhbXBsZTo6aW5pdGlhbF9zcGxpdChCb3N0b24pCgpCb3N0b25fdHJhaW4gPC0gcnNhbXBsZTo6dHJhaW5pbmcoQm9zdG9uX3NwbGl0KQpCb3N0b25fdGVzdCA8LSByc2FtcGxlOjp0ZXN0aW5nKEJvc3Rvbl9zcGxpdCkKCmBgYAoKIyMgQ3JlYXRlIHRoZSBwcmVwcm9jZXNzb3IKCldlIGNyZWF0ZSBhIHJlY2lwZSB3aXRoIFtgcmVjaXBlczo6cmVjaXBlYF0oaHR0cHM6Ly9yZWNpcGVzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9yZWNpcGUuaHRtbCkuCk5vIG90aGVyIHByZXByb2Nlc3Npbmcgc3RlcCBpcyBkb25lLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpyZl9yZWNpcGUgPC0gCiAgcmVjaXBlczo6cmVjaXBlKGZvcm11bGEgPSBtZWR2IH4gLiwgZGF0YSA9IEJvc3Rvbl90cmFpbikKCmBgYAoKIyMgU3BlY2lmeSB0aGUgbW9kZWwKClVzZQpbYHBhcnNuaXA6OnJhbmRfZm9yZXN0YF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9yYW5kX2ZvcmVzdC5odG1sKSwKW2BwYXJzbmlwOjpzZXRfbW9kZWBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvc2V0X2FyZ3MuaHRtbCkKYW5kCltgcGFyc25pcDo6c2V0X2VuZ2luZWBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvc2V0X2VuZ2luZS5odG1sKQp0byBjcmVhdGUgdGhlIG1vZGVsLgoKYG10cnlgIGlzIHRoZSBudW1iZXIgb2YgcHJlZGljdG9ycyB0aGF0IHdpbGwgYmUgcmFuZG9tbHkgc2FtcGxlZCBhdCBlYWNoIHNwbGl0IHdoZW4gY3JlYXRpbmcgdGhlIHRyZWUgbW9kZWxzLiBGb3IgcmFuZG9tIGZvcmVzdCwgdGhlIGByYW5kb21Gb3Jlc3Q6OnJhbmRvbUZvcmVzdGAgdXNlICRcZnJhY3twfXszfSQgdmFyaWFibGVzIHdoZW4gYnVpbGRpbmcgYSByYW5kb20gZm9yZXN0IG9mIHJlZ3Jlc3Npb24gdHJlZXMgYW5kICRcc3FydHtwfSQgdmFyaWFibGVzIHdoZW4gYnVpbGRpbmcgYSByYW5kb20gZm9yZXN0IG9mIGNsYXNzaWZpY2F0aW9uIHRyZWVzLgoKYGltcG9ydGFuY2VgIHNldCB0byBUUlVFIGVuc3VyZXMgdGhlIGltcG9ydGFuY2Ugb2YgcHJlZGljdG9ycyBhcmUgYXNzZXNzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCnJmX3NwZWMgPC0gcGFyc25pcDo6cmFuZF9mb3Jlc3QoKSAlPiUKICBwYXJzbmlwOjpzZXRfZW5naW5lKCJyYW5kb21Gb3Jlc3QiLCBpbXBvcnRhbmNlID0gVFJVRSkgJT4lCiAgcGFyc25pcDo6c2V0X21vZGUoInJlZ3Jlc3Npb24iKQoKcmZfc3BlYyAlPiUKICBwYXJzbmlwOjp0cmFuc2xhdGUoKQpgYGAKCiMjIENyZWF0ZSB0aGUgd29ya2Zsb3cKCltgd29ya2Zsb3dzOjp3b3JrZmxvd2BdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS93b3JrZmxvdy5odG1sKSwKW2B3b3JrZmxvd3M6OmFkZF9yZWNpcGVgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYWRkX3JlY2lwZS5odG1sKQphbmQKW2B3b3JrZmxvd3M6OmFkZF9tb2RlbGBdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9hZGRfbW9kZWwuaHRtbCkKYXJlIHVzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKcmZfd29ya2Zsb3cgPC0gIHdvcmtmbG93czo6d29ya2Zsb3coKSAlPiUgCiAgd29ya2Zsb3dzOjphZGRfcmVjaXBlKHJmX3JlY2lwZSkgJT4lIAogIHdvcmtmbG93czo6YWRkX21vZGVsKHJmX3NwZWMpCgpyZl93b3JrZmxvdyAKYGBgCgojIyBSYW5kb20gZm9yZXN0IG9uIHRyYWluaW5nIGRhdGEKCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKcmZfZml0IDwtIHBhcnNuaXA6OmZpdChvYmplY3QgPSByZl93b3JrZmxvdywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gQm9zdG9uX3RyYWluKQpgYGAKCiMjIFZhcmlhYmxlIEltcG9ydGFuY2UKCldoYXQgYXJlIHRoZSBtb3N0IGltcG9ydGFudCB2YXJpYWJsZXMgaW4gdGhpcyB0cmVlIGZvciBwcmVkaWN0aW5nIGBtZWR2YD8KClVzaW5nIHRoZSBgdmlwYCBwYWNrYWdlIGFuZApbYHdvcmtmbG93czo6ZXh0cmFjdF9maXRfcGFyc25pcGBdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9leHRyYWN0LXdvcmtmbG93Lmh0bWwpLCB3ZSBoYXZlCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCnZpcF90YWJsZSA8LSByZl9maXQgJT4lCiAgd29ya2Zsb3dzOjpleHRyYWN0X2ZpdF9wYXJzbmlwKCkgJT4lCiAgdmlwOjp2aSgpIAoKdmlwX3RhYmxlICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CnJmX2ZpdCAlPiUKICB3b3JrZmxvd3M6OmV4dHJhY3RfZml0X3BhcnNuaXAoKSAlPiUKICB2aXA6OnZpcChnZW9tID0gImNvbCIsIAogICAgICAgICAgIGFlc3RoZXRpY3MgPSBsaXN0KGZpbGwgPSAibWlkbmlnaHRibHVlIiwgYWxwaGEgPSAwLjgpKSArCiAgZ2dwbG90Mjo6c2NhbGVfeV9jb250aW51b3VzKGV4cGFuZCA9IGMoMCwgMCkpCmBgYAoKVGhlIGByYW5kb21Gb3Jlc3RgIHBhY2thZ2UgYWxzbyBoYXMgZnVuY3Rpb25zIGxpa2UgYHJhbmRvbUZvcmVzdDo6aW1wb3J0YW5jZWAgdG8gdmlldyB0aGUgaW1wb3J0YW5jZSBvZiBlYWNoIHZhcmlhYmxlIGFzIHdlbGwuIFRoZSBrZXkgaXMgdG8gdXNlIFtgd29ya2Zsb3dzOjpleHRyYWN0X2ZpdF9lbmdpbmVgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvZXh0cmFjdC13b3JrZmxvdy5odG1sKQoKVGhlIGZpcnN0IGlzIGJhc2VkIHVwb24gdGhlIG1lYW4gZGVjcmVhc2Ugb2YgYWNjdXJhY3kgaW4gcHJlZGljdGlvbnMgb24gdGhlIG91dCBvZiBiYWcgc2FtcGxlcyB3aGVuIGEgZ2l2ZW4gdmFyaWFibGUgaXMgcGVybXV0ZWQuIAoKVGhlIHNlY29uZCBpcyBhIG1lYXN1cmUgb2YgdGhlIHRvdGFsIGRlY3JlYXNlIGluIG5vZGUgaW1wdXJpdHkgdGhhdCByZXN1bHRzIGZyb20gc3BsaXRzIG92ZXIgdGhhdCB2YXJpYWJsZSwgYXZlcmFnZWQgb3ZlciBhbGwgdHJlZXMuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCmltcG9ydGFuY2VfdGFibGUgPC0gcmZfZml0ICU+JQogIHdvcmtmbG93czo6ZXh0cmFjdF9maXRfZW5naW5lKCkgJT4lCiAgcmFuZG9tRm9yZXN0OjppbXBvcnRhbmNlKCkKICAKaW1wb3J0YW5jZV90YWJsZSAlPiUKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQpgYGAKClBsb3RzIG9mIHRoZXNlIGltcG9ydGFuY2UgbWVhc3VyZXMgY2FuIGJlIHByb2R1Y2VkIHVzaW5nIHRoZSBgcmFuZG9tRm9yZXN0Ojp2YXJJbXBQbG90YCBmdW5jdGlvbi4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKcmZfZml0ICU+JQogIHdvcmtmbG93czo6ZXh0cmFjdF9maXRfZW5naW5lKCkgJT4lIAogIHJhbmRvbUZvcmVzdDo6dmFySW1wUGxvdCgpCgpgYGAKCiMjIFJhbmRvbSBmb3Jlc3Qgb24gdGVzdCBkYXRhCgpGaW5hbGx5LCBsZXTigJlzIHR1cm4gdG8gdGhlIHRlc3RpbmcgZGF0YS4KRm9yIHJlZ3Jlc3Npb24gbW9kZWxzLCBhCmAucHJlZGAsIGNvbHVtbiBpcyBhZGRlZCB3aGVuCltgcGFyc25pcDo6YXVnbWVudGBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXVnbWVudC5odG1sKQppcyB1c2VkLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgp0ZXN0X3Jlc3VsdHMgPC0gcGFyc25pcDo6YXVnbWVudCh4ID0gcmZfZml0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2RhdGEgPSBCb3N0b25fdGVzdCkKICAKdGVzdF9yZXN1bHRzICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCgpgYGAKCldlIGNoZWNrIGhvdyB3ZWxsIHRoZSBgLnByZWRgIGNvbHVtbiBtYXRjaGVzIHRoZSBgbWVkdmAgdXNpbmcKW2B5YXJkc3RpY2s6OnJtc2VgXShodHRwczovL3lhcmRzdGljay50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvcm1zZS5odG1sKS4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQp0ZXN0X3Jlc3VsdHMgJT4lCiAgeWFyZHN0aWNrOjpybXNlKHRydXRoID0gLmRhdGFbWyJtZWR2Il1dLCBlc3RpbWF0ZSA9IC5kYXRhW1siLnByZWQiXV0pICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKTGV0IHVzIHRha2UgYSBjbG9zZXIgbG9vayBhdCB0aGUgcHJlZGljdGVkIGFuZCBhY3R1YWwgcmVzcG9uc2UgYXMgYSBzY2F0dGVyIHBsb3QuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KdGVzdF9yZXN1bHRzICU+JQogIGdncGxvdDI6OmdncGxvdChtYXBwaW5nID0gZ2dwbG90Mjo6YWVzKHggPSAuZGF0YVtbIm1lZHYiXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IC5kYXRhW1siLnByZWQiXV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICkgKwogIGdncGxvdDI6Omdlb21fYWJsaW5lKHNsb3BlID0gMSwgbHR5ID0gMiwgY29sb3IgPSAiZ3JheTUwIiwgYWxwaGEgPSAwLjUpICsKICBnZ3Bsb3QyOjpnZW9tX3BvaW50KGFscGhhID0gMC42LCBjb2xvciA9ICJtaWRuaWdodGJsdWUiKSArCiAgZ2dwbG90Mjo6Y29vcmRfZml4ZWQoKQpgYGAKCiMgQm9vc3RpbmcKCkhlcmUgd2UgYXBwbHkgYmFnZ2luZyB0byB0aGUgYEJvc3RvbmAgZGF0YS4gVGhlIGJvb2sgdXNlcyB0aGUgUiBwYWNrYWdlIGBnYm1gIHRvIGRvIHRoZSBib29zdGluZy4gVW5mb3J0dW5hdGVseSwgYGdibWAgaXMgbm90IG9uZSBvZiB0aGUgbGlzdCBib29zdGVkIHRyZWUgbW9kZWxzIGluIHRoZSBjdXJyZW50IFtwYXJzbmlwIGxpc3RdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYm9vc3RfdHJlZS5odG1sKS4KClRoZSBwcm9jZXNzIG9mIGJ1aWxkaW5nIGl0IGZyb20gc2NyYXRjaCBjYW4gYmUgZm91bmQgaW4gdGhpcyBbZ2l0aHViIGlzc3VlIHBvc3RdKGh0dHBzOi8vZ2l0aHViLmNvbS90aWR5bW9kZWxzL3BhcnNuaXAvaXNzdWVzLzIyMCkKCkZvciBzaW1wbGljaXR5LCBhIGRpZmZlcmVudCBSIHBhY2thZ2UgaXMgdXNlZCB0byBjcmVhdGUgYSBiYWdnaW5nIHRyZWUgbW9kZWwuIEluIHRoaXMgZXhhbXBsZSwgdGhlIGRlZmF1bHQgcGFyc25pcCBlbmdpbmUgZm9yIGJvb3N0ZWQgdHJlZSBpcyB0aGUgYHhnYm9vc3RgIFIgcGFja2FnZS4KCmBgYHtyLCBlY2hvPUZBTFNFfQpzZXQuc2VlZCgxKQpgYGAKCiMjIENyZWF0ZSB0aGUgcmVzYW1wbGUgb2JqZWN0CgpGaXJzdCwgd2Ugc3BsaXQgdGhlIHNhbXBsZXMgaW50byBhIHRyYWluaW5nIHNldCBhbmQgYSB0ZXN0IHNldC4gRnJvbSB0aGUgdHJhaW5pbmcgc2V0LCB3ZSBjcmVhdGUgYSAxMC1mb2xkIGNyb3NzLXZhbGlkYXRpb24gZGF0YSBzZXQgZnJvbSB0aGUgdHJhaW5pbmcgc2V0LgoKVGhpcyBpcyBkb25lIHdpdGggW2Byc2FtcGxlOjppbml0aWFsX3NwbGl0YF0oaHR0cHM6Ly9yc2FtcGxlLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9pbml0aWFsX3NwbGl0Lmh0bWwpLApbYHJzYW1wbGU6OnRyYWluaW5nYF0oaHR0cHM6Ly9yc2FtcGxlLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9pbml0aWFsX3NwbGl0Lmh0bWwpLApbYHJzYW1wbGU6OnRlc3RpbmdgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCkKYW5kCltgcnNhbXBsZTo6dmZvbGRfY3ZgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3Zmb2xkX2N2Lmh0bWwpLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpCb3N0b25fc3BsaXQgPC0gcnNhbXBsZTo6aW5pdGlhbF9zcGxpdChCb3N0b24pCgpCb3N0b25fdHJhaW4gPC0gcnNhbXBsZTo6dHJhaW5pbmcoQm9zdG9uX3NwbGl0KQpCb3N0b25fdGVzdCA8LSByc2FtcGxlOjp0ZXN0aW5nKEJvc3Rvbl9zcGxpdCkKCkJvc3Rvbl9mb2xkIDwtIHJzYW1wbGU6OnZmb2xkX2N2KEJvc3Rvbl90cmFpbiwgdiA9IDEwKQoKCmBgYAoKIyMgQ3JlYXRlIHRoZSBwcmVwcm9jZXNzb3IKCldlIGNyZWF0ZSBhIHJlY2lwZSB3aXRoIFtgcmVjaXBlczo6cmVjaXBlYF0oaHR0cHM6Ly9yZWNpcGVzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9yZWNpcGUuaHRtbCkuCk5vIG90aGVyIHByZXByb2Nlc3Npbmcgc3RlcCBpcyBkb25lLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgpib29zdF9yZWNpcGUgPC0gCiAgcmVjaXBlczo6cmVjaXBlKGZvcm11bGEgPSBtZWR2IH4gLiwgZGF0YSA9IEJvc3Rvbl90cmFpbikKCmBgYAoKIyMgU3BlY2lmeSB0aGUgbW9kZWwKClVzZQpbYHBhcnNuaXA6OmJvb3N0X3RyZWVgXShodHRwczovL3BhcnNuaXAudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2Jvb3N0X3RyZWUuaHRtbCksCltgcGFyc25pcDo6c2V0X21vZGVgXShodHRwczovL3BhcnNuaXAudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3NldF9hcmdzLmh0bWwpCmFuZApbYHBhcnNuaXA6OnNldF9lbmdpbmVgXShodHRwczovL3BhcnNuaXAudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3NldF9lbmdpbmUuaHRtbCkKdG8gY3JlYXRlIHRoZSBtb2RlbC4KClJlY2FsbCBpbiB0aGUgYm9vayB0aGF0IHdlIGNhbiB0dW5lIHRoZSBudW1iZXIgb2YgdHJlZXMgYHRyZWVzYCwgdGhlIHNocmlua2FnZSBwYXJhbWV0ZXIgYGxlYXJuX3JhdGVgIGFuZCB0aGUgbnVtYmVyIG9mIHNwbGl0cy9kZXB0aCBgdHJlZV9kZXB0aGAuCgpUaGVzZSBjYW4gYmUgdHVuZWQgdXNpbmcgW2B0dW5lOjp0dW5lYF0oaHR0cHM6Ly9oYXJkaGF0LnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS90dW5lLmh0bWwpCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCmJvb3N0X3NwZWMgPC0gcGFyc25pcDo6Ym9vc3RfdHJlZSgKICB0cmVlcyA9IHR1bmU6OnR1bmUoKSwKICB0cmVlX2RlcHRoID0gdHVuZTo6dHVuZSgpLAogIGxlYXJuX3JhdGUgPSB0dW5lOjp0dW5lKCkKICApICU+JQogIHBhcnNuaXA6OnNldF9tb2RlKCJyZWdyZXNzaW9uIikgJT4lIAogIHBhcnNuaXA6OnNldF9lbmdpbmUoInhnYm9vc3QiKQoKYm9vc3Rfc3BlYyAlPiUKICBwYXJzbmlwOjp0cmFuc2xhdGUoKQpgYGAKCiMjIENyZWF0ZSB0aGUgd29ya2Zsb3cKCltgd29ya2Zsb3dzOjp3b3JrZmxvd2BdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS93b3JrZmxvdy5odG1sKSwKW2B3b3JrZmxvd3M6OmFkZF9yZWNpcGVgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYWRkX3JlY2lwZS5odG1sKQphbmQKW2B3b3JrZmxvd3M6OmFkZF9tb2RlbGBdKGh0dHBzOi8vd29ya2Zsb3dzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9hZGRfbW9kZWwuaHRtbCkKYXJlIHVzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKYm9vc3Rfd29ya2Zsb3cgPC0gIHdvcmtmbG93czo6d29ya2Zsb3coKSAlPiUgCiAgd29ya2Zsb3dzOjphZGRfcmVjaXBlKGJvb3N0X3JlY2lwZSkgJT4lIAogIHdvcmtmbG93czo6YWRkX21vZGVsKGJvb3N0X3NwZWMpCgpib29zdF93b3JrZmxvdyAKYGBgCgojIyBDcmVhdGUgdGhlIGJvb3N0aW5nIHRyZWUgZ3JpZAoKTGV04oCZcyB1c2UgYSBzcGFjZS1maWxsaW5nIGRlc2lnbiAobm9uLXJlZ3VsYXIgZ3JpZCkgc28gdGhhdCB3ZSBjYW4gY292ZXIgdGhlIGh5cGVycGFyYW1ldGVyIHNwYWNlIGFzIHdlbGwgYXMgcG9zc2libGUuIFdlIGRvIHRoaXMgdXNpbmcKW2BkaWFsczo6Z3JpZF9sYXRpbl9oeXBlcmN1YmVgXShodHRwczovL2RpYWxzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9ncmlkX21heF9lbnRyb3B5Lmh0bWwpCgpXZSB1c2UgdGhlIGRlZmF1bHQgdmFsdWVzIGZvciBbYGRpYWxzOjp0cmVlc2BdKGh0dHBzOi8vZGlhbHMudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3RyZWVzLmh0bWwpLCBbYGRpYWxzOjp0cmVlX2RlcHRoYF0oaHR0cHM6Ly9kaWFscy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvdHJlZXMuaHRtbCkgYW5kCltgZGlhbHM6OmxlYXJuX3JhdGVgXShodHRwczovL2RpYWxzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9sZWFybl9yYXRlLmh0bWwpCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCmJvb3N0X2dyaWQgPC0gCiAgZGlhbHM6OmdyaWRfbGF0aW5faHlwZXJjdWJlKAogICAgZGlhbHM6OnRyZWVzKHJhbmdlID0gYygxTCwgMjAwMEwpKSwKICAgIGRpYWxzOjp0cmVlX2RlcHRoKHJhbmdlID0gYygxTCwgMTVMKSksCiAgICBkaWFsczo6bGVhcm5fcmF0ZShyYW5nZSA9IGMoLTEwLCAtMSksIAogICAgICAgICAgICAgICAgICAgICAgdHJhbnMgPSBzY2FsZXM6OmxvZzEwX3RyYW5zKCkpLAogICAgc2l6ZSA9IDEwCiAgKQoKYm9vc3RfZ3JpZCAgJT4lIAogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKWW91IG1heSByZWZlciB0byB0aGUgW1RpZHl2ZXJzZSBibG9nXShodHRwczovL3d3dy50aWR5dmVyc2Uub3JnL2Jsb2cvMjAxOS8xMC9kaWFscy0wLTAtMy8pIG9yIFtUZW5na3UgSGFuaXMgYmxvZ10oaHR0cHM6Ly90ZW5na3VoYW5pcy5uZXRsaWZ5LmFwcC9wb3N0L2h5cGVycGFyYW1ldGVyLXR1bmluZy1pbi10aWR5bW9kZWxzLykgZm9yIG1vcmUgZGV0YWlscyBhYm91dCBob3cgdGhlIGRpZmZlcmVudCBncmlkcyB3b3JrLgoKIyMgQm9vc3RpbmcgdHJlZSBtb2RlbCBmaXR0aW5nIG9uIGNyb3NzIHZhbGlkYXRlZCBkYXRhCgpOb3cgd2UgaGF2ZSBldmVyeXRoaW5nIHdlIG5lZWQgYW5kIHdlIGNhbiBmaXQgYWxsIHRoZSBtb2RlbHMgb24gdGhlCmNyb3NzIHZhbGlkYXRlZCBkYXRhIHdpdGgKW2B0dW5lOjp0dW5lX2dyaWRgXShodHRwczovL3R1bmUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3R1bmVfZ3JpZC5odG1sKS4KTm90ZSB0aGF0IHRoaXMgcHJvY2VzcyBtYXkgdGFrZSBzb21lIHRpbWUuCgpXZSB1c2UgW2B5YXJkc3RpY2s6Om1ldHJpY19zZXRgXShodHRwczovL3lhcmRzdGljay50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvbWV0cmljX3NldC5odG1sKSwgdG8gY2hvb3NlIGEgc2V0IG9mIG1ldHJpY3MgdG8gdXNlZCB0byBldmFsdWF0ZSB0aGUgbW9kZWwuIEluIHRoaXMgZXhhbXBsZSwgW2B5YXJkc3RpY2s6OnJtc2VgXShodHRwczovL3lhcmRzdGljay50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvcm1zZS5odG1sKSBhbmQKW2B5YXJkc3RpY2s6OnJzcWBdKGh0dHBzOi8veWFyZHN0aWNrLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9yc3EuaHRtbCkgYXJlIHVzZWQuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KZG9QYXJhbGxlbDo6cmVnaXN0ZXJEb1BhcmFsbGVsKCkKZm9yZWFjaDo6Z2V0RG9QYXJXb3JrZXJzKCkKYGBgCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQp0dW5lX3JlcyA8LSB0dW5lOjp0dW5lX2dyaWQoCiAgb2JqZWN0ID0gYm9vc3Rfd29ya2Zsb3csCiAgcmVzYW1wbGVzID0gQm9zdG9uX2ZvbGQsIAogIGdyaWQgPSBib29zdF9ncmlkLAogIG1ldHJpY3MgPSB5YXJkc3RpY2s6Om1ldHJpY19zZXQoeWFyZHN0aWNrOjpybXNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeWFyZHN0aWNrOjpyc3EpCikKCnR1bmVfcmVzCmBgYAoKSGVyZSB3ZSBzZWUgdGhhdCB0aGUgZGlmZmVyZW50IGFtb3VudCBvZiB0cmVlcywgbGVhcm5pbmcvc2hyaW5rYWdlL3JhdGUgYW5kIHRyZWUgZGVwdGggYWZmZWN0cyB0aGUgcGVyZm9ybWFuY2UKbWV0cmljcyBkaWZmZXJlbnRseSB1c2luZwpbYHR1bmU6OmF1dG9wbG90YF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9hdXRvcGxvdC50dW5lX3Jlc3VsdHMuaHRtbCkuCkRvIG5vdGUgdGhhdCB1c2luZyBhIGRpZmZlcmVudCBzZWVkIHdpbGwgZ2l2ZSBhIGRpZmZlcmVudCBwbG90CgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KIyBOb3RlIHRoYXQgYSBkaWZmZXJlbnQgc2VlZCB3aWxsIGdpdmUgZGlmZmVyZW50IHBsb3RzCnR1bmU6OmF1dG9wbG90KHR1bmVfcmVzKQpgYGAKCldlIGNhbiBhbHNvIHNlZSB0aGUgcmF3IG1ldHJpY3MgdGhhdCBjcmVhdGVkIHRoaXMgY2hhcnQgYnkgY2FsbGluZwpbYHR1bmU6OmNvbGxlY3RfbWV0cmljcygpYF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9jb2xsZWN0X3ByZWRpY3Rpb25zLmh0bWwpLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0UsIG1heC5oZWlnaHQ9JzE1MHB4J30KCnR1bmU6OmNvbGxlY3RfbWV0cmljcyh0dW5lX3JlcykgJT4lIAogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKSGVyZSBpcyB0aGUgYGdncGxvdGAgd2F5IHNob3VsZApbYHR1bmU6OmF1dG9wbG90YF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9hdXRvcGxvdC50dW5lX3Jlc3VsdHMuaHRtbCkKZmFpbHMKCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQpmb3JfcGxvdHRpbmcgPC0gdHVuZV9yZXMgJT4lCiAgdHVuZTo6Y29sbGVjdF9tZXRyaWNzKCkgJT4lCiAgZHBseXI6OnNlbGVjdChkcGx5cjo6YWxsX29mKGMoIm1lYW4iLCAiLm1ldHJpYyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRyZWVzIiwidHJlZV9kZXB0aCIsImxlYXJuX3JhdGUiKSkpICU+JSAKICB0aWR5cjo6cGl2b3RfbG9uZ2VyKAogICAgY29scyA9IGRwbHlyOjphbGxfb2YoYygidHJlZXMiLCJ0cmVlX2RlcHRoIiwibGVhcm5fcmF0ZSIpKSwKICAgIHZhbHVlc190byA9ICJ2YWx1ZSIsCiAgICBuYW1lc190byA9ICJwYXJhbWV0ZXIiKQoKZm9yX3Bsb3R0aW5nICU+JSAKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQpgYGAKCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKZm9yX3Bsb3R0aW5nICU+JQogIGdncGxvdDI6OmdncGxvdChtYXBwaW5nID0gZ2dwbG90Mjo6YWVzKHggPSAuZGF0YVtbInZhbHVlIl1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAuZGF0YVtbIm1lYW4iXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3VyID0gLmRhdGFbWyJwYXJhbWV0ZXIiXV0pKSArCiAgZ2dwbG90Mjo6Z2VvbV9wb2ludChhbHBoYSA9IDAuOCwgc2hvdy5sZWdlbmQgPSBGQUxTRSkgKwogIGdncGxvdDI6OmZhY2V0X2dyaWQoY29scyA9IGdncGxvdDI6OnZhcnMoLmRhdGFbWyJwYXJhbWV0ZXIiXV0pLAogICAgICAgICAgICAgICAgICAgICAgcm93cyA9IGdncGxvdDI6OnZhcnMoLmRhdGFbWyIubWV0cmljIl1dKSwKICAgICAgICAgICAgICAgICAgICAgIHNjYWxlcyA9ICJmcmVlIikgKwogIGdncGxvdDI6OmxhYnMoeCA9IE5VTEwsIHkgPSBOVUxMKQpgYGAKClVzZQpbYHR1bmU6OnNob3dfYmVzdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvc2hvd19iZXN0Lmh0bWwpCnRvIHNlZSB0aGUgdG9wIGZldyB2YWx1ZXMgZm9yIGEgZ2l2ZW4gbWV0cmljLgoKVGhlICJiZXN0IiB2YWx1ZXMgY2FuIGJlIHNlbGVjdGVkIHVzaW5nCltgdHVuZTo6c2VsZWN0X2Jlc3RgXShodHRwczovL3R1bmUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3Nob3dfYmVzdC5odG1sKS4KCkRvIG5vdGUgdGhhdCB1c2luZyBhIGRpZmZlcmVudCBzZWVkIHdpbGwgZ2l2ZSBhIGRpZmZlcmVudCBvcHRpbWlzZWQgdmFsdWUuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKdG9wX2Jvb3N0X2dyaWQgPC0gdHVuZTo6c2hvd19iZXN0KHR1bmVfcmVzLCBtZXRyaWMgPSBjKCJybXNlIiksIG4gPSA1KQp0b3BfYm9vc3RfZ3JpZCAlPiUKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQoKYmVzdF9ib29zdF9ncmlkIDwtIHR1bmU6OnNlbGVjdF9iZXN0KHR1bmVfcmVzLCBtZXRyaWMgPSAicm1zZSIpCmJlc3RfYm9vc3RfZ3JpZAoKYGBgCgojIyBCb29zdGluZyB0cmVlIG1vZGVsIHdpdGggb3B0aW1pc2VkIGdyaWQKCldlIGNyZWF0ZSB0aGUgYm9vc3RpbmcgdHJlZSB3b3JrZmxvdyB3aXRoIHRoZSBiZXN0IGdyaWQKW2B0dW5lOjpmaW5hbGl6ZV93b3JrZmxvd2BdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvZmluYWxpemVfbW9kZWwuaHRtbCkuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKYm9vc3RfZmluYWwgPC0gdHVuZTo6ZmluYWxpemVfd29ya2Zsb3coCiAgeCA9IGJvb3N0X3dvcmtmbG93LCAKICBwYXJhbWV0ZXJzID0gYmVzdF9ib29zdF9ncmlkKQoKYm9vc3RfZmluYWwKYGBgCgpXZSBub3cgdHJhaW4gdGhlIGJvb3N0aW5nIHRyZWUgbW9kZWwgd2l0aCB0aGUgdHJhaW5pbmcgZGF0YSB1c2luZyBbYHBhcnNuaXA6OmZpdGBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvZml0Lmh0bWwpCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCmJvb3N0X2ZpbmFsX2ZpdCA8LSBwYXJzbmlwOjpmaXQob2JqZWN0ID0gYm9vc3RfZmluYWwsIGRhdGEgPSBCb3N0b25fdHJhaW4pCmBgYAoKV2UgY2FuIHNlZSB0aGUgdHJlZSBpbiBncmVhdGVyIGRldGFpbCB1c2luZwpbYHR1bmU6OmV4dHJhY3RfZml0X2VuZ2luZWBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvZXh0cmFjdC10dW5lLmh0bWwpCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQp4Z2JfbW9kZWwgPC0gYm9vc3RfZmluYWxfZml0ICU+JQogIHR1bmU6OmV4dHJhY3RfZml0X2VuZ2luZSgpCgp4Z2JfbW9kZWwKYGBgCgpXZSBjYW4gdmlzdWFsaXNlIG9uZSBvZiB0aGUgdHJlZXMgd2l0aCBgeGdib29zdDo6eGdiLnBsb3QudHJlZWAKCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9CiMgU2VlIHRoZSBmaXJzdCB0cmVlCmdyIDwtIHhnYm9vc3Q6OnhnYi5wbG90LnRyZWUobW9kZWwgPSB4Z2JfbW9kZWwsIHRyZWVzID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXIgPSBGQUxTRSkKCkRpYWdyYW1tZVI6OmV4cG9ydF9ncmFwaChncmFwaCA9IGdyLAogICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9uYW1lID0gInhnYm9vc3Rfc2luZ2xlX3RyZWUucG5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfdHlwZSA9ICJQTkciKQoKYGBgCgpgYGB7cn0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoInhnYm9vc3Rfc2luZ2xlX3RyZWUucG5nIikKYGBgCgpXZSBjYW4gdmlzdWFsaXNlIGEgc3VtbWFyeSBvZiBhbGwgdGhlIHRyZWVzIHdpdGggYHhnYm9vc3Q6OnhnYi5wbG90Lm11bHRpLnRyZWVzYAoKYGBge3IsIG1lc3NhZ2U9RkFMU0UsIG1heC5oZWlnaHQ9JzE1MHB4J30KZ3IgPC0geGdib29zdDo6eGdiLnBsb3QubXVsdGkudHJlZXMobW9kZWwgPSB4Z2JfbW9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzX2tlZXAgPSAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXIgPSBGQUxTRSkKCkRpYWdyYW1tZVI6OmV4cG9ydF9ncmFwaChncmFwaCA9IGdyLAogICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9uYW1lID0gInhnYm9vc3RfbXVsdGlwbGVfdHJlZS5wbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV90eXBlID0gIlBORyIpCgpgYGAKCmBgYHtyfQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygieGdib29zdF9tdWx0aXBsZV90cmVlLnBuZyIpCmBgYAoKIyMgVmFyaWFibGUgSW1wb3J0YW5jZQoKV2hhdCBhcmUgdGhlIG1vc3QgaW1wb3J0YW50IHZhcmlhYmxlcyBpbiB0aGlzIHRyZWUgZm9yIHByZWRpY3RpbmcgYG1lZHZgPwoKV2UgY2FuIGV4dHJhY3QgdGhlIGltcG9ydGFudCBmZWF0dXJlcyBmcm9tIHRoZSBib29zdGVkIHRyZWUgbW9kZWwgd2l0aCBgeGdib29zdDo6eGdiLmltcG9ydGFuY2VgCgpEZXRhaWxzIG9uIHdoYXQgYEdhaW5gLCBgQ292ZXJgIGFuZCBgRnJlcXVlbmN5YCBjYW4gYmUgZm91bmQgaW4gdGhpcyBbYmxvZyBwb3N0XShodHRwczovL3d3dy5yLWJsb2dnZXJzLmNvbS8yMDE5LzEwL2V4cGxhaW5pbmctcHJlZGljdGlvbnMtYm9vc3RlZC10cmVlcy1wb3N0LWhvYy1hbmFseXNpcy14Z2Jvb3N0LykKCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKaW1wb3J0YW5jZV9tYXRyaXggPC0geGdib29zdDo6eGdiLmltcG9ydGFuY2UobW9kZWwgPSB4Z2JfbW9kZWwpCgppbXBvcnRhbmNlX21hdHJpeCAlPiUgCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKYGBgCgpUaGUgYHhnYm9vc3Q6OnhnYi5nZ3Bsb3QuaW1wb3J0YW5jZWAgdXNlcyB0aGUgYEdhaW5gIHZhcmlhYmxlIGltcG9ydGFuY2UgbWVhc3VyZW1lbnQgYnkgZGVmYXVsdCB0byBjYWxjdWxhdGUgdmFyaWFibGUgaW1wb3J0YW5jZS4gCgpgYGB7cn0KCnhnYm9vc3Q6OnhnYi5nZ3Bsb3QuaW1wb3J0YW5jZShpbXBvcnRhbmNlX21hdHJpeCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxfdG9fZmlyc3QgPSBGQUxTRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhsYWIgPSAiUmVsYXRpdmUgaW1wb3J0YW5jZSIpCgpgYGAKCiMjIEJvb3N0aW5nIHRyZWUgbW9kZWwgb24gdGVzdCBkYXRhCgpGaW5hbGx5LCBsZXTigJlzIHR1cm4gdG8gdGhlIHRlc3RpbmcgZGF0YS4KRm9yIHJlZ3Jlc3Npb24gbW9kZWxzLCBhCmAucHJlZGAsIGNvbHVtbiBpcyBhZGRlZCB3aGVuCltgcGFyc25pcDo6YXVnbWVudGBdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXVnbWVudC5odG1sKQppcyB1c2VkLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9Cgp0ZXN0X3Jlc3VsdHMgPC0gcGFyc25pcDo6YXVnbWVudCh4ID0gYm9vc3RfZmluYWxfZml0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2RhdGEgPSBCb3N0b25fdGVzdCkKICAKdGVzdF9yZXN1bHRzICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCgpgYGAKCldlIGNoZWNrIGhvdyB3ZWxsIHRoZSBgLnByZWRgIGNvbHVtbiBtYXRjaGVzIHRoZSBgbWVkdmAgdXNpbmcKW2B5YXJkc3RpY2s6OnJtc2VgXShodHRwczovL3lhcmRzdGljay50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvcm1zZS5odG1sKS4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQp0ZXN0X3Jlc3VsdHMgJT4lCiAgeWFyZHN0aWNrOjpybXNlKHRydXRoID0gLmRhdGFbWyJtZWR2Il1dLCBlc3RpbWF0ZSA9IC5kYXRhW1siLnByZWQiXV0pICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKTGV0IHVzIHRha2UgYSBjbG9zZXIgbG9vayBhdCB0aGUgcHJlZGljdGVkIGFuZCBhY3R1YWwgcmVzcG9uc2UgYXMgYSBzY2F0dGVyIHBsb3QuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KdGVzdF9yZXN1bHRzICU+JQogIGdncGxvdDI6OmdncGxvdChtYXBwaW5nID0gZ2dwbG90Mjo6YWVzKHggPSAuZGF0YVtbIm1lZHYiXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IC5kYXRhW1siLnByZWQiXV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICkgKwogIGdncGxvdDI6Omdlb21fYWJsaW5lKHNsb3BlID0gMSwgbHR5ID0gMiwgY29sb3IgPSAiZ3JheTUwIiwgYWxwaGEgPSAwLjUpICsKICBnZ3Bsb3QyOjpnZW9tX3BvaW50KGFscGhhID0gMC42LCBjb2xvciA9ICJtaWRuaWdodGJsdWUiKSArCiAgZ2dwbG90Mjo6Y29vcmRfZml4ZWQoKQpgYGAKCiMgQmF5c2VzaWFuIEFkZGl0aXZlIFJlZ3Jlc3Npb24gVHJlZSAoQkFSVCkKCkhlcmUgd2UgYXBwbHkgYmFnZ2luZyB0byB0aGUgYEJvc3RvbmAgZGF0YS4gVGhlIGJvb2sgdXNlcyB0aGUgUiBwYWNrYWdlIGBCQVJUYCB0byBkbyB0aGUgYm9vc3RpbmcuIFVuZm9ydHVuYXRlbHksIGBCQVJUYCBpcyBub3Qgb25lIG9mIHRoZSBsaXN0IGJhcnQgbW9kZWxzIGluIHRoZSBjdXJyZW50IFtwYXJzbmlwIGxpc3RdKGh0dHBzOi8vcGFyc25pcC50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYmFydC5odG1sKS4KCkZvciBzaW1wbGljaXR5LCBhIGRpZmZlcmVudCBSIHBhY2thZ2UgaXMgdXNlZCB0byBjcmVhdGUgYSBCQVJUIG1vZGVsLiBJbiB0aGlzIGV4YW1wbGUsIHRoZSBkZWZhdWx0IHBhcnNuaXAgZW5naW5lIGZvciBib3N0ZWQgdHJlZSBpcyB0aGUgYGRiYXJ0c2AgUiBwYWNrYWdlLgoKYGBge3IsIGVjaG89RkFMU0V9CnNldC5zZWVkKDEpCmBgYAoKIyMgQ3JlYXRlIHRoZSByZXNhbXBsZSBvYmplY3QKCkZpcnN0LCB3ZSBzcGxpdCB0aGUgc2FtcGxlcyBpbnRvIGEgdHJhaW5pbmcgc2V0IGFuZCBhIHRlc3Qgc2V0LiBGcm9tIHRoZSB0cmFpbmluZyBzZXQsIHdlIGNyZWF0ZSBhIDEwLWZvbGQgY3Jvc3MtdmFsaWRhdGlvbiBkYXRhIHNldCBmcm9tIHRoZSB0cmFpbmluZyBzZXQuCgpUaGlzIGlzIGRvbmUgd2l0aCBbYHJzYW1wbGU6OmluaXRpYWxfc3BsaXRgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCksCltgcnNhbXBsZTo6dHJhaW5pbmdgXShodHRwczovL3JzYW1wbGUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2luaXRpYWxfc3BsaXQuaHRtbCksCltgcnNhbXBsZTo6dGVzdGluZ2BdKGh0dHBzOi8vcnNhbXBsZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvaW5pdGlhbF9zcGxpdC5odG1sKQphbmQKW2Byc2FtcGxlOjp2Zm9sZF9jdmBdKGh0dHBzOi8vcnNhbXBsZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvdmZvbGRfY3YuaHRtbCkuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCkJvc3Rvbl9zcGxpdCA8LSByc2FtcGxlOjppbml0aWFsX3NwbGl0KEJvc3RvbikKCkJvc3Rvbl90cmFpbiA8LSByc2FtcGxlOjp0cmFpbmluZyhCb3N0b25fc3BsaXQpCkJvc3Rvbl90ZXN0IDwtIHJzYW1wbGU6OnRlc3RpbmcoQm9zdG9uX3NwbGl0KQoKQm9zdG9uX2ZvbGQgPC0gcnNhbXBsZTo6dmZvbGRfY3YoQm9zdG9uX3RyYWluLCB2ID0gMTApCgoKYGBgCgojIyBDcmVhdGUgdGhlIHByZXByb2Nlc3NvcgoKV2UgY3JlYXRlIGEgcmVjaXBlIHdpdGggW2ByZWNpcGVzOjpyZWNpcGVgXShodHRwczovL3JlY2lwZXMudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3JlY2lwZS5odG1sKS4KTm8gb3RoZXIgcHJlcHJvY2Vzc2luZyBzdGVwIGlzIGRvbmUuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCmJhcnRfcmVjaXBlIDwtIAogIHJlY2lwZXM6OnJlY2lwZShmb3JtdWxhID0gbWVkdiB+IC4sIGRhdGEgPSBCb3N0b25fdHJhaW4pCgpgYGAKCiMjIFNwZWNpZnkgdGhlIG1vZGVsCgpVc2UKW2BwYXJzbmlwOjpiYXJ0YF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9iYXJ0Lmh0bWwpLApbYHBhcnNuaXA6OnNldF9tb2RlYF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zZXRfYXJncy5odG1sKQphbmQKW2BwYXJzbmlwOjpzZXRfZW5naW5lYF0oaHR0cHM6Ly9wYXJzbmlwLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9zZXRfZW5naW5lLmh0bWwpCnRvIGNyZWF0ZSB0aGUgbW9kZWwuCgpgbmRwb3N0YCBpcyB0aGUgbnVtYmVyIG9mIE1DTUMgaW50ZXJhdGlvbnMuCmBuc2tpcGAgaXMgdGhlIG51bWJlciBvZiBidXJuLWluIGl0ZXJhdGlvbnMuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCmJhcnRfc3BlYyA8LSBwYXJzbmlwOjpiYXJ0KAogIHRyZWVzID0gdHVuZTo6dHVuZSgpKSAlPiUKICBwYXJzbmlwOjpzZXRfbW9kZSgicmVncmVzc2lvbiIpICU+JSAKICBwYXJzbmlwOjpzZXRfZW5naW5lKCJkYmFydHMiLAogICAgICAgICAgICAgICAgICAgICAgbnNraXAgPSAxMDAsCiAgICAgICAgICAgICAgICAgICAgICBuZHBvc3QgPSA1MDApCgpiYXJ0X3NwZWMgJT4lCiAgcGFyc25pcDo6dHJhbnNsYXRlKCkKYGBgCgojIyBDcmVhdGUgdGhlIHdvcmtmbG93CgpbYHdvcmtmbG93czo6d29ya2Zsb3dgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvd29ya2Zsb3cuaHRtbCksCltgd29ya2Zsb3dzOjphZGRfcmVjaXBlYF0oaHR0cHM6Ly93b3JrZmxvd3MudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2FkZF9yZWNpcGUuaHRtbCkKYW5kCltgd29ya2Zsb3dzOjphZGRfbW9kZWxgXShodHRwczovL3dvcmtmbG93cy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYWRkX21vZGVsLmh0bWwpCmFyZSB1c2VkLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0UsIG1heC5oZWlnaHQ9JzE1MHB4J30KCmJhcnRfd29ya2Zsb3cgPC0gIHdvcmtmbG93czo6d29ya2Zsb3coKSAlPiUgCiAgd29ya2Zsb3dzOjphZGRfcmVjaXBlKGJhcnRfcmVjaXBlKSAlPiUgCiAgd29ya2Zsb3dzOjphZGRfbW9kZWwoYmFydF9zcGVjKQoKYmFydF93b3JrZmxvdyAKYGBgCgojIyBDcmVhdGUgdGhlIEJBUlQgZ3JpZAoKTGV04oCZcyB1c2UgYSBzcGFjZS1maWxsaW5nIGRlc2lnbiAobm9uLXJlZ3VsYXIgZ3JpZCkgc28gdGhhdCB3ZSBjYW4gY292ZXIgdGhlIGh5cGVycGFyYW1ldGVyIHNwYWNlIGFzIHdlbGwgYXMgcG9zc2libGUuIFdlIGRvIHRoaXMgdXNpbmcKW2BkaWFsczo6Z3JpZF9yZWd1bGFyYF0oaHR0cHM6Ly9kaWFscy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvZ3JpZF9yZWd1bGFyLmh0bWwpCgpXZSB1c2UgdGhlIGRlZmF1bHQgdmFsdWVzIGZvciBbYGRpYWxzOjp0cmVlc2BdKGh0dHBzOi8vZGlhbHMudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3RyZWVzLmh0bWwpLCBbYGRpYWxzOjp0cmVlX2RlcHRoYF0oaHR0cHM6Ly9kaWFscy50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvdHJlZXMuaHRtbCkgYW5kCltgZGlhbHM6OmxlYXJuX3JhdGVgXShodHRwczovL2RpYWxzLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9sZWFybl9yYXRlLmh0bWwpCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KCmJhcnRfZ3JpZCA8LSAKICBkaWFsczo6Z3JpZF9yZWd1bGFyKAogICAgeCA9IGRpYWxzOjp0cmVlcyhyYW5nZSA9IGMoMUwsIDEwTCkpLAogICAgbGV2ZWxzID0gMTAKICApCgpiYXJ0X2dyaWQgICU+JSAKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQpgYGAKCiMjIEJBUlQgbW9kZWwgZml0dGluZyBvbiBjcm9zcyB2YWxpZGF0ZWQgZGF0YQoKTm93IHdlIGhhdmUgZXZlcnl0aGluZyB3ZSBuZWVkIGFuZCB3ZSBjYW4gZml0IGFsbCB0aGUgbW9kZWxzIG9uIHRoZQpjcm9zcyB2YWxpZGF0ZWQgZGF0YSB3aXRoCltgdHVuZTo6dHVuZV9ncmlkYF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS90dW5lX2dyaWQuaHRtbCkuCk5vdGUgdGhhdCB0aGlzIHByb2Nlc3MgbWF5IHRha2Ugc29tZSB0aW1lLgoKV2UgdXNlIFtgeWFyZHN0aWNrOjptZXRyaWNfc2V0YF0oaHR0cHM6Ly95YXJkc3RpY2sudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL21ldHJpY19zZXQuaHRtbCksIHRvIGNob29zZSBhIHNldCBvZiBtZXRyaWNzIHRvIHVzZWQgdG8gZXZhbHVhdGUgdGhlIG1vZGVsLiBJbiB0aGlzIGV4YW1wbGUsIFtgeWFyZHN0aWNrOjpybXNlYF0oaHR0cHM6Ly95YXJkc3RpY2sudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3Jtc2UuaHRtbCkgYW5kCltgeWFyZHN0aWNrOjpyc3FgXShodHRwczovL3lhcmRzdGljay50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvcnNxLmh0bWwpIGFyZSB1c2VkLgoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CmRvUGFyYWxsZWw6OnJlZ2lzdGVyRG9QYXJhbGxlbCgpCmZvcmVhY2g6OmdldERvUGFyV29ya2VycygpCmBgYAoKYGBge3IsIG1lc3NhZ2U9RkFMU0UsIG1heC5oZWlnaHQ9JzE1MHB4J30KdHVuZV9yZXMgPC0gdHVuZTo6dHVuZV9ncmlkKAogIG9iamVjdCA9IGJhcnRfd29ya2Zsb3csCiAgcmVzYW1wbGVzID0gQm9zdG9uX2ZvbGQsIAogIGdyaWQgPSBiYXJ0X2dyaWQsCiAgbWV0cmljcyA9IHlhcmRzdGljazo6bWV0cmljX3NldCh5YXJkc3RpY2s6OnJtc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXJkc3RpY2s6OnJzcSkKKQoKdHVuZV9yZXMKYGBgCgpIZXJlIHdlIHNlZSB0aGF0IHRoZSBkaWZmZXJlbnQgYW1vdW50IG9mIHRyZWVzIGFmZmVjdHMgdGhlIHBlcmZvcm1hbmNlCm1ldHJpY3MgZGlmZmVyZW50bHkgdXNpbmcKW2B0dW5lOjphdXRvcGxvdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXV0b3Bsb3QudHVuZV9yZXN1bHRzLmh0bWwpLgpEbyBub3RlIHRoYXQgdXNpbmcgYSBkaWZmZXJlbnQgc2VlZCB3aWxsIGdpdmUgYSBkaWZmZXJlbnQgcGxvdAoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CiMgTm90ZSB0aGF0IGEgZGlmZmVyZW50IHNlZWQgd2lsbCBnaXZlIGRpZmZlcmVudCBwbG90cwp0dW5lOjphdXRvcGxvdCh0dW5lX3JlcykKYGBgCgpXZSBjYW4gYWxzbyBzZWUgdGhlIHJhdyBtZXRyaWNzIHRoYXQgY3JlYXRlZCB0aGlzIGNoYXJ0IGJ5IGNhbGxpbmcKW2B0dW5lOjpjb2xsZWN0X21ldHJpY3MoKWBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvY29sbGVjdF9wcmVkaWN0aW9ucy5odG1sKS4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9Cgp0dW5lOjpjb2xsZWN0X21ldHJpY3ModHVuZV9yZXMpICU+JSAKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQpgYGAKCkhlcmUgaXMgdGhlIGBnZ3Bsb3RgIHdheSBzaG91bGQKW2B0dW5lOjphdXRvcGxvdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2UvYXV0b3Bsb3QudHVuZV9yZXN1bHRzLmh0bWwpCmZhaWxzCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKdHVuZV9yZXMgJT4lCiAgdHVuZTo6Y29sbGVjdF9tZXRyaWNzKCkgJT4lCiAgZ2dwbG90Mjo6Z2dwbG90KG1hcHBpbmcgPSBnZ3Bsb3QyOjphZXMoeCA9IC5kYXRhW1sidHJlZXMiXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IC5kYXRhW1sibWVhbiJdXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvdXIgPSAuZGF0YVtbIi5tZXRyaWMiXV0pKSArCiAgZ2dwbG90Mjo6Z2VvbV9lcnJvcmJhcihtYXBwaW5nID0gZ2dwbG90Mjo6YWVzKHltaW4gPSAuZGF0YVtbIm1lYW4iXV0gLSAuZGF0YVtbInN0ZF9lcnIiXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHltYXggPSAuZGF0YVtbIm1lYW4iXV0gKyAuZGF0YVtbInN0ZF9lcnIiXV0pLAogICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGEgPSAwLjUpICsKICBnZ3Bsb3QyOjpnZW9tX2xpbmUoc2l6ZSA9IDEuNSkgKwogIGdncGxvdDI6OmZhY2V0X3dyYXAoZmFjZXRzID0gZ2dwbG90Mjo6dmFycyguZGF0YVtbIi5tZXRyaWMiXV0pLCAKICAgICAgICAgICAgICAgICAgICAgIHNjYWxlcyA9ICJmcmVlIiwgCiAgICAgICAgICAgICAgICAgICAgICBucm93ID0gMikgKwogIGdncGxvdDI6OnNjYWxlX3hfbG9nMTAoKSArCiAgZ2dwbG90Mjo6dGhlbWUobGVnZW5kLnBvc2l0aW9uID0gIm5vbmUiKQpgYGAKClVzZQpbYHR1bmU6OnNob3dfYmVzdGBdKGh0dHBzOi8vdHVuZS50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvc2hvd19iZXN0Lmh0bWwpCnRvIHNlZSB0aGUgdG9wIGZldyB2YWx1ZXMgZm9yIGEgZ2l2ZW4gbWV0cmljLgoKVGhlICJiZXN0IiB2YWx1ZXMgY2FuIGJlIHNlbGVjdGVkIHVzaW5nCltgdHVuZTo6c2VsZWN0X2Jlc3RgXShodHRwczovL3R1bmUudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL3Nob3dfYmVzdC5odG1sKS4KCkRvIG5vdGUgdGhhdCB1c2luZyBhIGRpZmZlcmVudCBzZWVkIHdpbGwgZ2l2ZSBhIGRpZmZlcmVudCBvcHRpbWlzZWQgdmFsdWUuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRSwgbWF4LmhlaWdodD0nMTUwcHgnfQoKdG9wX251bWJlcl9vZl90cmVlcyA8LSB0dW5lOjpzaG93X2Jlc3QodHVuZV9yZXMsIG1ldHJpYyA9IGMoInJtc2UiKSwgbiA9IDUpCnRvcF9udW1iZXJfb2ZfdHJlZXMgJT4lCiAgcmVhY3RhYmxlOjpyZWFjdGFibGUoZGVmYXVsdFBhZ2VTaXplID0gNSkKCmJlc3RfbnVtYmVyX29mX3RyZWVzIDwtIHR1bmU6OnNlbGVjdF9iZXN0KHR1bmVfcmVzLCBtZXRyaWMgPSAicm1zZSIpCmJlc3RfbnVtYmVyX29mX3RyZWVzCgpgYGAKCiMjIEJBUlQgbW9kZWwgd2l0aCBvcHRpbWlzZWQgZ3JpZAoKV2UgY3JlYXRlIHRoZSBCQVJUIHdvcmtmbG93IHdpdGggdGhlIGJlc3QgZ3JpZApbYHR1bmU6OmZpbmFsaXplX3dvcmtmbG93YF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9maW5hbGl6ZV9tb2RlbC5odG1sKS4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9CgpiYXJ0X2ZpbmFsIDwtIHR1bmU6OmZpbmFsaXplX3dvcmtmbG93KAogIHggPSBiYXJ0X3dvcmtmbG93LCAKICBwYXJhbWV0ZXJzID0gYmVzdF9udW1iZXJfb2ZfdHJlZXMpCgpiYXJ0X2ZpbmFsCmBgYAoKV2Ugbm93IHRyYWluIHRoZSBib29zdGluZyB0cmVlIG1vZGVsIHdpdGggdGhlIHRyYWluaW5nIGRhdGEgdXNpbmcgW2BwYXJzbmlwOjpmaXRgXShodHRwczovL3BhcnNuaXAudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2ZpdC5odG1sKQoKYGBge3IsIG1lc3NhZ2U9RkFMU0V9CgpiYXJ0X2ZpbmFsX2ZpdCA8LSBwYXJzbmlwOjpmaXQob2JqZWN0ID0gYmFydF9maW5hbCwgZGF0YSA9IEJvc3Rvbl90cmFpbikKYGBgCgpXZSBjYW4gc2VlIHRoZSB0cmVlIGluIGdyZWF0ZXIgZGV0YWlsIHVzaW5nCltgdHVuZTo6ZXh0cmFjdF9maXRfZW5naW5lYF0oaHR0cHM6Ly90dW5lLnRpZHltb2RlbHMub3JnL3JlZmVyZW5jZS9leHRyYWN0LXR1bmUuaHRtbCkKCkZvciBleGFtcGxlLCB0byBzZWUgdGhlIDJuZCB0cmVlIG9uIHRoZSB0aGlyZCBpdGVyYXRpb24KCmBgYHtyLCBtZXNzYWdlPUZBTFNFLCBtYXguaGVpZ2h0PScxNTBweCd9CmJhcnRfbW9kZWwgPC0gYmFydF9maW5hbF9maXQgJT4lCiAgdHVuZTo6ZXh0cmFjdF9maXRfZW5naW5lKCkKCmJhcnRfbW9kZWwkZml0JHBsb3RUcmVlKHNhbXBsZU51bSA9IDMsIHRyZWVOdW0gPSAyKQpgYGAKCiMjIFZhcmlhYmxlIEltcG9ydGFuY2UKCldoYXQgYXJlIHRoZSBtb3N0IGltcG9ydGFudCB2YXJpYWJsZXMgaW4gdGhpcyB0cmVlIGZvciBwcmVkaWN0aW5nIGBtZWR2YD8KCldlIGNhbiBleHRyYWN0IHRoZSBpbXBvcnRhbnQgZmVhdHVyZXMgZnJvbSB0aGUgYmFydCB0cmVlIG1vZGVsIHdpdGggYGVtYmFyY2FkZXJvOjp2YXJpbXBgCgpgYGB7cn0KZW1iYXJjYWRlcm86OnZhcmltcChiYXJ0X21vZGVsLCBwbG90cz1UUlVFKSAlPiUKICByZWFjdGFibGU6OnJlYWN0YWJsZShkZWZhdWx0UGFnZVNpemUgPSA1KQoKYGBgCgojIyBCQVJUIG1vZGVsIG9uIHRlc3QgZGF0YQoKRmluYWxseSwgbGV04oCZcyB0dXJuIHRvIHRoZSB0ZXN0aW5nIGRhdGEuCkZvciByZWdyZXNzaW9uIG1vZGVscywgYQpgLnByZWRgLCBjb2x1bW4gaXMgYWRkZWQgd2hlbgpbYHBhcnNuaXA6OmF1Z21lbnRgXShodHRwczovL3BhcnNuaXAudGlkeW1vZGVscy5vcmcvcmVmZXJlbmNlL2F1Z21lbnQuaHRtbCkKaXMgdXNlZC4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQoKdGVzdF9yZXN1bHRzIDwtIHBhcnNuaXA6OmF1Z21lbnQoeCA9IGJhcnRfZmluYWxfZml0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2RhdGEgPSBCb3N0b25fdGVzdCkKICAKdGVzdF9yZXN1bHRzICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCgpgYGAKCldlIGNoZWNrIGhvdyB3ZWxsIHRoZSBgLnByZWRgIGNvbHVtbiBtYXRjaGVzIHRoZSBgbWVkdmAgdXNpbmcKW2B5YXJkc3RpY2s6OnJtc2VgXShodHRwczovL3lhcmRzdGljay50aWR5bW9kZWxzLm9yZy9yZWZlcmVuY2Uvcm1zZS5odG1sKS4KCmBgYHtyLCBtZXNzYWdlPUZBTFNFfQp0ZXN0X3Jlc3VsdHMgJT4lCiAgeWFyZHN0aWNrOjpybXNlKHRydXRoID0gLmRhdGFbWyJtZWR2Il1dLCBlc3RpbWF0ZSA9IC5kYXRhW1siLnByZWQiXV0pICU+JQogIHJlYWN0YWJsZTo6cmVhY3RhYmxlKGRlZmF1bHRQYWdlU2l6ZSA9IDUpCmBgYAoKTGV0IHVzIHRha2UgYSBjbG9zZXIgbG9vayBhdCB0aGUgcHJlZGljdGVkIGFuZCBhY3R1YWwgcmVzcG9uc2UgYXMgYSBzY2F0dGVyIHBsb3QuCgpgYGB7ciwgbWVzc2FnZT1GQUxTRX0KdGVzdF9yZXN1bHRzICU+JQogIGdncGxvdDI6OmdncGxvdChtYXBwaW5nID0gZ2dwbG90Mjo6YWVzKHggPSAuZGF0YVtbIm1lZHYiXV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IC5kYXRhW1siLnByZWQiXV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICkgKwogIGdncGxvdDI6Omdlb21fYWJsaW5lKHNsb3BlID0gMSwgbHR5ID0gMiwgY29sb3IgPSAiZ3JheTUwIiwgYWxwaGEgPSAwLjUpICsKICBnZ3Bsb3QyOjpnZW9tX3BvaW50KGFscGhhID0gMC42LCBjb2xvciA9ICJtaWRuaWdodGJsdWUiKSArCiAgZ2dwbG90Mjo6Y29vcmRfZml4ZWQoKQpgYGAKCgojIEJsb2cgUmVmZXJlbmNlcwoKLSAgIEVtaWwgSHZpdGZlbGR0J3MgW0lTTFIgdGlkeW1vZGVscwogICAgTGFic10oaHR0cHM6Ly9lbWlsaHZpdGZlbGR0LmdpdGh1Yi5pby9JU0xSLXRpZHltb2RlbHMtbGFicy90cmVlLWJhc2VkLW1ldGhvZHMuaHRtbCkKCi0gICBKdWxpYSBTaWxnZSdzCiAgICBbYmxvZ10oaHR0cHM6Ly9qdWxpYXNpbGdlLmNvbS9ibG9nL3Njb29ieS1kb28uaHRtbCkgdGl0bGVkCiAgICAiUHJlZGljdCB3aGljaCAjVGlkeVR1ZXNkYXkgU2Nvb2J5IERvbyBtb25zdGVycyBhcmUgUkVBTCB3aXRoIGEgdHVuZWQgZGVjaXNpb24gdHJlZSBtb2RlbCIKCi0gICBKdWxpYSBTaWxnZSdzIFtibG9nXShodHRwczovL2p1bGlhc2lsZ2UuY29tL2Jsb2cvd2luZC10dXJiaW5lLmh0bWwpIHRpdGxlZAogICAgIlR1bmUgYW5kIGludGVycHJldCBkZWNpc2lvbiB0cmVlcyBmb3IgI1RpZHlUdWVzZGF5IHdpbmQgdHVyYmluZXMiCiAgICAKLSAgIEp1bGlhIFNpbGdlJ3MgW2Jsb2ddKGh0dHBzOi8vanVsaWFzaWxnZS5jb20vYmxvZy94Z2Jvb3N0LXR1bmUtdm9sbGV5YmFsbC5odG1sKSB0aXRsZWQKICAgICJUdW5lIFhHQm9vc3Qgd2l0aCB0aWR5bW9kZWxzIGFuZCAjVGlkeVR1ZXNkYXkgYmVhY2ggdm9sbGV5YmFsbCIKICAgIAotICAgUi1ibG9nZ2VycycgW2Jsb2ddKGh0dHBzOi8vd3d3LnItYmxvZ2dlcnMuY29tLzIwMTkvMTAvZXhwbGFpbmluZy1wcmVkaWN0aW9ucy1ib29zdGVkLXRyZWVzLXBvc3QtaG9jLWFuYWx5c2lzLXhnYm9vc3QvKSB0aXRsZWQgIkV4cGxhaW5pbmcgUHJlZGljdGlvbnM6IEJvb3N0ZWQgVHJlZXMgUG9zdC1ob2MgQW5hbHlzaXMgKFhnYm9vc3QpIgo=</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("index.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
